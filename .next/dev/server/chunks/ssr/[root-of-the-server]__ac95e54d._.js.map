{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 20, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/JeremyJoyner/code/budgetintelligence/app/agm/budget/page.tsx"],"sourcesContent":["\r\n// app/agm/budget/page.tsx\r\n// Server Component (App Router) – loads mock data, shows summary cards + read-only table.\r\n// Next step will be to swap the table with a client-side BudgetGrid (AG Grid or custom).\r\n// No new dependencies are introduced here.\r\n\r\nexport const runtime = \"nodejs\";\r\n\r\nimport { promises as fs } from \"fs\";\r\nimport path from \"path\";\r\n\r\n// Temporary local type (will be replaced by /types/budgetLine.ts)\r\ntype BudgetLine = {\r\n    type: \"revenue\" | \"expense\";\r\n    community: string;\r\n    category: string;\r\n    subCategory?: string | null;\r\n    budgetMethod?: string | null;\r\n    driver?: string | null;\r\n    driverTag?: string | null;\r\n    glCode?: string | null;\r\n    period?: string | number | null; // e.g., \"2026\" or \"2026-01\"\r\n    amount?: number | null;\r\n};\r\n\r\n// ---- helpers (will move to /lib/data.ts later) ----\r\nasync function loadBudgetLines(): Promise<BudgetLine[]> {\r\n    const filePath = path.join(process.cwd(), \"data\", \"budgetLines.json\");\r\n    const raw = await fs.readFile(filePath, \"utf-8\");\r\n    const json = JSON.parse(raw);\r\n\r\n    // Normalize shapes:\r\n    // 1) Flat array\r\n    if (Array.isArray(json)) {\r\n        return json as BudgetLine[];\r\n    }\r\n    // 2) { revenues: BudgetLine[], expenses: BudgetLine[] }\r\n    const lines: BudgetLine[] = [];\r\n    if (Array.isArray(json.revenues)) lines.push(...json.revenues);\r\n    if (Array.isArray(json.expenses)) lines.push(...json.expenses);\r\n    // 3) { lines: BudgetLine[] }\r\n    if (Array.isArray(json.lines)) lines.push(...json.lines);\r\n    return lines;\r\n}\r\n\r\nfunction sumAmount(lines: BudgetLine[], kind: BudgetLine[\"type\"]) {\r\n    return lines.reduce((acc, l) => {\r\n        if (l.type === kind && typeof l.amount === \"number\") acc += l.amount;\r\n        return acc;\r\n    }, 0);\r\n}\r\n\r\nfunction fmtCurrency(n: number) {\r\n    return new Intl.NumberFormat(\"en-US\", {\r\n        style: \"currency\",\r\n        currency: \"USD\",\r\n        maximumFractionDigits: 0,\r\n    }).format(n);\r\n}\r\n\r\n// ---- page ----\r\nexport default async function AgmBudgetPage() {\r\n    const lines = await loadBudgetLines();\r\n\r\n    const totalRevenue = sumAmount(lines, \"revenue\");\r\n    const totalExpense = sumAmount(lines, \"expense\");\r\n    const net = totalRevenue - totalExpense;\r\n\r\n    // simple derived info for table caption\r\n    const count = lines.length;\r\n    const distinctCommunities = new Set(lines.map((l) => l.community)).size;\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            {/* Page title */}\r\n            <header className=\"space-y-1\">\r\n                <h1 className=\"text-xl font-semibold text-slate-900\">Budget</h1>\r\n                <p className=\"text-sm text-slate-600\">\r\n                    Review and update budget lines by community, category, and period.\r\n                </p>\r\n            </header>\r\n\r\n            {/* Summary cards */}\r\n            <section\r\n                aria-label=\"Budget summary\"\r\n                className=\"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3\"\r\n            >\r\n                <Card\r\n                    title=\"Total Revenue\"\r\n                    value={fmtCurrency(totalRevenue)}\r\n                    testId=\"card-total-revenue\"\r\n                />\r\n                <Card\r\n                    title=\"Total Expense\"\r\n                    value={fmtCurrency(totalExpense)}\r\n                    testId=\"card-total-expense\"\r\n                />\r\n                <Card title=\"Net\" value={fmtCurrency(net)} testId=\"card-net\" />\r\n            </section>\r\n\r\n            {/* Placeholder for interactive grid – replaced in next step */}\r\n            <section\r\n                aria-label=\"Budget grid\"\r\n                className=\"space-y-3 rounded-xl border border-slate-200 bg-white p-4 shadow-sm\"\r\n            >\r\n                <div className=\"flex items-center justify-between\">\r\n                    <h2 className=\"text-base font-semibold text-slate-900\">\r\n                        Budget Lines\r\n                    </h2>\r\n                    <p className=\"text-xs text-slate-500\">\r\n                        {count} rows · {distinctCommunities} communities\r\n                    </p>\r\n                </div>\r\n\r\n                {/* Read-only table for now (validates columns & data shape).\r\n            We’ll mount the interactive Client Component here next. */}\r\n                <div className=\"overflow-x-auto\">\r\n                    <table\r\n                        aria-label=\"Budget lines table\"\r\n                        className=\"min-w-full border-collapse\"\r\n                    >\r\n                        <caption className=\"sr-only\">\r\n                            Read-only preview of budget lines. An interactive grid with\r\n                            grouping, filters, and bulk edit will replace this table.\r\n                        </caption>\r\n                        <thead>\r\n                            <tr className=\"bg-slate-50 text-left text-xs font-semibold uppercase tracking-wide text-slate-600\">\r\n                                <Th>Community</Th>\r\n                                <Th>Type</Th>\r\n                                <Th>Category</Th>\r\n                                <Th>Subcategory</Th>\r\n                                <Th>Period</Th>\r\n                                <Th>GL Code</Th>\r\n                                <Th>Method</Th>\r\n                                <Th>Driver</Th>\r\n                                <Th className=\"text-right\">Amount</Th>\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody className=\"divide-y divide-slate-100 bg-white text-sm\">\r\n                            {lines.map((l, idx) => (\r\n                                <tr\r\n                                    key={`${l.community}-${l.category}-${l.subCategory ?? \"\"}-${idx}`}\r\n                                    className=\"hover:bg-slate-50 focus-within:bg-slate-50\"\r\n                                >\r\n                                    <Td>{l.community}</Td>\r\n                                    <Td className=\"capitalize\">{l.type}</Td>\r\n                                    <Td>{l.category}</Td>\r\n                                    <Td>{l.subCategory ?? \"—\"}</Td>\r\n                                    <Td>{l.period ?? \"—\"}</Td>\r\n                                    <Td>{l.glCode ?? \"—\"}</Td>\r\n                                    <Td>{l.budgetMethod ?? \"—\"}</Td>\r\n                                    <Td>{l.driver ?? l.driverTag ?? \"—\"}</Td>\r\n                                    <Td className=\"text-right\">\r\n                                        {typeof l.amount === \"number\" ? fmtCurrency(l.amount) : \"—\"}\r\n                                    </Td>\r\n                                </tr>\r\n                            ))}\r\n                        </tbody>\r\n                    </table>\r\n                </div>\r\n\r\n                <div\r\n                    role=\"note\"\r\n                    className=\"rounded-lg border border-dashed border-slate-300 bg-slate-50 px-3 py-2 text-xs text-slate-600\"\r\n                >\r\n                    <strong>Next step:</strong> Replace the table with an interactive grid\r\n                    (grouping • filtering • bulk edit • totals by group). No layout change\r\n                    required—will mount here as <code>BudgetGrid</code>.\r\n                </div>\r\n            </section>\r\n        </div>\r\n    );\r\n}\r\n\r\n// ---- small presentational bits ----\r\n\r\nfunction Card({\r\n    title,\r\n    value,\r\n    testId,\r\n}: {\r\n    title: string;\r\n    value: string;\r\n    testId?: string;\r\n}) {\r\n    return (\r\n        <div\r\n            className=\"rounded-xl border border-slate-200 bg-white p-4 shadow-sm\"\r\n            data-testid={testId}\r\n        >\r\n            <p className=\"text-xs font-medium uppercase tracking-wide text-slate-500\">\r\n                {title}\r\n            </p>\r\n            <p className=\"mt-1 text-2xl font-semibold text-slate-900\">{value}</p>\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction Th({\r\n    children,\r\n    className = \"\",\r\n}: {\r\n    children: React.ReactNode;\r\n    className?: string;\r\n}) {\r\n    return (\r\n        <th\r\n            scope=\"col\"\r\n            className={`sticky top-0 z-[1] border-b border-slate-200 px-3 py-2 ${className}`}\r\n        >\r\n            {children}\r\n        </th>\r\n    );\r\n}\r\n\r\nfunction Td({\r\n    children,\r\n    className = \"\",\r\n}: {\r\n    children: React.ReactNode;\r\n    className?: string;\r\n}) {\r\n    return (\r\n        <td className={`px-3 py-2 align-top text-slate-800 ${className}`}>\r\n            {children}\r\n        </td>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}