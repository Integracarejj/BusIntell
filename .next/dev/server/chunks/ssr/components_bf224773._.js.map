{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/JeremyJoyner/code/budgetintelligence/components/grid/ToolbarFilters.tsx"],"sourcesContent":["\r\n\"use client\";\r\n\r\nimport * as React from \"react\";\r\nimport type { ColumnFiltersState, Table } from \"@tanstack/react-table\";\r\n\r\ntype Option = { label: string; value: string };\r\n\r\ntype ToolbarFiltersProps<TData extends object> = {\r\n    /** TanStack Table instance so we can derive options contextually (esp. Category) */\r\n    table: Table<TData>;\r\n    /** Current columnFilters state from the grid */\r\n    filters: ColumnFiltersState;\r\n    /** Setter from the grid */\r\n    setFilters: React.Dispatch<React.SetStateAction<ColumnFiltersState>>;\r\n    /** UI actions provided by the grid */\r\n    onClear: () => void;\r\n    onExport: () => void;\r\n    /** Optional override lists */\r\n    yearOptions?: string[];             // default: [\"2024\",\"2025\",\"2026\"]\r\n    typeOptions?: string[];             // default: [\"expense\",\"revenue\",\"home office\"]\r\n    /** Field accessors (defaults match your dataset) */\r\n    communityColumnId?: string;         // default: \"community\"\r\n    typeColumnId?: string;              // default: \"type\"\r\n    categoryColumnId?: string;          // default: \"category\"\r\n    yearHelperColumnId?: string;        // default: \"__year\"\r\n};\r\n\r\nexport default function ToolbarFilters<TData extends object>({\r\n    table,\r\n    filters,\r\n    setFilters,\r\n    onClear,\r\n    onExport,\r\n    yearOptions = [\"2024\", \"2025\", \"2026\"],\r\n    typeOptions = [\"expense\", \"revenue\", \"home office\"],\r\n    communityColumnId = \"community\",\r\n    typeColumnId = \"type\",\r\n    categoryColumnId = \"category\",\r\n    yearHelperColumnId = \"__year\",\r\n}: ToolbarFiltersProps<TData>) {\r\n    // ----- helpers -----\r\n    const getFilter = React.useCallback(\r\n        (id: string) => filters.find((f) => f.id === id)?.value as any,\r\n        [filters]\r\n    );\r\n\r\n    const setFilter = React.useCallback(\r\n        (id: string, value: any) => {\r\n            setFilters((old) => {\r\n                const others = old.filter((f) => f.id !== id);\r\n                if (value == null || (Array.isArray(value) && value.length === 0)) return others;\r\n                return [...others, { id, value }];\r\n            });\r\n            // clear row selection when filters change\r\n            table.resetRowSelection();\r\n        },\r\n        [setFilters, table]\r\n    );\r\n\r\n    // ----- current selections -----\r\n    const selectedCommunities: string[] = (getFilter(communityColumnId) as string[]) ?? [];\r\n    const selectedYear: string | null = (getFilter(yearHelperColumnId) as string | null) ?? null;\r\n    const selectedType: string | null = (getFilter(typeColumnId) as string | null) ?? null;\r\n    const selectedCategories: string[] = (getFilter(categoryColumnId) as string[]) ?? [];\r\n\r\n    // ----- option derivation -----\r\n    const communityOptions: Option[] = React.useMemo(() => {\r\n        const set = new Set<string>();\r\n        table.getPreFilteredRowModel().rows.forEach((r) => {\r\n            const v = String(r.getValue(communityColumnId) ?? \"\");\r\n            if (v) set.add(v);\r\n        });\r\n        return Array.from(set).sort((a, b) => a.localeCompare(b)).map((v) => ({ value: v, label: v }));\r\n    }, [table, communityColumnId]);\r\n\r\n    const yearOpts: Option[] = React.useMemo(\r\n        () => yearOptions.map((y) => ({ value: y, label: y })),\r\n        [yearOptions]\r\n    );\r\n\r\n    const typeOpts: Option[] = React.useMemo(\r\n        () => typeOptions.map((t) => ({ value: t, label: t })),\r\n        [typeOptions]\r\n    );\r\n\r\n    // Category options reflect current (Community, Year, Type)\r\n    const categoryOptions: Option[] = React.useMemo(() => {\r\n        const rows = table.getPreFilteredRowModel().rows.filter((r) => {\r\n            const commPass =\r\n                selectedCommunities.length === 0 ||\r\n                selectedCommunities.includes(String(r.getValue(communityColumnId) ?? \"\"));\r\n            const typePass = !selectedType || String(r.getValue(typeColumnId) ?? \"\") === selectedType;\r\n            const yr = String(r.getValue(yearHelperColumnId) ?? \"\");\r\n            const yearPass = !selectedYear || yr === selectedYear;\r\n            return commPass && typePass && yearPass;\r\n        });\r\n        const set = new Set<string>();\r\n        rows.forEach((rr) => {\r\n            const v = String(rr.getValue(categoryColumnId) ?? \"\");\r\n            if (v) set.add(v);\r\n        });\r\n        return Array.from(set).sort((a, b) => a.localeCompare(b)).map((v) => ({ value: v, label: v }));\r\n    }, [\r\n        table,\r\n        communityColumnId,\r\n        typeColumnId,\r\n        categoryColumnId,\r\n        yearHelperColumnId,\r\n        selectedCommunities,\r\n        selectedType,\r\n        selectedYear,\r\n    ]);\r\n\r\n    const anyFilterActive = filters.length > 0;\r\n\r\n    // ----- UI -----\r\n    return (\r\n        <div className=\"flex flex-wrap items-center gap-2 rounded-xl border border-slate-200 bg-white p-3 shadow-sm\">\r\n            {/* Community (multi) */}\r\n            <MultiSelect\r\n                aria-label=\"Filter by community\"\r\n                label=\"Community\"\r\n                values={selectedCommunities}\r\n                options={communityOptions}\r\n                onChange={(vals) => setFilter(communityColumnId, vals)}\r\n                className=\"mr-1\"\r\n            />\r\n\r\n            {/* Year (single) */}\r\n            <SingleSelect\r\n                aria-label=\"Filter by year\"\r\n                label=\"Year\"\r\n                value={selectedYear}\r\n                options={yearOpts}\r\n                onChange={(val) => setFilter(yearHelperColumnId, val)}\r\n                className=\"mr-1\"\r\n            />\r\n\r\n            {/* Budget Type (single) */}\r\n            <SingleSelect\r\n                aria-label=\"Filter by budget type\"\r\n                label=\"Budget Type\"\r\n                value={selectedType}\r\n                options={typeOpts}\r\n                onChange={(val) => setFilter(typeColumnId, val)}\r\n                className=\"mr-1\"\r\n            />\r\n\r\n            {/* Category (multi) */}\r\n            <MultiSelect\r\n                aria-label=\"Filter by category\"\r\n                label=\"Category\"\r\n                values={selectedCategories}\r\n                options={categoryOptions}\r\n                onChange={(vals) => setFilter(categoryColumnId, vals)}\r\n                className=\"mr-1\"\r\n            />\r\n\r\n            {/* Spacer */}\r\n            <div className=\"grow\" />\r\n\r\n            {/* Filters active badge */}\r\n            {anyFilterActive && (\r\n                <span className=\"rounded-full bg-slate-100 px-2 py-1 text-xs font-medium text-slate-600\">\r\n                    {filters.length} filter{filters.length > 1 ? \"s\" : \"\"} active\r\n                </span>\r\n            )}\r\n\r\n            <button\r\n                type=\"button\"\r\n                onClick={onClear}\r\n                className=\"rounded-md border border-slate-300 bg-white px-3 py-1.5 text-sm font-medium text-slate-700 shadow-sm hover:bg-slate-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-teal-500\"\r\n            >\r\n                Clear Filters\r\n            </button>\r\n            <button\r\n                type=\"button\"\r\n                onClick={onExport}\r\n                className=\"rounded-md border border-slate-300 bg-white px-3 py-1.5 text-sm font-medium text-slate-700 shadow-sm hover:bg-slate-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-teal-500\"\r\n            >\r\n                Export CSV\r\n            </button>\r\n        </div>\r\n    );\r\n}\r\n\r\n/* ========================== Headless Inputs ========================== */\r\n\r\nfunction useClickOutsideClose<T extends HTMLElement>(onClose: () => void) {\r\n    const ref = React.useRef<T | null>(null);\r\n    React.useEffect(() => {\r\n        const onDocClick = (e: MouseEvent) => {\r\n            if (!ref.current) return;\r\n            if (!ref.current.contains(e.target as Node)) onClose();\r\n        };\r\n        const onEsc = (e: KeyboardEvent) => {\r\n            if (e.key === \"Escape\") onClose();\r\n        };\r\n        document.addEventListener(\"mousedown\", onDocClick);\r\n        document.addEventListener(\"keydown\", onEsc);\r\n        return () => {\r\n            document.removeEventListener(\"mousedown\", onDocClick);\r\n            document.removeEventListener(\"keydown\", onEsc);\r\n        };\r\n    }, [onClose]);\r\n    return ref;\r\n}\r\n\r\nfunction SingleSelect({\r\n    label,\r\n    value,\r\n    options,\r\n    onChange,\r\n    className,\r\n    \"aria-label\": ariaLabel,\r\n}: {\r\n    label: string; // control name when empty\r\n    value: string | null;\r\n    options: Option[];\r\n    onChange: (val: string | null) => void;\r\n    className?: string;\r\n    \"aria-label\"?: string;\r\n}) {\r\n    const [open, setOpen] = React.useState(false);\r\n    const ref = useClickOutsideClose<HTMLDivElement>(() => setOpen(false));\r\n    const current = options.find((o) => o.value === value);\r\n    const displayText = current ? current.label : label;\r\n\r\n    return (\r\n        <div className={`relative ${className ?? \"\"}`} ref={ref}>\r\n            <button\r\n                type=\"button\"\r\n                aria-label={ariaLabel || label}\r\n                onClick={() => setOpen((o) => !o)}\r\n                className=\"inline-flex min-w-[168px] items-center justify-between rounded-md border border-slate-300 bg-white px-2.5 py-1.5 text-sm text-slate-800 shadow-sm hover:bg-slate-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-teal-500\"\r\n            >\r\n                <span className={`truncate ${current ? \"\" : \"text-slate-500\"}`}>{displayText}</span>\r\n                <Caret />\r\n            </button>\r\n            {open && (\r\n                <div role=\"listbox\" className=\"absolute z-40 mt-1 max-h-64 w-[min(280px,calc(100vw-2rem))] overflow-auto rounded-md border border-slate-200 bg-white p-1 shadow-lg\">\r\n                    <button\r\n                        className=\"w-full rounded px-2 py-1 text-left text-sm text-slate-700 hover:bg-slate-100\"\r\n                        onClick={() => { onChange(null); setOpen(false); }}\r\n                    >\r\n                        All\r\n                    </button>\r\n                    <div className=\"my-1 h-px bg-slate-100\" />\r\n                    {options.map((opt) => (\r\n                        <button\r\n                            key={opt.value}\r\n                            role=\"option\"\r\n                            aria-selected={opt.value === value}\r\n                            className={`w-full rounded px-2 py-1 text-left text-sm hover:bg-slate-100 ${opt.value === value ? \"bg-teal-50 text-teal-700\" : \"text-slate-700\"}`}\r\n                            onClick={() => { onChange(opt.value); setOpen(false); }}\r\n                        >\r\n                            {opt.label}\r\n                        </button>\r\n                    ))}\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction MultiSelect({\r\n    label,\r\n    values,\r\n    options,\r\n    onChange,\r\n    searchable = true,\r\n    className,\r\n    \"aria-label\": ariaLabel,\r\n}: {\r\n    label: string; // control name when empty\r\n    values: string[];\r\n    options: Option[];\r\n    onChange: (vals: string[]) => void;\r\n    searchable?: boolean;\r\n    className?: string;\r\n    \"aria-label\"?: string;\r\n}) {\r\n    const [open, setOpen] = React.useState(false);\r\n    const [query, setQuery] = React.useState(\"\");\r\n    const ref = useClickOutsideClose<HTMLDivElement>(() => setOpen(false));\r\n\r\n    const display =\r\n        values.length === 0\r\n            ? label\r\n            : values.length <= 2\r\n                ? options.filter((o) => values.includes(o.value)).map((o) => o.label).join(\", \")\r\n                : `${values.length} selected`;\r\n\r\n    const filtered = React.useMemo(() => {\r\n        if (!searchable || !query.trim()) return options;\r\n        const q = query.toLowerCase();\r\n        return options.filter((o) => o.label.toLowerCase().includes(q));\r\n    }, [options, searchable, query]);\r\n\r\n    const toggle = (val: string) => {\r\n        if (values.includes(val)) onChange(values.filter((v) => v !== val));\r\n        else onChange([...values, val]);\r\n    };\r\n\r\n    const selectAll = () => onChange(options.map((o) => o.value));\r\n    const clearAll = () => onChange([]);\r\n\r\n    return (\r\n        <div className={`relative ${className ?? \"\"}`} ref={ref}>\r\n            <button\r\n                type=\"button\"\r\n                aria-label={ariaLabel || label}\r\n                onClick={() => setOpen((o) => !o)}\r\n                className=\"inline-flex min-w-[220px] items-center justify-between rounded-md border border-slate-300 bg-white px-2.5 py-1.5 text-sm text-slate-800 shadow-sm hover:bg-slate-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-teal-500\"\r\n            >\r\n                <span className={`truncate ${values.length === 0 ? \"text-slate-500\" : \"\"}`}>{display}</span>\r\n                <Caret />\r\n            </button>\r\n            {open && (\r\n                <div role=\"listbox\" className=\"absolute z-40 mt-1 max-h-72 w-[min(420px,calc(100vw-2rem))] overflow-auto rounded-md border border-slate-200 bg-white p-2 shadow-lg\">\r\n                    {searchable && (\r\n                        <div className=\"mb-2\">\r\n                            <input\r\n                                autoFocus\r\n                                type=\"text\"\r\n                                placeholder=\"Search…\"\r\n                                value={query}\r\n                                onChange={(e) => setQuery(e.target.value)}\r\n                                className=\"w-full rounded border border-slate-300 px-2 py-1 text-sm\"\r\n                            />\r\n                        </div>\r\n                    )}\r\n                    <div className=\"flex items-center justify-between px-1 pb-2\">\r\n                        <div className=\"text-xs text-slate-500\">{options.length} options</div>\r\n                        <div className=\"space-x-2\">\r\n                            <button className=\"rounded bg-slate-100 px-2 py-0.5 text-xs hover:bg-slate-200\" onClick={selectAll}>\r\n                                Select all\r\n                            </button>\r\n                            <button className=\"rounded bg-slate-100 px-2 py-0.5 text-xs hover:bg-slate-200\" onClick={clearAll}>\r\n                                Clear\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                    <ul className=\"space-y-0.5\">\r\n                        {filtered.map((opt) => {\r\n                            const checked = values.includes(opt.value);\r\n                            return (\r\n                                <li key={opt.value}>\r\n                                    <label className=\"flex cursor-pointer items-center gap-2 rounded px-2 py-1 text-sm hover:bg-slate-50\">\r\n                                        <input\r\n                                            type=\"checkbox\"\r\n                                            className=\"h-3.5 w-3.5 accent-teal-600\"\r\n                                            checked={checked}\r\n                                            onChange={() => toggle(opt.value)}\r\n                                        />\r\n                                        <span className={checked ? \"text-teal-700\" : \"text-slate-700\"}>{opt.label}</span>\r\n                                    </label>\r\n                                </li>\r\n                            );\r\n                        })}\r\n                    </ul>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction Caret() {\r\n    return (\r\n        <svg viewBox=\"0 0 20 20\" aria-hidden=\"true\" className=\"ml-2 h-4 w-4 text-slate-500\">\r\n            <path d=\"M5.25 7.5l4.5 4.5 4.5-4.5\" stroke=\"currentColor\" strokeWidth=\"1.8\" fill=\"none\" strokeLinecap=\"round\" />\r\n        </svg>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 513, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/JeremyJoyner/code/budgetintelligence/components/grid/VirtualRows.tsx"],"sourcesContent":["\r\n// components/grid/VirtualRows.tsx\r\n\"use client\";\r\n\r\nimport * as React from \"react\";\r\nimport { useVirtualizer } from \"@tanstack/react-virtual\";\r\nimport { flexRender, type Table } from \"@tanstack/react-table\";\r\n\r\n/**\r\n * VirtualRows — scrollable virtualized body for TanStack Table.\r\n * Hides helper columns (e.g., meta.hiddenHelper) automatically.\r\n */\r\n\r\nexport default function VirtualRows<TData extends object>({\r\n    table,\r\n    height = 720,\r\n    rowClassName,\r\n    toggleSelectOnRowClick = true,\r\n    \"aria-label\": ariaLabel = \"Virtualized grid body\",\r\n}: {\r\n    table: Table<TData>;\r\n    height?: number;\r\n    rowClassName?: (rowIndex: number) => string | undefined;\r\n    toggleSelectOnRowClick?: boolean;\r\n    \"aria-label\"?: string;\r\n}) {\r\n    const parentRef = React.useRef<HTMLDivElement>(null);\r\n\r\n    const rows = table.getRowModel().rows;\r\n    const virtualizer = useVirtualizer({\r\n        count: rows.length,\r\n        getScrollElement: () => parentRef.current,\r\n        estimateSize: () => 40,\r\n        overscan: 8,\r\n    });\r\n    const virtualItems = virtualizer.getVirtualItems();\r\n\r\n    return (\r\n        <div\r\n            ref={parentRef}\r\n            className=\"border-x border-b border-slate-200\"\r\n            style={{ height, overflow: \"auto\", position: \"relative\" }}\r\n            aria-label={ariaLabel}\r\n        >\r\n            <div style={{ height: virtualizer.getTotalSize(), position: \"relative\" }}>\r\n                {virtualItems.map((vi) => {\r\n                    const row = rows[vi.index];\r\n\r\n                    // Only render visible, non-helper columns\r\n                    const visibleCells = row\r\n                        .getVisibleCells()\r\n                        .filter((c) => !(c.column.columnDef as any)?.meta?.hiddenHelper);\r\n\r\n                    const cls =\r\n                        rowClassName?.(vi.index) ??\r\n                        `grid grid-cols-[repeat(var(--cols),minmax(140px,1fr))] border-b border-slate-100 px-2 text-sm ${row.getIsSelected() ? \"bg-teal-50\" : \"bg-white\"\r\n                        } hover:bg-slate-50`;\r\n\r\n                    return (\r\n                        <div\r\n                            key={row.id}\r\n                            className={cls}\r\n                            style={{\r\n                                transform: `translateY(${vi.start}px)`,\r\n                                [\"--cols\" as any]: visibleCells.length,\r\n                                height: vi.size,\r\n                                alignItems: \"center\",\r\n                            }}\r\n                            onClick={() => toggleSelectOnRowClick && row.toggleSelected()}\r\n                        >\r\n                            {visibleCells.map((cell) => (\r\n                                <div key={cell.id} className=\"pr-2\">\r\n                                    {flexRender(cell.column.columnDef.cell, cell.getContext())}\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    );\r\n                })}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;AAIA;AACA;AACA;AALA,kCAAkC;AAClC;;;;;AAWe,SAAS,YAAkC,EACtD,KAAK,EACL,SAAS,GAAG,EACZ,YAAY,EACZ,yBAAyB,IAAI,EAC7B,cAAc,YAAY,uBAAuB,EAOpD;IACG,MAAM,YAAY,+MAAY,CAAiB;IAE/C,MAAM,OAAO,MAAM,WAAW,GAAG,IAAI;IACrC,MAAM,cAAc,IAAA,wMAAc,EAAC;QAC/B,OAAO,KAAK,MAAM;QAClB,kBAAkB,IAAM,UAAU,OAAO;QACzC,cAAc,IAAM;QACpB,UAAU;IACd;IACA,MAAM,eAAe,YAAY,eAAe;IAEhD,qBACI,8OAAC;QACG,KAAK;QACL,WAAU;QACV,OAAO;YAAE;YAAQ,UAAU;YAAQ,UAAU;QAAW;QACxD,cAAY;kBAEZ,cAAA,8OAAC;YAAI,OAAO;gBAAE,QAAQ,YAAY,YAAY;gBAAI,UAAU;YAAW;sBAClE,aAAa,GAAG,CAAC,CAAC;gBACf,MAAM,MAAM,IAAI,CAAC,GAAG,KAAK,CAAC;gBAE1B,0CAA0C;gBAC1C,MAAM,eAAe,IAChB,eAAe,GACf,MAAM,CAAC,CAAC,IAAM,CAAE,EAAE,MAAM,CAAC,SAAS,EAAU,MAAM;gBAEvD,MAAM,MACF,eAAe,GAAG,KAAK,KACvB,CAAC,8FAA8F,EAAE,IAAI,aAAa,KAAK,eAAe,WACrI,kBAAkB,CAAC;gBAExB,qBACI,8OAAC;oBAEG,WAAW;oBACX,OAAO;wBACH,WAAW,CAAC,WAAW,EAAE,GAAG,KAAK,CAAC,GAAG,CAAC;wBACtC,CAAC,SAAgB,EAAE,aAAa,MAAM;wBACtC,QAAQ,GAAG,IAAI;wBACf,YAAY;oBAChB;oBACA,SAAS,IAAM,0BAA0B,IAAI,cAAc;8BAE1D,aAAa,GAAG,CAAC,CAAC,qBACf,8OAAC;4BAAkB,WAAU;sCACxB,IAAA,oMAAU,EAAC,KAAK,MAAM,CAAC,SAAS,CAAC,IAAI,EAAE,KAAK,UAAU;2BADjD,KAAK,EAAE;;;;;mBAXhB,IAAI,EAAE;;;;;YAiBvB;;;;;;;;;;;AAIhB"}},
    {"offset": {"line": 594, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/JeremyJoyner/code/budgetintelligence/components/grid/AmountCell.tsx"],"sourcesContent":["\r\n\"use client\";\r\n\r\nimport * as React from \"react\";\r\n\r\n/**\r\n * AmountCell — standalone inline editor for the \"Amount\" column.\r\n * - Click to enter edit mode\r\n * - Commit on Enter/blur; Escape cancels\r\n * - Persists via table.options.meta.updateRow(rowIndex, { amount: next })\r\n *\r\n * Requirements from parent table:\r\n *   - The TanStack Table instance must define `meta.updateRow(index, partial)`\r\n *     which will update backing data (see BudgetGrid.tanstack.tsx).\r\n */\r\n\r\nexport default function AmountCell({\r\n    getValue,\r\n    row,\r\n    table,\r\n}: {\r\n    getValue: () => number | null | undefined;\r\n    row: any;\r\n    table: any;\r\n}) {\r\n    const initial = getValue();\r\n    const [editing, setEditing] = React.useState(false);\r\n    const [draft, setDraft] = React.useState<number | \"\">(\r\n        typeof initial === \"number\" ? initial : initial == null ? \"\" : Number(initial)\r\n    );\r\n\r\n    // Format helper (display only)\r\n    const fmtUSD = React.useCallback(\r\n        (n: number) =>\r\n            new Intl.NumberFormat(\"en-US\", {\r\n                style: \"currency\",\r\n                currency: \"USD\",\r\n                maximumFractionDigits: 0,\r\n            }).format(n),\r\n        []\r\n    );\r\n\r\n    const commit = () => {\r\n        const next = draft === \"\" ? null : Number(draft);\r\n        table.options.meta?.updateRow?.(row.index, { amount: next });\r\n        setEditing(false);\r\n    };\r\n\r\n    const cancel = () => {\r\n        // Revert to current value in the row\r\n        const current = getValue();\r\n        setDraft(typeof current === \"number\" ? current : current == null ? \"\" : Number(current));\r\n        setEditing(false);\r\n    };\r\n\r\n    return (\r\n        <div className=\"text-right\">\r\n            {editing ? (\r\n                <input\r\n                    autoFocus\r\n                    type=\"number\"\r\n                    step={1}\r\n                    className=\"w-full rounded border border-slate-300 px-2 py-1 text-right text-sm\"\r\n                    value={draft}\r\n                    onChange={(e) => setDraft(e.target.value === \"\" ? \"\" : Number(e.target.value))}\r\n                    onBlur={commit}\r\n                    onKeyDown={(e) => {\r\n                        if (e.key === \"Enter\") commit();\r\n                        if (e.key === \"Escape\") cancel();\r\n                    }}\r\n                />\r\n            ) : (\r\n                <button\r\n                    className=\"w-full text-right tabular-nums\"\r\n                    onClick={() => setEditing(true)}\r\n                    title=\"Click to edit\"\r\n                >\r\n                    {typeof initial === \"number\" ? fmtUSD(initial) : \"—\"}\r\n                </button>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;AAGA;AAFA;;;AAee,SAAS,WAAW,EAC/B,QAAQ,EACR,GAAG,EACH,KAAK,EAKR;IACG,MAAM,UAAU;IAChB,MAAM,CAAC,SAAS,WAAW,GAAG,iNAAc,CAAC;IAC7C,MAAM,CAAC,OAAO,SAAS,GAAG,iNAAc,CACpC,OAAO,YAAY,WAAW,UAAU,WAAW,OAAO,KAAK,OAAO;IAG1E,+BAA+B;IAC/B,MAAM,SAAS,oNAAiB,CAC5B,CAAC,IACG,IAAI,KAAK,YAAY,CAAC,SAAS;YAC3B,OAAO;YACP,UAAU;YACV,uBAAuB;QAC3B,GAAG,MAAM,CAAC,IACd,EAAE;IAGN,MAAM,SAAS;QACX,MAAM,OAAO,UAAU,KAAK,OAAO,OAAO;QAC1C,MAAM,OAAO,CAAC,IAAI,EAAE,YAAY,IAAI,KAAK,EAAE;YAAE,QAAQ;QAAK;QAC1D,WAAW;IACf;IAEA,MAAM,SAAS;QACX,qCAAqC;QACrC,MAAM,UAAU;QAChB,SAAS,OAAO,YAAY,WAAW,UAAU,WAAW,OAAO,KAAK,OAAO;QAC/E,WAAW;IACf;IAEA,qBACI,8OAAC;QAAI,WAAU;kBACV,wBACG,8OAAC;YACG,SAAS;YACT,MAAK;YACL,MAAM;YACN,WAAU;YACV,OAAO;YACP,UAAU,CAAC,IAAM,SAAS,EAAE,MAAM,CAAC,KAAK,KAAK,KAAK,KAAK,OAAO,EAAE,MAAM,CAAC,KAAK;YAC5E,QAAQ;YACR,WAAW,CAAC;gBACR,IAAI,EAAE,GAAG,KAAK,SAAS;gBACvB,IAAI,EAAE,GAAG,KAAK,UAAU;YAC5B;;;;;iCAGJ,8OAAC;YACG,WAAU;YACV,SAAS,IAAM,WAAW;YAC1B,OAAM;sBAEL,OAAO,YAAY,WAAW,OAAO,WAAW;;;;;;;;;;;AAKrE"}},
    {"offset": {"line": 664, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/JeremyJoyner/code/budgetintelligence/components/grid/ColumnMenu.tsx"],"sourcesContent":["\r\n// components/grid/ColumnMenu.tsx\r\nimport * as React from \"react\";\r\nimport { Column, Table } from \"@tanstack/react-table\";\r\n\r\n/**\r\n * Lightweight headless column menu for TanStack Table v8.\r\n * Zero deps (Tailwind for styling only).\r\n */\r\n\r\ntype Props<TData> = {\r\n    table: Table<TData>;\r\n    column: Column<TData, unknown>;\r\n};\r\n\r\nfunction useOutsideClick(\r\n    ref: React.RefObject<HTMLElement | null>,\r\n    onClickAway: () => void\r\n) {\r\n    React.useEffect(() => {\r\n        function handler(e: MouseEvent) {\r\n            const el = ref.current;\r\n            if (!el) return;\r\n            if (!el.contains(e.target as Node)) onClickAway();\r\n        }\r\n        document.addEventListener(\"mousedown\", handler);\r\n        return () => document.removeEventListener(\"mousedown\", handler);\r\n    }, [onClickAway, ref]);\r\n}\r\n\r\nexport default function ColumnMenu<TData>({ table, column }: Props<TData>) {\r\n    const [open, setOpen] = React.useState(false);\r\n    const btnRef = React.useRef<HTMLButtonElement>(null);\r\n    const popRef = React.useRef<HTMLDivElement>(null);\r\n\r\n    // Close on outside click\r\n    useOutsideClick(popRef as React.RefObject<HTMLElement | null>, () => setOpen(false));\r\n\r\n    // Close on escape\r\n    React.useEffect(() => {\r\n        function onKey(e: KeyboardEvent) {\r\n            if (e.key === \"Escape\") setOpen(false);\r\n        }\r\n        document.addEventListener(\"keydown\", onKey);\r\n        return () => document.removeEventListener(\"keydown\", onKey);\r\n    }, []);\r\n\r\n    const pinState = column.getIsPinned(); // 'left' | 'right' | false\r\n    const isVisible = column.getIsVisible();\r\n    const canSort = column.getCanSort();\r\n    const hasFilter = Boolean(column.getFilterValue());\r\n\r\n    // Auto-size via table.setColumnSizing()\r\n    const autoSize = React.useCallback(() => {\r\n        const ctx = document.createElement(\"canvas\").getContext(\"2d\");\r\n        if (!ctx) return;\r\n\r\n        const computed = window.getComputedStyle(document.body);\r\n        ctx.font = `${computed.fontSize} ${computed.fontFamily}`;\r\n\r\n        const padding = 24;\r\n        const sampleRows = table.getPrePaginationRowModel().rows.slice(0, 100);\r\n\r\n        const measure = (txt: unknown) =>\r\n            Math.ceil(ctx.measureText((txt ?? \"\").toString()).width);\r\n\r\n        const headerLabel =\r\n            typeof column.columnDef.header === \"string\"\r\n                ? column.columnDef.header\r\n                : column.id;\r\n\r\n        const headerW = measure(headerLabel);\r\n        const cellW = sampleRows.reduce((max, r) => {\r\n            const v = r.getValue(column.id);\r\n            return Math.max(max, measure(v));\r\n        }, 0);\r\n\r\n        const desired = Math.max(headerW, cellW) + padding;\r\n        const min = (column.columnDef.minSize as number) ?? 60;\r\n        const max = (column.columnDef.maxSize as number) ?? 700;\r\n        const clamped = Math.max(min, Math.min(desired, max));\r\n\r\n        table.setColumnSizing((prev) => ({ ...prev, [column.id]: clamped }));\r\n    }, [column, table]);\r\n\r\n    const resetWidth = React.useCallback(() => {\r\n        // Reset to no explicit size; TanStack will use default size or CSS.\r\n        table.setColumnSizing((prev) => {\r\n            const { [column.id]: _, ...rest } = prev || {};\r\n            return rest;\r\n        });\r\n    }, [column.id, table]);\r\n\r\n    const togglePin = (side: \"left\" | \"right\" | false) => {\r\n        column.pin(side);\r\n    };\r\n\r\n    const toggleVisibility = () => column.toggleVisibility(!isVisible);\r\n\r\n    const sortAsc = () => column.toggleSorting(true);\r\n    const sortDesc = () => column.toggleSorting(false);\r\n    const clearFilter = () => column.setFilterValue(undefined);\r\n\r\n    return (\r\n        <div className=\"relative inline-flex\">\r\n            <button\r\n                ref={btnRef}\r\n                type=\"button\"\r\n                className=\"ml-1 inline-flex h-6 w-6 items-center justify-center rounded hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-primary-500\"\r\n                aria-haspopup=\"menu\"\r\n                aria-expanded={open}\r\n                title=\"Column menu\"\r\n                onClick={() => setOpen((o) => !o)}\r\n            >\r\n                <svg viewBox=\"0 0 24 24\" className=\"h-4 w-4 text-gray-600\" fill=\"currentColor\">\r\n                    <circle cx=\"5\" cy=\"12\" r=\"2\" />\r\n                    <circle cx=\"12\" cy=\"12\" r=\"2\" />\r\n                    <circle cx=\"19\" cy=\"12\" r=\"2\" />\r\n                </svg>\r\n            </button>\r\n\r\n            {open && (\r\n                <div\r\n                    ref={popRef}\r\n                    role=\"menu\"\r\n                    className=\"absolute right-0 z-50 mt-2 w-52 overflow-hidden rounded-md border border-gray-200 bg-white shadow-lg\"\r\n                >\r\n                    <Section label={String(column.columnDef.header ?? column.id)} />\r\n\r\n                    <Item onClick={toggleVisibility}>\r\n                        {isVisible ? \"Hide column\" : \"Show column\"}\r\n                    </Item>\r\n\r\n                    <Separator />\r\n\r\n                    <Item onClick={() => togglePin(\"left\")} active={pinState === \"left\"}>\r\n                        Pin left\r\n                    </Item>\r\n                    <Item onClick={() => togglePin(\"right\")} active={pinState === \"right\"}>\r\n                        Pin right\r\n                    </Item>\r\n                    {pinState && <Item onClick={() => togglePin(false)}>Unpin</Item>}\r\n\r\n                    <Separator />\r\n\r\n                    <Item onClick={sortAsc} disabled={!canSort}>Sort ascending</Item>\r\n                    <Item onClick={sortDesc} disabled={!canSort}>Sort descending</Item>\r\n                    <Item onClick={clearFilter} disabled={!hasFilter}>Clear filter</Item>\r\n\r\n                    <Separator />\r\n\r\n                    <Item onClick={autoSize}>Auto‑size column</Item>\r\n                    <Item onClick={resetWidth}>Reset width</Item>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction Section({ label }: { label: string }) {\r\n    return (\r\n        <div className=\"px-3 py-2 text-xs font-semibold uppercase tracking-wide text-gray-500\">\r\n            {label}\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction Separator() {\r\n    return <div className=\"my-1 h-px bg-gray-100\" />;\r\n}\r\n\r\nfunction Item({\r\n    children,\r\n    onClick,\r\n    disabled,\r\n    active,\r\n}: {\r\n    children: React.ReactNode;\r\n    onClick: () => void;\r\n    disabled?: boolean;\r\n    active?: boolean;\r\n}) {\r\n    const base =\r\n        \"w-full px-3 py-2 text-left text-sm hover:bg-gray-50 focus:bg-gray-50 focus:outline-none\";\r\n    const styles = [\r\n        base,\r\n        disabled ? \"cursor-not-allowed text-gray-300\" : \"text-gray-800\",\r\n        active ? \"bg-gray-50 font-medium\" : \"\",\r\n    ].join(\" \");\r\n    return (\r\n        <button type=\"button\" className={styles} onClick={!disabled ? onClick : undefined} disabled={disabled}>\r\n            {children}\r\n        </button>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 962, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/JeremyJoyner/code/budgetintelligence/components/grid/export.ts"],"sourcesContent":["\r\n// components/grid/export.ts\r\n\r\n/**\r\n * Lightweight export utilities. CSV works without extra deps.\r\n * XLSX tries to dynamically import 'xlsx' if available.\r\n */\r\n\r\nimport type { ColumnDef } from \"@tanstack/react-table\";\r\n\r\nfunction escapeCsv(value: any) {\r\n    if (value === null || value === undefined) return \"\";\r\n    const str = String(value);\r\n    return /[\",\\n]/.test(str) ? `\"${str.replace(/\"/g, '\"\"')}\"` : str;\r\n}\r\n\r\n/**\r\n * exportRowsToCsv\r\n * Exports the provided row objects using the table's column order/ids.\r\n */\r\nexport function exportRowsToCsv<T extends object>(\r\n    rows: T[],\r\n    columns: ColumnDef<T, any>[],\r\n    fileName = \"budget-grid.csv\"\r\n) {\r\n    const colIds = columns\r\n        .map((c) =>\r\n            \"accessorKey\" in c && c.accessorKey\r\n                ? String(c.accessorKey)\r\n                : c.id\r\n                    ? String(c.id)\r\n                    : null\r\n        )\r\n        .filter(Boolean) as string[];\r\n\r\n    const header = colIds.join(\",\");\r\n    const body = rows\r\n        .map((r) => colIds.map((k) => escapeCsv((r as any)[k] ?? \"\")).join(\",\"))\r\n        .join(\"\\n\");\r\n\r\n    const csv = `${header}\\n${body}`;\r\n    const blob = new Blob([csv], { type: \"text/csv;charset=utf-8\" });\r\n    const a = document.createElement(\"a\");\r\n    a.href = URL.createObjectURL(blob);\r\n    a.download = fileName;\r\n    a.click();\r\n    URL.revokeObjectURL(a.href);\r\n}\r\n\r\n/**\r\n * exportRowsToXlsx (optional)\r\n * If 'xlsx' is not installed, logs a warning and returns.\r\n * To enable: `npm i xlsx` then call this function from your UI.\r\n */\r\nexport async function exportRowsToXlsx<T extends object>(\r\n    rows: T[],\r\n    columns: ColumnDef<T, any>[],\r\n    fileName = \"budget-grid.xlsx\"\r\n) {\r\n    try {\r\n        const XLSX = await import(\"xlsx\"); // requires 'xlsx' to be installed\r\n        const colIds = columns\r\n            .map((c) =>\r\n                \"accessorKey\" in c && c.accessorKey\r\n                    ? String(c.accessorKey)\r\n                    : c.id\r\n                        ? String(c.id)\r\n                        : null\r\n            )\r\n            .filter(Boolean) as string[];\r\n\r\n        const data = [\r\n            colIds, // header row\r\n            ...rows.map((r) => colIds.map((k) => (r as any)[k] ?? \"\")),\r\n        ];\r\n\r\n        const wb = XLSX.utils.book_new();\r\n        const ws = XLSX.utils.aoa_to_sheet(data);\r\n        XLSX.utils.book_append_sheet(wb, ws, \"Budget\");\r\n        XLSX.writeFile(wb, fileName);\r\n    } catch (err) {\r\n        // Non-fatal if xlsx isn't present; CSV is still available.\r\n        // eslint-disable-next-line no-console\r\n        console.warn(\r\n            \"[exportRowsToXlsx] 'xlsx' package not found. Install it with `npm i xlsx` to enable XLSX export.\"\r\n        );\r\n    }\r\n}\r\n\r\n"],"names":[],"mappings":"AACA,4BAA4B;AAE5B;;;CAGC;;;;;;AAID,SAAS,UAAU,KAAU;IACzB,IAAI,UAAU,QAAQ,UAAU,WAAW,OAAO;IAClD,MAAM,MAAM,OAAO;IACnB,OAAO,SAAS,IAAI,CAAC,OAAO,CAAC,CAAC,EAAE,IAAI,OAAO,CAAC,MAAM,MAAM,CAAC,CAAC,GAAG;AACjE;AAMO,SAAS,gBACZ,IAAS,EACT,OAA4B,EAC5B,WAAW,iBAAiB;IAE5B,MAAM,SAAS,QACV,GAAG,CAAC,CAAC,IACF,iBAAiB,KAAK,EAAE,WAAW,GAC7B,OAAO,EAAE,WAAW,IACpB,EAAE,EAAE,GACA,OAAO,EAAE,EAAE,IACX,MAEb,MAAM,CAAC;IAEZ,MAAM,SAAS,OAAO,IAAI,CAAC;IAC3B,MAAM,OAAO,KACR,GAAG,CAAC,CAAC,IAAM,OAAO,GAAG,CAAC,CAAC,IAAM,UAAU,AAAC,CAAS,CAAC,EAAE,IAAI,KAAK,IAAI,CAAC,MAClE,IAAI,CAAC;IAEV,MAAM,MAAM,GAAG,OAAO,EAAE,EAAE,MAAM;IAChC,MAAM,OAAO,IAAI,KAAK;QAAC;KAAI,EAAE;QAAE,MAAM;IAAyB;IAC9D,MAAM,IAAI,SAAS,aAAa,CAAC;IACjC,EAAE,IAAI,GAAG,IAAI,eAAe,CAAC;IAC7B,EAAE,QAAQ,GAAG;IACb,EAAE,KAAK;IACP,IAAI,eAAe,CAAC,EAAE,IAAI;AAC9B;AAOO,eAAe,iBAClB,IAAS,EACT,OAA4B,EAC5B,WAAW,kBAAkB;IAE7B,IAAI;QACA,MAAM,OAAO,4GAAsB,kCAAkC;QACrE,MAAM,SAAS,QACV,GAAG,CAAC,CAAC,IACF,iBAAiB,KAAK,EAAE,WAAW,GAC7B,OAAO,EAAE,WAAW,IACpB,EAAE,EAAE,GACA,OAAO,EAAE,EAAE,IACX,MAEb,MAAM,CAAC;QAEZ,MAAM,OAAO;YACT;eACG,KAAK,GAAG,CAAC,CAAC,IAAM,OAAO,GAAG,CAAC,CAAC,IAAM,AAAC,CAAS,CAAC,EAAE,IAAI;SACzD;QAED,MAAM,KAAK,KAAK,KAAK,CAAC,QAAQ;QAC9B,MAAM,KAAK,KAAK,KAAK,CAAC,YAAY,CAAC;QACnC,KAAK,KAAK,CAAC,iBAAiB,CAAC,IAAI,IAAI;QACrC,KAAK,SAAS,CAAC,IAAI;IACvB,EAAE,OAAO,KAAK;QACV,2DAA2D;QAC3D,sCAAsC;QACtC,QAAQ,IAAI,CACR;IAER;AACJ"}},
    {"offset": {"line": 1015, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/JeremyJoyner/code/budgetintelligence/components/grid/totals.ts"],"sourcesContent":["\r\n// components/grid/totals.ts\r\n\r\nimport type { Row } from \"@tanstack/react-table\";\r\n\r\n/**\r\n * Sums all numeric columns across the provided rows.\r\n * This works with TanStack filteredRowModel, paginationRowModel, etc.\r\n */\r\n\r\nexport function buildTotals(rows: Row<any>[]): Record<string, number> {\r\n    const totals: Record<string, number> = {};\r\n\r\n    for (const row of rows) {\r\n        const values = row.getAllCells().map((c) => ({\r\n            id: c.column.id,\r\n            value: c.getValue(),\r\n        }));\r\n\r\n        for (const { id, value } of values) {\r\n            if (typeof value === \"number\" && !isNaN(value)) {\r\n                totals[id] = (totals[id] ?? 0) + value;\r\n            }\r\n        }\r\n    }\r\n\r\n    return totals;\r\n}\r\n"],"names":[],"mappings":"AACA,4BAA4B;;;;;AASrB,SAAS,YAAY,IAAgB;IACxC,MAAM,SAAiC,CAAC;IAExC,KAAK,MAAM,OAAO,KAAM;QACpB,MAAM,SAAS,IAAI,WAAW,GAAG,GAAG,CAAC,CAAC,IAAM,CAAC;gBACzC,IAAI,EAAE,MAAM,CAAC,EAAE;gBACf,OAAO,EAAE,QAAQ;YACrB,CAAC;QAED,KAAK,MAAM,EAAE,EAAE,EAAE,KAAK,EAAE,IAAI,OAAQ;YAChC,IAAI,OAAO,UAAU,YAAY,CAAC,MAAM,QAAQ;gBAC5C,MAAM,CAAC,GAAG,GAAG,CAAC,MAAM,CAAC,GAAG,IAAI,CAAC,IAAI;YACrC;QACJ;IACJ;IAEA,OAAO;AACX"}},
    {"offset": {"line": 1039, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/JeremyJoyner/code/budgetintelligence/components/grid/filters.tsx"],"sourcesContent":["\r\n// components/grid/filters.ts\r\n\r\n/**\r\n * Reusable filter functions & helpers for TanStack Table.\r\n */\r\n\r\nimport type { Row } from \"@tanstack/react-table\";\r\n\r\n/**\r\n * multiIncludesSome\r\n * Matches when the cell's string value is contained in the selected array.\r\n * If the filter array is empty or not provided, the row passes.\r\n */\r\nexport function multiIncludesSome<TData>(\r\n    row: Row<TData>,\r\n    columnId: string,\r\n    filterValue: string[] | undefined\r\n) {\r\n    if (!Array.isArray(filterValue) || filterValue.length === 0) return true;\r\n    const v = String(row.getValue(columnId) ?? \"\");\r\n    return filterValue.includes(v);\r\n}\r\n\r\n/**\r\n * equalsString\r\n * Exact string match for single-select filters. Empty filter → pass.\r\n */\r\nexport function equalsString<TData>(\r\n    row: Row<TData>,\r\n    columnId: string,\r\n    filterValue: string | null | undefined\r\n) {\r\n    if (!filterValue) return true;\r\n    const v = String(row.getValue(columnId) ?? \"\");\r\n    return v === String(filterValue);\r\n}\r\n\r\n/**\r\n * parseYearFromPeriod\r\n * Supports values like \"2026-01\" or \"2026\" (also numbers).\r\n * Returns a 4-digit year string or null if not parseable.\r\n */\r\nexport function parseYearFromPeriod(\r\n    period: string | number | null | undefined\r\n): string | null {\r\n    if (period == null) return null;\r\n    const s = String(period);\r\n    const y = s.slice(0, 4);\r\n    return /^\\d{4}$/.test(y) ? y : null;\r\n}\r\n"],"names":[],"mappings":"AACA,6BAA6B;AAE7B;;CAEC;;;;;;;;AASM,SAAS,kBACZ,GAAe,EACf,QAAgB,EAChB,WAAiC;IAEjC,IAAI,CAAC,MAAM,OAAO,CAAC,gBAAgB,YAAY,MAAM,KAAK,GAAG,OAAO;IACpE,MAAM,IAAI,OAAO,IAAI,QAAQ,CAAC,aAAa;IAC3C,OAAO,YAAY,QAAQ,CAAC;AAChC;AAMO,SAAS,aACZ,GAAe,EACf,QAAgB,EAChB,WAAsC;IAEtC,IAAI,CAAC,aAAa,OAAO;IACzB,MAAM,IAAI,OAAO,IAAI,QAAQ,CAAC,aAAa;IAC3C,OAAO,MAAM,OAAO;AACxB;AAOO,SAAS,oBACZ,MAA0C;IAE1C,IAAI,UAAU,MAAM,OAAO;IAC3B,MAAM,IAAI,OAAO;IACjB,MAAM,IAAI,EAAE,KAAK,CAAC,GAAG;IACrB,OAAO,UAAU,IAAI,CAAC,KAAK,IAAI;AACnC"}},
    {"offset": {"line": 1070, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/JeremyJoyner/code/budgetintelligence/components/grid/columns.ts"],"sourcesContent":["\r\n// components/grid/columns.ts\r\nimport React from \"react\";\r\nimport type { ColumnDef, CellContext } from \"@tanstack/react-table\";\r\nimport AmountCell from \"./AmountCell\";\r\nimport { multiIncludesSome, equalsString, parseYearFromPeriod } from \"./filters\";\r\n\r\n/** Shared row type */\r\nexport type BudgetLine = {\r\n    type: \"revenue\" | \"expense\" | \"home office\" | string;\r\n    community: string;\r\n    category: string;\r\n    subCategory?: string | null;\r\n    budgetMethod?: string | null;\r\n    driver?: string | null;\r\n    driverTag?: string | null;\r\n    glCode?: string | null;\r\n    period?: string | number | null; // e.g., \"2026-01\" or \"2026\"\r\n    amount?: number | null;\r\n};\r\n\r\nexport function createBudgetColumns(): ColumnDef<BudgetLine, unknown>[] {\r\n    return [\r\n        {\r\n            id: \"community\",\r\n            accessorKey: \"community\",\r\n            header: \"Community\",\r\n            meta: { filterPlaceholder: \"filter…\" },\r\n            filterFn: multiIncludesSome,\r\n            enablePinning: true,\r\n        },\r\n        {\r\n            id: \"type\",\r\n            accessorKey: \"type\",\r\n            header: \"Type\",\r\n            size: 130,\r\n            filterFn: equalsString,\r\n        },\r\n        {\r\n            id: \"category\",\r\n            accessorKey: \"category\",\r\n            header: \"Category\",\r\n            filterFn: multiIncludesSome,\r\n        },\r\n        { id: \"subCategory\", accessorKey: \"subCategory\", header: \"Subcategory\" },\r\n        { id: \"period\", accessorKey: \"period\", header: \"Period\", size: 120 },\r\n        { id: \"glCode\", accessorKey: \"glCode\", header: \"GL Code\", size: 120 },\r\n        { id: \"budgetMethod\", accessorKey: \"budgetMethod\", header: \"Method\", size: 180 },\r\n        {\r\n            id: \"driver\",\r\n            header: \"Driver\",\r\n            accessorFn: (row) => row.driver ?? row.driverTag ?? null,\r\n        },\r\n\r\n        // Amount column: wrap AmountCell without JSX (this file is .ts)\r\n        {\r\n            id: \"amount\",\r\n            accessorKey: \"amount\",\r\n            header: \"Amount\",\r\n            size: 140,\r\n            cell: (ctx: CellContext<BudgetLine, unknown>) =>\r\n                React.createElement(AmountCell, {\r\n                    // Narrow unknown -> number | null | undefined\r\n                    getValue: () => ctx.getValue() as number | null | undefined,\r\n                    row: ctx.row,\r\n                    table: ctx.table,\r\n                }),\r\n        },\r\n\r\n        // Hidden helper column for Year filtering (derived from period)\r\n        {\r\n            id: \"__year\",\r\n            accessorFn: (row) => parseYearFromPeriod(row.period),\r\n            header: \"Year (hidden)\",\r\n            enableHiding: true,\r\n            meta: { hiddenHelper: true },\r\n            filterFn: (r, id, val: string | null) =>\r\n                !val || String(r.getValue(id) ?? \"\") === String(val),\r\n        },\r\n    ];\r\n}\r\n``\r\n\r\n"],"names":[],"mappings":";;;;AACA,6BAA6B;AAC7B;AAEA;AACA;;;;AAgBO,SAAS;IACZ,OAAO;QACH;YACI,IAAI;YACJ,aAAa;YACb,QAAQ;YACR,MAAM;gBAAE,mBAAmB;YAAU;YACrC,UAAU,mJAAiB;YAC3B,eAAe;QACnB;QACA;YACI,IAAI;YACJ,aAAa;YACb,QAAQ;YACR,MAAM;YACN,UAAU,8IAAY;QAC1B;QACA;YACI,IAAI;YACJ,aAAa;YACb,QAAQ;YACR,UAAU,mJAAiB;QAC/B;QACA;YAAE,IAAI;YAAe,aAAa;YAAe,QAAQ;QAAc;QACvE;YAAE,IAAI;YAAU,aAAa;YAAU,QAAQ;YAAU,MAAM;QAAI;QACnE;YAAE,IAAI;YAAU,aAAa;YAAU,QAAQ;YAAW,MAAM;QAAI;QACpE;YAAE,IAAI;YAAgB,aAAa;YAAgB,QAAQ;YAAU,MAAM;QAAI;QAC/E;YACI,IAAI;YACJ,QAAQ;YACR,YAAY,CAAC,MAAQ,IAAI,MAAM,IAAI,IAAI,SAAS,IAAI;QACxD;QAEA,gEAAgE;QAChE;YACI,IAAI;YACJ,aAAa;YACb,QAAQ;YACR,MAAM;YACN,MAAM,CAAC,oBACH,gNAAK,CAAC,aAAa,CAAC,4IAAU,EAAE;oBAC5B,8CAA8C;oBAC9C,UAAU,IAAM,IAAI,QAAQ;oBAC5B,KAAK,IAAI,GAAG;oBACZ,OAAO,IAAI,KAAK;gBACpB;QACR;QAEA,gEAAgE;QAChE;YACI,IAAI;YACJ,YAAY,CAAC,MAAQ,IAAA,qJAAmB,EAAC,IAAI,MAAM;YACnD,QAAQ;YACR,cAAc;YACd,MAAM;gBAAE,cAAc;YAAK;YAC3B,UAAU,CAAC,GAAG,IAAI,MACd,CAAC,OAAO,OAAO,EAAE,QAAQ,CAAC,OAAO,QAAQ,OAAO;QACxD;KACH;AACL;AACA,EAAE"}},
    {"offset": {"line": 1165, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/JeremyJoyner/code/budgetintelligence/components/BudgetGrid.tanstack.tsx"],"sourcesContent":["\r\n// components/BudgetGrid.tanstack.tsx\r\n\"use client\";\r\n\r\nimport * as React from \"react\";\r\nimport {\r\n    ColumnDef,\r\n    flexRender,\r\n    getCoreRowModel,\r\n    getSortedRowModel,\r\n    getFilteredRowModel,\r\n    getPaginationRowModel,\r\n    getFacetedUniqueValues,\r\n    getFacetedRowModel,\r\n    getExpandedRowModel,\r\n    useReactTable,\r\n    ColumnPinningState,\r\n    SortingState,\r\n    VisibilityState,\r\n    ColumnSizingState,\r\n    ColumnFiltersState,  // ← for ToolbarFilters (ColumnFilter[])\r\n    Table,\r\n} from \"@tanstack/react-table\";\r\n\r\nimport ToolbarFilters from \"./grid/ToolbarFilters\";\r\nimport VirtualRows from \"./grid/VirtualRows\";\r\nimport AmountCell from \"./grid/AmountCell\";\r\nimport ColumnMenu from \"./grid/ColumnMenu\";\r\nimport type { BudgetLine } from \"./grid/columns\";\r\n\r\n// ───────────────────────────────────────────────────────────────────────────────\r\n// buildTotals: try real helper; otherwise a no‑op fallback so TS compiles\r\n// ───────────────────────────────────────────────────────────────────────────────\r\nlet buildTotals: (rows: Array<{ getValue: (id: string) => unknown }>) => Record<string, number>;\r\ntry {\r\n    // eslint-disable-next-line @typescript-eslint/no-var-requires\r\n    const totalsMod = require(\"./grid/totals\");\r\n    buildTotals = totalsMod.buildTotals as typeof buildTotals;\r\n} catch {\r\n    buildTotals = () => ({});\r\n}\r\n\r\n// ───────────────────────────────────────────────────────────────────────────────\r\nimport * as exportMod from \"./grid/export\";\r\nconst exportRowsToCsv: any =\r\n    (exportMod as any).exportRowsToCsv ?? ((..._args: any[]) => { });\r\n\r\n// ───────────────────────────────────────────────────────────────────────────────\r\n\r\ntype Props = {\r\n    rows: BudgetLine[];\r\n    onRowsChange?: (rows: BudgetLine[]) => void;\r\n    className?: string;\r\n};\r\n\r\nexport default function BudgetGrid({ rows, onRowsChange, className }: Props) {\r\n    // ── Table state\r\n    const [sorting, setSorting] = React.useState<SortingState>([]);\r\n    const [columnVisibility, setColumnVisibility] = React.useState<VisibilityState>({});\r\n    const [columnPinning, setColumnPinning] = React.useState<ColumnPinningState>({ left: [], right: [] });\r\n    const [columnSizing, setColumnSizing] = React.useState<ColumnSizingState>({});\r\n    const [rowSelection, setRowSelection] = React.useState({});\r\n\r\n    // ── Column filters (ToolbarFilters expects ColumnFilter[])\r\n    const [filters, setFilters] = React.useState<ColumnFiltersState>([]);\r\n    const onClear = () => setFilters([]);\r\n\r\n    // ── Resolve columns factory without forcing a rename in your columns.ts\r\n    const columns = React.useMemo<ColumnDef<BudgetLine, any>[]>(() => {\r\n        // eslint-disable-next-line @typescript-eslint/no-var-requires\r\n        const mod = require(\"./grid/columns\");\r\n        const factory =\r\n            (mod as any).budgetColumns ??\r\n            (mod as any).getColumns ??\r\n            (mod as any).columns ??\r\n            (mod as any).default;\r\n\r\n        if (typeof factory === \"function\") {\r\n            return factory({ AmountCell }) as ColumnDef<BudgetLine, any>[];\r\n        }\r\n        if (Array.isArray((mod as any).default)) {\r\n            return (mod as any).default as ColumnDef<BudgetLine, any>[];\r\n        }\r\n        return [];\r\n    }, []);\r\n\r\n    // ── Table instance\r\n    const table = useReactTable({\r\n        data: rows,\r\n        columns,\r\n        state: {\r\n            sorting,\r\n            columnVisibility,\r\n            columnPinning,\r\n            columnSizing,\r\n            rowSelection,\r\n            columnFilters: filters,              // ← feed filters into table state\r\n        },\r\n        enableColumnResizing: true,\r\n        columnResizeMode: \"onChange\",\r\n\r\n        // Models\r\n        getCoreRowModel: getCoreRowModel(),\r\n        getFilteredRowModel: getFilteredRowModel(),\r\n        getFacetedUniqueValues: getFacetedUniqueValues(),\r\n        getFacetedRowModel: getFacetedRowModel(),\r\n        getSortedRowModel: getSortedRowModel(),\r\n        getExpandedRowModel: getExpandedRowModel(),\r\n        getPaginationRowModel: getPaginationRowModel(),\r\n\r\n        // Handlers\r\n        onSortingChange: setSorting,\r\n        onColumnVisibilityChange: setColumnVisibility,\r\n        onColumnPinningChange: setColumnPinning,\r\n        onColumnSizingChange: setColumnSizing,\r\n        onRowSelectionChange: setRowSelection,\r\n        onColumnFiltersChange: setFilters,     // ← keep table <> toolbar in sync\r\n\r\n        // Inline editor path (AmountCell)\r\n        meta: {\r\n            commitAmount: (rowIndex: number, value: number) => {\r\n                if (!onRowsChange) return;\r\n                const next = [...rows];\r\n                (next[rowIndex] as any).amount = value;\r\n                onRowsChange(next);\r\n            },\r\n        },\r\n\r\n        debugTable: false,\r\n        debugHeaders: false,\r\n        debugColumns: false,\r\n    });\r\n\r\n    const totals = React.useMemo(\r\n        () => buildTotals(table.getFilteredRowModel().rows),\r\n        [table]\r\n    );\r\n\r\n    // ── Export CSV; try (table) signature, then (rows, columns)\r\n    const exportCsv = React.useCallback(() => {\r\n        try {\r\n            return (exportRowsToCsv as any)(table);\r\n        } catch {\r\n            const data = table.getFilteredRowModel().rows.map((r) => r.original);\r\n            const cols = table.getAllLeafColumns().map((c) => {\r\n                const accessorFn =\r\n                    (c.columnDef as any).accessorFn as ((row: any) => any) | undefined;\r\n                return {\r\n                    id: c.id,\r\n                    header: c.columnDef.header,\r\n                    accessorFn: accessorFn ?? ((row: any) => (row as any)[c.id]),\r\n                };\r\n            });\r\n            return (exportRowsToCsv as any)(data, cols);\r\n        }\r\n    }, [table]);\r\n\r\n    return (\r\n        <div className={[\"flex h-full flex-col\", className].filter(Boolean).join(\" \")}>\r\n            {/* ── Toolbar (Filters, Export, etc.) */}\r\n            <div className=\"border-b bg-white\">\r\n                {/* If ToolbarFilters types `table` as Table<object>, cast once to avoid editing that file now */}\r\n                <ToolbarFilters\r\n                    table={table as unknown as Table<object>}\r\n                    filters={filters}\r\n                    setFilters={setFilters}\r\n                    onClear={onClear}\r\n                    onExport={exportCsv}  // NOTE: your ToolbarFilters expects onExport\r\n                />\r\n            </div>\r\n\r\n            {/* ── Grid */}\r\n            <div className=\"relative flex-1 overflow-hidden\">\r\n                <div className=\"h-full w-full overflow-auto\">\r\n                    <table className=\"min-w-full border-separate border-spacing-0\">\r\n                        <thead className=\"sticky top-0 z-10 bg-white\">\r\n                            {table.getHeaderGroups().map((hg) => (\r\n                                <tr key={hg.id}>\r\n                                    {hg.headers.map((header) => {\r\n                                        const col = header.column;\r\n                                        const pinned = col.getIsPinned();\r\n                                        const style: React.CSSProperties = {\r\n                                            position: pinned ? \"sticky\" : undefined,\r\n                                            // getStart/getAfter helpers might be untyped; use any to avoid version TS friction\r\n                                            left: pinned === \"left\" ? (col as any).getStart?.(\"left\") : undefined,\r\n                                            right: pinned === \"right\" ? (col as any).getAfter?.(\"right\") : undefined,\r\n                                            zIndex: pinned ? 11 : undefined,\r\n                                            width: col.getSize(),\r\n                                            minWidth: (col.columnDef.minSize as number) ?? 60,\r\n                                            maxWidth: (col.columnDef.maxSize as number) ?? 700,\r\n                                        };\r\n\r\n                                        return (\r\n                                            <th\r\n                                                key={header.id}\r\n                                                colSpan={header.colSpan}\r\n                                                style={style}\r\n                                                className=\"whitespace-nowrap border-b border-gray-200 bg-white px-3 py-2 text-left text-xs font-semibold uppercase tracking-wide text-gray-600\"\r\n                                            >\r\n                                                {header.isPlaceholder ? null : (\r\n                                                    <div className=\"relative flex items-center\">\r\n                                                        <button\r\n                                                            className=\"truncate\"\r\n                                                            onClick={col.getToggleSortingHandler()}\r\n                                                            title={\r\n                                                                col.getIsSorted() === \"asc\"\r\n                                                                    ? \"Sort descending\"\r\n                                                                    : col.getIsSorted() === \"desc\"\r\n                                                                        ? \"Clear sort\"\r\n                                                                        : \"Sort ascending\"\r\n                                                            }\r\n                                                        >\r\n                                                            {flexRender(col.columnDef.header, header.getContext())}\r\n                                                            {col.getIsSorted() && (\r\n                                                                <span className=\"ml-1 text-gray-400\">\r\n                                                                    {col.getIsSorted() === \"asc\" ? \"▲\" : \"▼\"}\r\n                                                                </span>\r\n                                                            )}\r\n                                                        </button>\r\n\r\n                                                        {/* Column menu */}\r\n                                                        <ColumnMenu table={table} column={col} />\r\n                                                    </div>\r\n                                                )}\r\n\r\n                                                {/* Resize handle — use HEADER API in v8 */}\r\n                                                {header.column.getCanResize() && (\r\n                                                    <div\r\n                                                        onMouseDown={header.getResizeHandler()}\r\n                                                        onTouchStart={header.getResizeHandler()}\r\n                                                        className=\"absolute right-0 top-0 h-full w-1 cursor-col-resize select-none touch-none\"\r\n                                                    />\r\n                                                )}\r\n                                            </th>\r\n                                        );\r\n                                    })}\r\n                                </tr>\r\n                            ))}\r\n                        </thead>\r\n\r\n                        {/* Body (virtualized rows) */}\r\n                        <tbody>\r\n                            <VirtualRows table={table} />\r\n                        </tbody>\r\n\r\n                        {/* Totals footer (filtered rows) */}\r\n                        <tfoot className=\"sticky bottom-0 z-10 bg-white\">\r\n                            <tr>\r\n                                {table.getAllLeafColumns().map((c) => {\r\n                                    const sum = (totals as any)[c.id];\r\n                                    const pinned = c.getIsPinned();\r\n                                    const style: React.CSSProperties = {\r\n                                        position: pinned ? \"sticky\" : undefined,\r\n                                        left: pinned === \"left\" ? (c as any).getStart?.(\"left\") : undefined,\r\n                                        right: pinned === \"right\" ? (c as any).getAfter?.(\"right\") : undefined,\r\n                                        zIndex: pinned ? 11 : undefined,\r\n                                        width: c.getSize(),\r\n                                        minWidth: (c.columnDef.minSize as number) ?? 60,\r\n                                        maxWidth: (c.columnDef.maxSize as number) ?? 700,\r\n                                    };\r\n                                    return (\r\n                                        <td key={c.id} style={style} className=\"border-t border-gray-200 px-3 py-2 text-right text-sm\">\r\n                                            {typeof sum === \"number\" ? sum.toLocaleString() : \"\"}\r\n                                        </td>\r\n                                    );\r\n                                })}\r\n                            </tr>\r\n                        </tfoot>\r\n                    </table>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}