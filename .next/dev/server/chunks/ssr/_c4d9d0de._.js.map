{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/JeremyJoyner/code/budgetintelligence/components/grid/AmountCell.tsx"],"sourcesContent":["\r\n// components/grid/AmountCell.tsx\r\nimport * as React from 'react';\r\nimport type { CellContext } from '@tanstack/react-table';\r\nimport type { BudgetRow } from './columns';\r\n\r\n// Currency helpers\r\nconst fmt = new Intl.NumberFormat(undefined, {\r\n    style: 'currency',\r\n    currency: 'USD',\r\n    maximumFractionDigits: 0,\r\n});\r\n\r\nfunction parseCurrency(input: string): number | null {\r\n    // Accept: \"$480,000\", \"480000\", \"480,000\", \"480000.00\"\r\n    if (input == null) return null;\r\n    const stripped = String(input).replace(/[^0-9.-]/g, '');\r\n    if (stripped.trim() === '') return null;\r\n    const n = Number(stripped);\r\n    return Number.isFinite(n) ? n : null;\r\n}\r\n\r\ntype TableMeta = {\r\n    updateAmount?: (rowId: string, newValue: number) => void;\r\n};\r\n\r\nexport default function AmountCell(ctx: CellContext<BudgetRow, unknown>) {\r\n    const { row, getValue, table } = ctx;\r\n    const meta = table.options.meta as TableMeta | undefined;\r\n\r\n    // Show formatted currency when not editing; turn into an <input> when focused/double-clicked\r\n    const initial = getValue() as number | string | null | undefined;\r\n    const initialNumber =\r\n        typeof initial === 'number'\r\n            ? initial\r\n            : typeof initial === 'string'\r\n                ? Number(initial)\r\n                : null;\r\n\r\n    const [isEditing, setEditing] = React.useState(false);\r\n    const [draft, setDraft] = React.useState(\r\n        initialNumber != null ? fmt.format(initialNumber) : ''\r\n    );\r\n\r\n    // Keep local draft in sync if the underlying cell changes from elsewhere\r\n    React.useEffect(() => {\r\n        const n =\r\n            typeof initial === 'number'\r\n                ? initial\r\n                : typeof initial === 'string'\r\n                    ? Number(initial)\r\n                    : null;\r\n        setDraft(n != null ? fmt.format(n) : '');\r\n    }, [initial]);\r\n\r\n    const commit = React.useCallback(() => {\r\n        const n = parseCurrency(draft);\r\n        if (n != null && meta?.updateAmount) {\r\n            meta.updateAmount(row.id, n);\r\n        }\r\n        setEditing(false);\r\n    }, [draft, meta, row.id]);\r\n\r\n    const onKeyDown = (e: React.KeyboardEvent<HTMLInputElement>) => {\r\n        if (e.key === 'Enter') {\r\n            e.preventDefault();\r\n            commit();\r\n        } else if (e.key === 'Escape') {\r\n            e.preventDefault();\r\n            // Revert draft to current cell value\r\n            const n =\r\n                typeof initial === 'number'\r\n                    ? initial\r\n                    : typeof initial === 'string'\r\n                        ? Number(initial)\r\n                        : null;\r\n            setDraft(n != null ? fmt.format(n) : '');\r\n            setEditing(false);\r\n        }\r\n    };\r\n\r\n    if (!isEditing) {\r\n        const display =\r\n            initialNumber != null ? fmt.format(initialNumber) : '';\r\n        return (\r\n            <div\r\n                role=\"button\"\r\n                tabIndex={0}\r\n                onDoubleClick={() => setEditing(true)}\r\n                onKeyDown={(e) => {\r\n                    if (e.key === 'Enter' || e.key === ' ') setEditing(true);\r\n                }}\r\n                style={{ cursor: 'text' }}\r\n            >\r\n                {display}\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <input\r\n            autoFocus\r\n            value={draft}\r\n            onChange={(e) => setDraft(e.target.value)}\r\n            onBlur={commit}\r\n            onKeyDown={onKeyDown}\r\n            inputMode=\"numeric\"\r\n            style={{\r\n                width: '100%',\r\n                border: '1px solid #cfd8e3',\r\n                borderRadius: 4,\r\n                padding: '4px 6px',\r\n                outline: 'none',\r\n                textAlign: 'left',\r\n            }}\r\n        />\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;AACA,iCAAiC;AACjC;;;AAIA,mBAAmB;AACnB,MAAM,MAAM,IAAI,KAAK,YAAY,CAAC,WAAW;IACzC,OAAO;IACP,UAAU;IACV,uBAAuB;AAC3B;AAEA,SAAS,cAAc,KAAa;IAChC,uDAAuD;IACvD,IAAI,SAAS,MAAM,OAAO;IAC1B,MAAM,WAAW,OAAO,OAAO,OAAO,CAAC,aAAa;IACpD,IAAI,SAAS,IAAI,OAAO,IAAI,OAAO;IACnC,MAAM,IAAI,OAAO;IACjB,OAAO,OAAO,QAAQ,CAAC,KAAK,IAAI;AACpC;AAMe,SAAS,WAAW,GAAoC;IACnE,MAAM,EAAE,GAAG,EAAE,QAAQ,EAAE,KAAK,EAAE,GAAG;IACjC,MAAM,OAAO,MAAM,OAAO,CAAC,IAAI;IAE/B,6FAA6F;IAC7F,MAAM,UAAU;IAChB,MAAM,gBACF,OAAO,YAAY,WACb,UACA,OAAO,YAAY,WACf,OAAO,WACP;IAEd,MAAM,CAAC,WAAW,WAAW,GAAG,iNAAc,CAAC;IAC/C,MAAM,CAAC,OAAO,SAAS,GAAG,iNAAc,CACpC,iBAAiB,OAAO,IAAI,MAAM,CAAC,iBAAiB;IAGxD,yEAAyE;IACzE,kNAAe,CAAC;QACZ,MAAM,IACF,OAAO,YAAY,WACb,UACA,OAAO,YAAY,WACf,OAAO,WACP;QACd,SAAS,KAAK,OAAO,IAAI,MAAM,CAAC,KAAK;IACzC,GAAG;QAAC;KAAQ;IAEZ,MAAM,SAAS,oNAAiB,CAAC;QAC7B,MAAM,IAAI,cAAc;QACxB,IAAI,KAAK,QAAQ,MAAM,cAAc;YACjC,KAAK,YAAY,CAAC,IAAI,EAAE,EAAE;QAC9B;QACA,WAAW;IACf,GAAG;QAAC;QAAO;QAAM,IAAI,EAAE;KAAC;IAExB,MAAM,YAAY,CAAC;QACf,IAAI,EAAE,GAAG,KAAK,SAAS;YACnB,EAAE,cAAc;YAChB;QACJ,OAAO,IAAI,EAAE,GAAG,KAAK,UAAU;YAC3B,EAAE,cAAc;YAChB,qCAAqC;YACrC,MAAM,IACF,OAAO,YAAY,WACb,UACA,OAAO,YAAY,WACf,OAAO,WACP;YACd,SAAS,KAAK,OAAO,IAAI,MAAM,CAAC,KAAK;YACrC,WAAW;QACf;IACJ;IAEA,IAAI,CAAC,WAAW;QACZ,MAAM,UACF,iBAAiB,OAAO,IAAI,MAAM,CAAC,iBAAiB;QACxD,qBACI,8OAAC;YACG,MAAK;YACL,UAAU;YACV,eAAe,IAAM,WAAW;YAChC,WAAW,CAAC;gBACR,IAAI,EAAE,GAAG,KAAK,WAAW,EAAE,GAAG,KAAK,KAAK,WAAW;YACvD;YACA,OAAO;gBAAE,QAAQ;YAAO;sBAEvB;;;;;;IAGb;IAEA,qBACI,8OAAC;QACG,SAAS;QACT,OAAO;QACP,UAAU,CAAC,IAAM,SAAS,EAAE,MAAM,CAAC,KAAK;QACxC,QAAQ;QACR,WAAW;QACX,WAAU;QACV,OAAO;YACH,OAAO;YACP,QAAQ;YACR,cAAc;YACd,SAAS;YACT,SAAS;YACT,WAAW;QACf;;;;;;AAGZ"}},
    {"offset": {"line": 109, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/JeremyJoyner/code/budgetintelligence/components/grid/columns.ts"],"sourcesContent":["\r\n// components/grid/columns.ts\r\nimport type { ColumnDef } from '@tanstack/react-table';\r\nimport AmountCell from './AmountCell';\r\n\r\n/** Raw JSON shape you use today (kept intact) */\r\nexport type BudgetRow = {\r\n    type?: string;            // raw: \"expense\", \"revenue\", etc.\r\n    community?: string;\r\n    category?: string;\r\n    subCategory?: string;\r\n    budgetMethod?: string;    // present in data but NOT displayed as a column\r\n    driver?: string;\r\n    driverTag?: string;\r\n    glCode?: string | null;\r\n    period?: string;          // e.g., \"2026-03\"\r\n    amount?: number | string | null;\r\n    [key: string]: unknown;\r\n};\r\n\r\n// Back-compat alias if other files import BudgetLine\r\nexport type BudgetLine = BudgetRow;\r\n\r\n/* ---------------------------------- */\r\n/* Helpers: derive Year, Quarter, Month from \"YYYY-MM\" */\r\n/* ---------------------------------- */\r\n\r\n/** Return 2026 from \"2026-03\" */\r\nexport function deriveYear(period?: string): number | null {\r\n    if (!period) return null;\r\n    const y = parseInt(period.slice(0, 4), 10);\r\n    return Number.isFinite(y) ? y : null;\r\n}\r\n\r\n/** Internal: 1–12 from \"2026-03\" */\r\nfunction deriveMonthNumber(period?: string): number | null {\r\n    if (!period || period.length < 7) return null;\r\n    const m = parseInt(period.slice(5, 7), 10);\r\n    return m >= 1 && m <= 12 ? m : null;\r\n}\r\n\r\n/** Return month label: Jan, Feb, Mar, ... */\r\nexport function deriveMonthLabel(period?: string): string {\r\n    const m = deriveMonthNumber(period);\r\n    if (!m) return '';\r\n    const labels = [\r\n        '', 'Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun',\r\n        'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec',\r\n    ];\r\n    return labels[m] ?? '';\r\n}\r\n\r\n/** Return quarter in format YYQ#: e.g., 26Q1, 25Q4 */\r\nexport function deriveQuarterLabel(period?: string): string {\r\n    const year = deriveYear(period);\r\n    const m = deriveMonthNumber(period);\r\n    if (!year || !m) return '';\r\n    const q = Math.ceil(m / 3);\r\n    const yy = String(year).slice(-2); // 2026 → \"26\"\r\n    return `${yy}Q${q}`;\r\n}\r\n\r\n/** Map raw \"type\" → UI label for Budget Type */\r\nexport function mapBudgetType(raw?: string): string {\r\n    if (!raw) return '';\r\n    const t = String(raw).toLowerCase();\r\n    if (t === 'expense') return 'Expense';\r\n    if (t === 'revenue') return 'Revenue';\r\n    if (t === 'capex' || t === 'capital' || t === 'capital_expenditure') return 'CapEx';\r\n    // Fallback: Title Case original value\r\n    return raw.charAt(0).toUpperCase() + raw.slice(1);\r\n}\r\n\r\n/* ---------------------------------- */\r\n/* Column definitions (ORDER LOCKED)  */\r\n/* Community | Category | SubCategory | GL Code | Budget Type | Year | Quarter | Month | Amount */\r\n/* ---------------------------------- */\r\n\r\nexport const columns: ColumnDef<BudgetRow, any>[] = [\r\n    {\r\n        id: 'community',\r\n        accessorKey: 'community',\r\n        header: 'Community',\r\n        enableResizing: true,\r\n        size: 200,\r\n    },\r\n    {\r\n        id: 'category',\r\n        accessorKey: 'category',\r\n        header: 'Category',\r\n        enableResizing: true,\r\n        size: 200,\r\n    },\r\n    {\r\n        id: 'subCategory',\r\n        accessorKey: 'subCategory',\r\n        header: 'SubCategory',\r\n        enableResizing: true,\r\n        size: 220,\r\n    },\r\n    {\r\n        id: 'glCode',\r\n        accessorKey: 'glCode',\r\n        header: 'GL Code',\r\n        enableResizing: true,\r\n        size: 110,\r\n        cell: (info) => String(info.getValue() ?? ''),\r\n    },\r\n    {\r\n        id: 'budgetType',\r\n        header: 'Budget Type',\r\n        accessorFn: (row) => mapBudgetType(row.type),\r\n        enableResizing: true,\r\n        size: 140,\r\n    },\r\n    {\r\n        id: 'year',\r\n        header: 'Year',\r\n        accessorFn: (row) => deriveYear(row.period),\r\n        enableResizing: true,\r\n        size: 90,\r\n        cell: (info) => {\r\n            const y = info.getValue() as number | null;\r\n            return y ?? '';\r\n        },\r\n        // Keep filtering on 'year' numeric-safe so toolbar Year works as expected\r\n        filterFn: (row, _columnId, filterValue: unknown) => {\r\n            const y = row.getValue<number | null>('year');\r\n            if (filterValue == null || filterValue === '') return true;\r\n            const fv = typeof filterValue === 'string' ? parseInt(filterValue, 10) : filterValue;\r\n            return y === fv;\r\n        },\r\n    },\r\n    {\r\n        id: 'quarter',\r\n        header: 'Quarter',\r\n        accessorFn: (row) => deriveQuarterLabel(row.period), // e.g., 26Q1\r\n        enableResizing: true,\r\n        size: 100,\r\n    },\r\n    {\r\n        id: 'month',\r\n        header: 'Month',\r\n        accessorFn: (row) => deriveMonthLabel(row.period),   // e.g., Jan\r\n        enableResizing: true,\r\n        size: 90,\r\n    },\r\n    {\r\n        id: 'amount',\r\n        accessorKey: 'amount',\r\n        header: 'Amount',\r\n        enableResizing: true,\r\n        size: 140,\r\n        cell: AmountCell,\r\n        meta: { isNumeric: true },\r\n    },\r\n];\r\n\r\nexport default columns;\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 259, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/JeremyJoyner/code/budgetintelligence/components/grid/ToolbarFilters.tsx"],"sourcesContent":["\r\n// components/grid/ToolbarFilters.tsx\r\nimport * as React from 'react';\r\nimport type { ColumnFiltersState, Table } from '@tanstack/react-table';\r\n\r\ntype Props = {\r\n    /** Which pickers to show, in order. Example: ['year','quarter','budgetType','category'] */\r\n    ids?: Array<'year' | 'quarter' | 'month' | 'budgetType' | 'category'>;\r\n    filters: ColumnFiltersState;\r\n    setFilters:\r\n    | React.Dispatch<React.SetStateAction<ColumnFiltersState>>\r\n    | ((updater: ColumnFiltersState | ((old: ColumnFiltersState) => ColumnFiltersState)) => void);\r\n    onClear: () => void;\r\n    onExport: () => void;\r\n    table: Table<any>;\r\n};\r\n\r\nfunction getFilterValue(filters: ColumnFiltersState, id: string): string {\r\n    const f = filters.find(f => f.id === id);\r\n    return f?.value != null ? String(f.value) : '';\r\n}\r\n\r\nfunction upsert(\r\n    set: Props['setFilters'],\r\n    id: 'year' | 'quarter' | 'month' | 'budgetType' | 'category',\r\n    value: string\r\n) {\r\n    const updater = (prev: ColumnFiltersState) => {\r\n        const next = prev.filter(f => f.id !== id);\r\n        if (value !== '') {\r\n            const v = id === 'year' ? Number(value) : value; // keep 'year' numeric\r\n            next.push({ id, value: v } as any);\r\n        }\r\n        return next;\r\n    };\r\n    if (typeof set === 'function' && (set as any).length === 1) {\r\n        (set as any)(updater);\r\n    } else {\r\n        (set as React.Dispatch<React.SetStateAction<ColumnFiltersState>>)(updater);\r\n    }\r\n}\r\n\r\nfunction getOptions(table: Table<any>, columnId: string): string[] {\r\n    const col = table.getColumn(columnId);\r\n    if (!col) return [];\r\n    const pre = table.getPreFilteredRowModel();\r\n    const s = new Set<string>();\r\n    pre.flatRows.forEach(r => {\r\n        const v = r.getValue?.(columnId);\r\n        if (v == null) return;\r\n        const str = String(v);\r\n        if (str.trim().length) s.add(str);\r\n    });\r\n    return Array.from(s).sort((a, b) => a.localeCompare(b));\r\n}\r\n\r\nfunction Divider() {\r\n    return (\r\n        <span\r\n            aria-hidden=\"true\"\r\n            style={{\r\n                width: 1,\r\n                height: 22,\r\n                background: '#e5e5e5',\r\n                margin: '0 10px',\r\n                display: 'inline-block',\r\n            }}\r\n        />\r\n    );\r\n}\r\n\r\nexport default function ToolbarFilters({\r\n    ids = ['year', 'quarter', 'budgetType', 'category'],\r\n    filters,\r\n    setFilters,\r\n    onClear,\r\n    onExport,\r\n    table,\r\n}: Props) {\r\n    const LABELS: Record<string, string> = {\r\n        year: 'Year',\r\n        quarter: 'Quarter',\r\n        month: 'Month',\r\n        budgetType: 'Budget Type',\r\n        category: 'Category',\r\n    };\r\n\r\n    const filteredCount = table.getFilteredRowModel().rows.length;\r\n\r\n    return (\r\n        <div\r\n            className=\"grid-toolbar\"\r\n            style={{\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                gap: 0,\r\n                padding: '4px 4px 8px 4px',\r\n            }}\r\n        >\r\n            {ids.map((id, idx) => {\r\n                const label = LABELS[id];\r\n                const options = getOptions(table, id);\r\n                const value = getFilterValue(filters, id);\r\n                const control = (\r\n                    <div\r\n                        key={id}\r\n                        style={{\r\n                            display: 'inline-flex',\r\n                            alignItems: 'center',\r\n                            padding: '2px 10px',\r\n                            borderRadius: 6,\r\n                            border: '1px solid #e5e5e5',\r\n                            background: '#fff',\r\n                        }}\r\n                    >\r\n                        <select\r\n                            value={value}\r\n                            onChange={(e) => upsert(setFilters, id, e.target.value)}\r\n                            disabled={options.length === 0}\r\n                            style={{\r\n                                border: 'none',\r\n                                outline: 'none',\r\n                                background: 'transparent',\r\n                                minWidth: id === 'budgetType' ? 150 : id === 'category' ? 180 : 110,\r\n                                cursor: options.length ? 'pointer' : 'not-allowed',\r\n                            }}\r\n                            aria-label={label}\r\n                        >\r\n                            <option value=\"\">{label}</option>\r\n                            {options.map(opt => (\r\n                                <option key={`${id}:${opt}`} value={opt}>{opt}</option>\r\n                            ))}\r\n                        </select>\r\n                    </div>\r\n                );\r\n\r\n                return (\r\n                    <React.Fragment key={`frag-${id}`}>\r\n                        {control}\r\n                        {idx < ids.length - 1 ? <Divider /> : <span style={{ width: 8 }} />}\r\n                    </React.Fragment>\r\n                );\r\n            })}\r\n\r\n            <div style={{ marginLeft: 'auto', display: 'inline-flex', gap: 12, alignItems: 'center', color: '#666' }}>\r\n                <span style={{ fontSize: 12 }}>{filteredCount} rows</span>\r\n                <button type=\"button\" onClick={onClear}>Clear</button>\r\n                <button type=\"button\" onClick={onExport}>Export CSV</button>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 475, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/JeremyJoyner/code/budgetintelligence/components/grid/VirtualRows.tsx"],"sourcesContent":["\r\n// components/grid/VirtualRows.tsx\r\nimport * as React from 'react';\r\n\r\ntype VirtualRowsProps<T> = {\r\n    /** All table rows (already filtered/sorted) in display order */\r\n    rows: T[];\r\n    /** Height of a single data row in pixels (estimate) */\r\n    rowHeight?: number;\r\n    /** Extra rows to render above/below the viewport */\r\n    overscan?: number;\r\n    /**\r\n     * The scrollable container that wraps the <table>.\r\n     * Widened to Element|null to accept HTMLDivElement refs without TS variance issues.\r\n     */\r\n    scrollContainerRef: React.RefObject<Element | null>;\r\n    /** Number of visible (non-hidden) columns; used for spacer colSpan */\r\n    visibleColumnCount: number;\r\n    /** Render function for an individual data row as <tr>...</tr> */\r\n    renderRow: (row: T, rowIndex: number) => React.ReactElement;\r\n    /** Disable virtualization (debug or small datasets) */\r\n    disableVirtual?: boolean;\r\n};\r\n\r\n/**\r\n * Table-safe virtualization for <tbody>:\r\n * - Renders only <tr>/<td> inside <tbody> (no <div>).\r\n * - Uses top/bottom spacer <tr> to preserve scroll height.\r\n * - SSR-safe: falls back to non-virtual on server / missing container metrics.\r\n */\r\nexport function VirtualRows<T>({\r\n    rows,\r\n    rowHeight = 36,\r\n    overscan = 6,\r\n    scrollContainerRef,\r\n    visibleColumnCount,\r\n    renderRow,\r\n    disableVirtual,\r\n}: VirtualRowsProps<T>) {\r\n    const isServer = typeof window === 'undefined';\r\n    const [viewport, setViewport] = React.useState({ scrollTop: 0, height: 0 });\r\n\r\n    React.useEffect(() => {\r\n        if (disableVirtual || isServer) return;\r\n        // We widened the ref type; here we assert to HTMLElement at usage time\r\n        const el = scrollContainerRef.current as HTMLElement | null;\r\n        if (!el) return;\r\n\r\n        const handle = () => {\r\n            setViewport({\r\n                scrollTop: el.scrollTop,\r\n                height: el.clientHeight,\r\n            });\r\n        };\r\n        handle();\r\n\r\n        el.addEventListener('scroll', handle, { passive: true });\r\n        const ro = new ResizeObserver(handle);\r\n        ro.observe(el);\r\n\r\n        return () => {\r\n            el.removeEventListener('scroll', handle);\r\n            ro.disconnect();\r\n        };\r\n    }, [scrollContainerRef, disableVirtual, isServer]);\r\n\r\n    // If virtualization is disabled or we can't measure yet, render all rows\r\n    if (disableVirtual || isServer || !scrollContainerRef.current || viewport.height === 0) {\r\n        return <>{rows.map((row, i) => renderRow(row, i))}</>;\r\n    }\r\n\r\n    const total = rows.length;\r\n    const estTotalHeight = total * rowHeight;\r\n\r\n    const startIndex = Math.max(0, Math.floor(viewport.scrollTop / rowHeight) - overscan);\r\n    const visibleCount = Math.ceil(viewport.height / rowHeight) + overscan * 2;\r\n    const endIndex = Math.min(total, startIndex + visibleCount);\r\n\r\n    const topPad = startIndex * rowHeight;\r\n    const bottomPad = Math.max(0, estTotalHeight - topPad - (endIndex - startIndex) * rowHeight);\r\n\r\n    return (\r\n        <>\r\n            {topPad > 0 && (\r\n                <tr aria-hidden=\"true\">\r\n                    <td colSpan={visibleColumnCount} style={{ height: topPad, padding: 0, border: 'none' }} />\r\n                </tr>\r\n            )}\r\n\r\n            {rows.slice(startIndex, endIndex).map((row, i) => renderRow(row, startIndex + i))}\r\n\r\n            {bottomPad > 0 && (\r\n                <tr aria-hidden=\"true\">\r\n                    <td colSpan={visibleColumnCount} style={{ height: bottomPad, padding: 0, border: 'none' }} />\r\n                </tr>\r\n            )}\r\n        </>\r\n    );\r\n}\r\n\r\nexport default VirtualRows;\r\n"],"names":[],"mappings":";;;;;;;AACA,kCAAkC;AAClC;;;AA4BO,SAAS,YAAe,EAC3B,IAAI,EACJ,YAAY,EAAE,EACd,WAAW,CAAC,EACZ,kBAAkB,EAClB,kBAAkB,EAClB,SAAS,EACT,cAAc,EACI;IAClB,MAAM,WAAW,kDAAkB;IACnC,MAAM,CAAC,UAAU,YAAY,GAAG,iNAAc,CAAC;QAAE,WAAW;QAAG,QAAQ;IAAE;IAEzE,kNAAe,CAAC;QACZ,wCAAgC;;;QAChC,uEAAuE;QACvE,MAAM;QAGN,MAAM;QASN,MAAM;IAOV,GAAG;QAAC;QAAoB;QAAgB;KAAS;IAEjD,yEAAyE;IACzE,wCAAwF;QACpF,qBAAO;sBAAG,KAAK,GAAG,CAAC,CAAC,KAAK,IAAM,UAAU,KAAK;;IAClD;;;IAEA,MAAM;IACN,MAAM;IAEN,MAAM;IACN,MAAM;IACN,MAAM;IAEN,MAAM;IACN,MAAM;AAmBV;uCAEe"}},
    {"offset": {"line": 526, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/JeremyJoyner/code/budgetintelligence/components/grid/totals.ts"],"sourcesContent":["\r\n// components/grid/totals.ts\r\nimport type { Table } from '@tanstack/react-table';\r\n\r\nexport type NumericKey = string;\r\n\r\n/**\r\n * Sums numeric fields across a collection of row \"originals\".\r\n * Non-numeric / null / undefined values are ignored.\r\n */\r\nexport function buildTotals<T extends Record<string, unknown>>(\r\n    rows: T[],\r\n    numericKeys: readonly NumericKey[]\r\n): Record<NumericKey, number> {\r\n    const totals: Record<NumericKey, number> = Object.fromEntries(\r\n        numericKeys.map(k => [k, 0])\r\n    ) as Record<NumericKey, number>;\r\n\r\n    for (const row of rows) {\r\n        for (const k of numericKeys) {\r\n            const v = row[k];\r\n            const n = typeof v === 'string' ? Number(v) : (typeof v === 'number' ? v : NaN);\r\n            if (!Number.isNaN(n)) {\r\n                totals[k] += n;\r\n            }\r\n        }\r\n    }\r\n    return totals;\r\n}\r\n\r\n/**\r\n * Convenience helper: sums from the table's *filtered* row model.\r\n * Usage: buildTotalsFromTable(table, ['amount'])\r\n */\r\nexport function buildTotalsFromTable<T extends Record<string, unknown>>(\r\n    table: Table<T>,\r\n    numericKeys: readonly NumericKey[]\r\n): Record<NumericKey, number> {\r\n    const rows = table.getFilteredRowModel().rows.map(r => r.original);\r\n    return buildTotals(rows as T[], numericKeys);\r\n}\r\n"],"names":[],"mappings":"AACA,4BAA4B;;;;;;;AASrB,SAAS,YACZ,IAAS,EACT,WAAkC;IAElC,MAAM,SAAqC,OAAO,WAAW,CACzD,YAAY,GAAG,CAAC,CAAA,IAAK;YAAC;YAAG;SAAE;IAG/B,KAAK,MAAM,OAAO,KAAM;QACpB,KAAK,MAAM,KAAK,YAAa;YACzB,MAAM,IAAI,GAAG,CAAC,EAAE;YAChB,MAAM,IAAI,OAAO,MAAM,WAAW,OAAO,KAAM,OAAO,MAAM,WAAW,IAAI;YAC3E,IAAI,CAAC,OAAO,KAAK,CAAC,IAAI;gBAClB,MAAM,CAAC,EAAE,IAAI;YACjB;QACJ;IACJ;IACA,OAAO;AACX;AAMO,SAAS,qBACZ,KAAe,EACf,WAAkC;IAElC,MAAM,OAAO,MAAM,mBAAmB,GAAG,IAAI,CAAC,GAAG,CAAC,CAAA,IAAK,EAAE,QAAQ;IACjE,OAAO,YAAY,MAAa;AACpC"}},
    {"offset": {"line": 557, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/JeremyJoyner/code/budgetintelligence/components/BudgetGrid.tanstack.tsx"],"sourcesContent":["\r\n// components/BudgetGrid.tanstack.tsx\r\n'use client';\r\n\r\nimport * as React from 'react';\r\nimport {\r\n    Cell,\r\n    ColumnFiltersState,\r\n    Row,\r\n    SortingState,\r\n    TableOptions,\r\n    flexRender,\r\n    getCoreRowModel,\r\n    getFilteredRowModel,\r\n    getSortedRowModel,\r\n    getGroupedRowModel,\r\n    getExpandedRowModel,\r\n    useReactTable,\r\n} from '@tanstack/react-table';\r\nimport baseColumns, { BudgetRow } from './grid/columns';\r\nimport ToolbarFilters from './grid/ToolbarFilters';\r\nimport VirtualRows from './grid/VirtualRows';\r\nimport { buildTotalsFromTable } from './grid/totals';\r\n\r\n/* ----------------------------------------------------------------------------\r\n   Small utilities\r\n---------------------------------------------------------------------------- */\r\nfunction toCsv(rows: BudgetRow[], visibleKeys: string[]): string {\r\n    const esc = (v: unknown) => {\r\n        if (v == null) return '';\r\n        const s = String(v);\r\n        return /[\",\\n]/.test(s) ? `\"${s.replace(/\"/g, '\"\"')}\"` : s;\r\n    };\r\n    const header = visibleKeys.map(esc).join(',');\r\n    const body = rows.map((r) => visibleKeys.map((k) => esc((r as any)[k])).join(',')).join('\\n');\r\n    return `${header}\\n${body}`;\r\n}\r\n\r\nfunction downloadBlob(filename: string, content: string, mime = 'text/csv;charset=utf-8') {\r\n    const blob = new Blob([content], { type: mime });\r\n    const url = URL.createObjectURL(blob);\r\n    const a = document.createElement('a');\r\n    a.href = url;\r\n    a.download = filename;\r\n    document.body.appendChild(a);\r\n    a.click();\r\n    a.remove();\r\n    URL.revokeObjectURL(url);\r\n}\r\n\r\nfunction formatCurrency(n: number): string {\r\n    return Intl.NumberFormat(undefined, { style: 'currency', currency: 'USD', maximumFractionDigits: 0 }).format(n || 0);\r\n}\r\n\r\n/* ----------------------------------------------------------------------------\r\n   Props\r\n---------------------------------------------------------------------------- */\r\ntype Props = {\r\n    rows?: BudgetRow[];\r\n    initialSorting?: SortingState;\r\n    initialFilters?: ColumnFiltersState;\r\n\r\n    // Controlled filters from the page (syncs with right-hand panel)\r\n    filters?: ColumnFiltersState;\r\n    onFiltersChange?: (\r\n        updater: ColumnFiltersState | ((old: ColumnFiltersState) => ColumnFiltersState)\r\n    ) => void;\r\n\r\n    // Push edits up if the page is managing row state\r\n    onUpdateAmount?: (rowIndex: number, newValue: number) => void;\r\n\r\n    // Legacy toolbar (kept for future grouping/AI actions, page may toggle visibility via CSS)\r\n    toolbarIds?: Array<'year' | 'quarter' | 'month' | 'budgetType' | 'category'>;\r\n\r\n    // SAFETY: emit grouping keys after render only (prevents render-phase updates)\r\n    onGroupingAfterRender?: (keys: string[]) => void;\r\n\r\n    // When true, let the scroll container fill its parent (used by full-screen mode)\r\n    fillViewport?: boolean;\r\n\r\n    // NEW: optional right-side content in the grid toolbar (e.g., AI + Full Screen buttons)\r\n    toolbarRight?: React.ReactNode;\r\n};\r\n\r\n/* ----------------------------------------------------------------------------\r\n   Column helpers for header filters\r\n---------------------------------------------------------------------------- */\r\nconst HEADER_FILTER_IDS = [\r\n    'community',\r\n    'category',\r\n    'subCategory',\r\n    'glCode',\r\n    'budgetType',\r\n    'year',\r\n    'quarter',\r\n    'month',\r\n] as const;\r\n\r\nfunction getColumnOptions(table: any, columnId: string): string[] {\r\n    const col = table.getColumn(columnId);\r\n    if (!col) return [];\r\n    const pre = table.getPreFilteredRowModel();\r\n    const uniq = new Set<string>();\r\n    pre.flatRows.forEach((r: any) => {\r\n        // Prefer TanStack's computed cell value\r\n        let v = r.getValue?.(columnId);\r\n        // Fallbacks for common synonyms if accessor differs\r\n        if (v == null) {\r\n            const orig = r.original ?? {};\r\n            switch (columnId) {\r\n                case 'community':\r\n                    v = orig.community ?? orig.Community;\r\n                    break;\r\n                case 'category':\r\n                    v = orig.category ?? orig.Category;\r\n                    break;\r\n                case 'subCategory':\r\n                    v = orig.subCategory ?? orig.SubCategory;\r\n                    break;\r\n                case 'budgetType':\r\n                    v = orig.type ?? orig.budgetType ?? orig.BudgetType;\r\n                    break;\r\n                case 'year':\r\n                    v = orig.year ?? '';\r\n                    break;\r\n                case 'quarter':\r\n                    v = orig.quarter ?? '';\r\n                    break;\r\n                case 'month':\r\n                    v = orig.month ?? '';\r\n                    break;\r\n                default:\r\n                    v = v ?? '';\r\n            }\r\n        }\r\n        if (v != null) {\r\n            const s = String(v).trim();\r\n            if (s.length) uniq.add(s);\r\n        }\r\n    });\r\n    return Array.from(uniq).sort((a, b) => a.localeCompare(b));\r\n}\r\n\r\n/**\r\n * Helper that works for both controlled and uncontrolled signatures.\r\n * We pass a \"setState-compatible\" dispatcher everywhere. This avoids type issues\r\n * and lets us centralize the \"after-mount\" guard.\r\n */\r\nfunction setFilter(\r\n    setFilters:\r\n        | React.Dispatch<React.SetStateAction<ColumnFiltersState>>\r\n        | ((updater: ColumnFiltersState | ((old: ColumnFiltersState) => ColumnFiltersState)) => void)\r\n        | undefined,\r\n    id: string,\r\n    value?: string\r\n) {\r\n    if (!setFilters) return;\r\n    (setFilters as any)((prev: ColumnFiltersState) => {\r\n        const next = prev.filter((f) => f.id !== id);\r\n        if (value != null && value !== '') {\r\n            next.push({ id, value: id === 'year' ? Number(value) : value } as any);\r\n        }\r\n        return next;\r\n    });\r\n}\r\n\r\n/* ----------------------------------------------------------------------------\r\n   Runtime column augmentation:\r\n   - We do NOT edit columns.ts.\r\n   - Inject aggregation ONLY for 'amount' (sum) so grouped rows display totals.\r\n---------------------------------------------------------------------------- */\r\nfunction useAugmentedColumns() {\r\n    return React.useMemo(() => {\r\n        return (baseColumns as any[]).map((c) => {\r\n            const colId = (c.id ?? c.accessorKey) as string | undefined;\r\n            if (colId === 'amount') {\r\n                return { ...c, aggregationFn: 'sum' as const, meta: { ...(c.meta ?? {}), isNumeric: true } };\r\n            }\r\n            return c;\r\n        });\r\n    }, []);\r\n}\r\n\r\n/* ----------------------------------------------------------------------------\r\n   Component (forwardRef exposes TanStack table if parent ever needs it)\r\n---------------------------------------------------------------------------- */\r\nconst BudgetGrid = React.forwardRef<any, Props>(function BudgetGrid(\r\n    {\r\n        rows,\r\n        initialSorting = [],\r\n        initialFilters = [],\r\n        filters,\r\n        onFiltersChange,\r\n        onUpdateAmount,\r\n        toolbarIds = ['year', 'quarter', 'budgetType', 'category'],\r\n        onGroupingAfterRender,\r\n        fillViewport = false,\r\n        toolbarRight,\r\n    }: Props,\r\n    ref\r\n) {\r\n    // Data / edits\r\n    const [data, setData] = React.useState<BudgetRow[]>(() => rows ?? []);\r\n    React.useEffect(() => {\r\n        if (rows) setData(rows);\r\n    }, [rows]);\r\n\r\n    // Sorting\r\n    const [sorting, setSorting] = React.useState<SortingState>(initialSorting);\r\n\r\n    // Filters: controlled vs uncontrolled\r\n    const controlled = !!filters && !!onFiltersChange;\r\n    const [uncontrolledFilters, setUncontrolledFilters] = React.useState<ColumnFiltersState>(initialFilters);\r\n    const effectiveFilters = controlled ? (filters as ColumnFiltersState) : uncontrolledFilters;\r\n    const setEffectiveFilters = controlled\r\n        ? (onFiltersChange as NonNullable<Props['onFiltersChange']>)\r\n        : setUncontrolledFilters;\r\n\r\n    // Grouping + row expansion\r\n    const [grouping, setGrouping] = React.useState<string[]>([]);\r\n    const [expanded, setExpanded] = React.useState<Record<string, boolean>>({});\r\n\r\n    // SAFETY: mark component mounted before any effects might fire.\r\n    const mountedRef = React.useRef(false);\r\n    React.useLayoutEffect(() => {\r\n        mountedRef.current = true;\r\n        return () => {\r\n            mountedRef.current = false;\r\n        };\r\n    }, []);\r\n\r\n    // A single, guarded dispatcher for column filter changes.\r\n    const onColumnFiltersChangeSafe = React.useCallback(\r\n        (updater: ColumnFiltersState | ((old: ColumnFiltersState) => ColumnFiltersState)) => {\r\n            if (!mountedRef.current) return; // ignore pre-mount emissions\r\n            setEffectiveFilters(updater as any);\r\n        },\r\n        [setEffectiveFilters]\r\n    );\r\n\r\n    // Update from AmountCell (bubbles to page if provided)\r\n    const updateAmountLocal = React.useCallback(\r\n        (rowId: string, newValue: number) => {\r\n            const idx = Number(rowId);\r\n            if (Number.isFinite(idx)) {\r\n                if (onUpdateAmount) {\r\n                    onUpdateAmount(idx, newValue);\r\n                } else {\r\n                    setData((prev) => {\r\n                        if (idx < 0 || idx >= prev.length) return prev;\r\n                        const next = prev.slice();\r\n                        next[idx] = { ...next[idx], amount: newValue };\r\n                        return next;\r\n                    });\r\n                }\r\n            }\r\n        },\r\n        [onUpdateAmount]\r\n    );\r\n\r\n    // Inject aggregation for 'amount' at runtime (no edit to columns.ts)\r\n    const augColumns = useAugmentedColumns();\r\n\r\n    const table = useReactTable<BudgetRow>({\r\n        data,\r\n        columns: augColumns,\r\n        state: {\r\n            sorting,\r\n            columnFilters: effectiveFilters,\r\n            grouping,\r\n            expanded,\r\n        },\r\n        onSortingChange: setSorting,\r\n        // IMPORTANT: route through the guarded handler to avoid pre-mount updates\r\n        onColumnFiltersChange: onColumnFiltersChangeSafe as NonNullable<Props['onFiltersChange']>,\r\n        // IMPORTANT: no onGroupingChange here; we snapshot grouping after render instead\r\n        onExpandedChange: setExpanded,\r\n        getCoreRowModel: getCoreRowModel(),\r\n        getSortedRowModel: getSortedRowModel(),\r\n        getFilteredRowModel: getFilteredRowModel(),\r\n        getGroupedRowModel: getGroupedRowModel(),\r\n        getExpandedRowModel: getExpandedRowModel(),\r\n        enableColumnResizing: true,\r\n        columnResizeMode: 'onChange',\r\n        getRowId: (_row, idx) => String(idx),\r\n        // Expose meta so AmountCell can push edits up\r\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n        // @ts-ignore\r\n        meta: { updateAmount: updateAmountLocal },\r\n    } as TableOptions<BudgetRow>);\r\n\r\n    // Expose TanStack table to parent if needed later\r\n    React.useImperativeHandle(ref, () => table, [table]);\r\n\r\n    // SAFETY: emit grouping snapshot AFTER render; Strict Mode safe\r\n    React.useEffect(() => {\r\n        onGroupingAfterRender?.(grouping);\r\n    }, [grouping, onGroupingAfterRender]);\r\n\r\n    const scrollRef = React.useRef<HTMLDivElement>(null);\r\n    const leafCols = table.getVisibleLeafColumns();\r\n\r\n    // Totals for footer (already filtered — independent of grouping)\r\n    const totalsObj = buildTotalsFromTable(table, ['amount']);\r\n\r\n    // Visual theme\r\n    const HEADER_DIVIDER = '#d0d7df'; // header bottom + header vertical\r\n    const BODY_LINE = '#e1e7ec'; // body vertical/horizontal\r\n    const HEADER_BG = '#f7f9fb'; // subtle gray\r\n\r\n    // Grouping UX\r\n    const groupableColumns: { id: string; label: string }[] = [\r\n        { id: 'community', label: 'Community' },\r\n        { id: 'category', label: 'Category' },\r\n        { id: 'subCategory', label: 'SubCategory' },\r\n        { id: 'year', label: 'Year' },\r\n        { id: 'quarter', label: 'Quarter' },\r\n        { id: 'month', label: 'Month' },\r\n        { id: 'budgetType', label: 'Budget Type' },\r\n    ];\r\n\r\n    const toggleGroup = (id: string) =>\r\n        setGrouping((prev) => (prev.includes(id) ? prev.filter((g) => g !== id) : [...prev, id]));\r\n    const clearGrouping = () => setGrouping([]);\r\n\r\n    // Render\r\n    return (\r\n        <section style={{ display: 'flex', flexDirection: 'column', gap: 10, height: fillViewport ? '100%' : 'auto' }}>\r\n            {/* Grid toolbar row (LEFT: existing ToolbarFilters, RIGHT: injected buttons like AI + Full Screen) */}\r\n            <div\r\n                className=\"grid-toolbar\"\r\n                style={{\r\n                    display: 'flex',\r\n                    alignItems: 'center',\r\n                    justifyContent: 'space-between',\r\n                    gap: 12,\r\n                    flexWrap: 'wrap',\r\n                }}\r\n            >\r\n                <div style={{ flex: '1 1 auto', minWidth: 520 }}>\r\n                    <ToolbarFilters\r\n                        ids={toolbarIds as any}\r\n                        // use the same state abstraction the component already supports\r\n                        // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n                        filters={effectiveFilters as any}\r\n                        // Route toolbar updates through the guarded handler\r\n                        // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n                        setFilters={onColumnFiltersChangeSafe as any}\r\n                        onClear={() => onColumnFiltersChangeSafe([] as any)}\r\n                        onExport={() => {\r\n                            const visibleCols = table.getVisibleLeafColumns();\r\n                            const keys = visibleCols.map((c) => (c.columnDef as any).accessorKey ?? c.id);\r\n                            const filtered = table.getFilteredRowModel().rows.map((r) => r.original as BudgetRow);\r\n                            const csv = toCsv(filtered, keys);\r\n                            downloadBlob(`budget-grid-${new Date().toISOString().slice(0, 10)}.csv`, csv);\r\n                        }}\r\n                        table={table as any}\r\n                    />\r\n                </div>\r\n\r\n                {toolbarRight ? <div style={{ flex: '0 0 auto' }}>{toolbarRight}</div> : null}\r\n            </div>\r\n\r\n            {/* Grouping bar */}\r\n            <div\r\n                className=\"grouping-toolbar\"\r\n                style={{\r\n                    display: 'flex',\r\n                    alignItems: 'center',\r\n                    gap: 10,\r\n                    flexWrap: 'wrap',\r\n                    padding: '6px 8px',\r\n                    border: '1px solid #e5e7eb',\r\n                    borderRadius: 8,\r\n                    background: '#ffffff',\r\n                }}\r\n            >\r\n                <span style={{ fontSize: 12, color: '#475569', fontWeight: 600 }}>Group by:</span>\r\n                {groupableColumns.map(({ id, label }) => {\r\n                    const active = grouping.includes(id);\r\n                    return (\r\n                        <button\r\n                            key={id}\r\n                            type=\"button\"\r\n                            onClick={() => toggleGroup(id)}\r\n                            style={{\r\n                                fontSize: 12,\r\n                                lineHeight: 1,\r\n                                padding: '6px 10px',\r\n                                borderRadius: 14,\r\n                                border: `1px solid ${active ? '#0ea5e9' : '#e5e7eb'}`,\r\n                                background: active ? '#e0f2fe' : '#fff',\r\n                                color: active ? '#0369a1' : '#334155',\r\n                                cursor: 'pointer',\r\n                            }}\r\n                            aria-pressed={active}\r\n                            title={active ? 'Remove from grouping' : 'Add to grouping'}\r\n                        >\r\n                            {label}\r\n                        </button>\r\n                    );\r\n                })}\r\n                <button\r\n                    type=\"button\"\r\n                    onClick={clearGrouping}\r\n                    style={{\r\n                        marginLeft: 'auto',\r\n                        fontSize: 12,\r\n                        lineHeight: 1,\r\n                        padding: '6px 10px',\r\n                        borderRadius: 6,\r\n                        border: '1px solid #e5e7eb',\r\n                        background: '#fff',\r\n                        color: '#334155',\r\n                        cursor: 'pointer',\r\n                    }}\r\n                    title=\"Clear all grouping\"\r\n                >\r\n                    Clear\r\n                </button>\r\n            </div>\r\n\r\n            {/* Scroll container */}\r\n            <div\r\n                ref={scrollRef}\r\n                style={{\r\n                    overflow: 'auto',\r\n                    // When full-screen mode is active, let this container fill its parent wrapper.\r\n                    ...(fillViewport ? { height: '100%', maxHeight: '100%' } : { maxHeight: '70vh' }),\r\n                    border: '1px solid var(--border, #ddd)',\r\n                    borderRadius: 6,\r\n                    background: '#fff',\r\n                }}\r\n            >\r\n                <table\r\n                    style={{\r\n                        width: '100%',\r\n                        borderCollapse: 'separate',\r\n                        borderSpacing: 0,\r\n                        tableLayout: 'fixed',\r\n                    }}\r\n                >\r\n                    {/* column widths */}\r\n                    <colgroup>\r\n                        {leafCols.map((col) => (\r\n                            <col\r\n                                key={`col-${col.id}`}\r\n                                style={{\r\n                                    width: col.getSize(),\r\n                                    minWidth: col.columnDef.minSize ?? 40,\r\n                                    maxWidth: col.columnDef.maxSize ?? Number.POSITIVE_INFINITY,\r\n                                }}\r\n                            />\r\n                        ))}\r\n                    </colgroup>\r\n\r\n                    {/* HEADER (labels) */}\r\n                    <thead>\r\n                        {table.getHeaderGroups().map((hg) => (\r\n                            <tr key={`hdr-${hg.id}`}>\r\n                                {hg.headers.map((h) => {\r\n                                    const canResize = h.column.getCanResize();\r\n                                    return (\r\n                                        <th\r\n                                            key={h.id}\r\n                                            colSpan={h.colSpan}\r\n                                            style={{\r\n                                                position: 'sticky',\r\n                                                top: 0,\r\n                                                zIndex: 5,\r\n                                                background: `var(--th-bg, ${HEADER_BG})`,\r\n                                                textAlign: 'center',\r\n                                                fontWeight: 600,\r\n                                                borderBottom: `1px solid ${HEADER_DIVIDER}`,\r\n                                                borderRight: `1px solid ${HEADER_DIVIDER}`,\r\n                                                padding: '10px 10px',\r\n                                                overflow: 'hidden',\r\n                                                textOverflow: 'ellipsis',\r\n                                                whiteSpace: 'nowrap',\r\n                                            }}\r\n                                        >\r\n                                            {h.isPlaceholder ? null : flexRender(h.column.columnDef.header, h.getContext())}\r\n                                            {canResize && (\r\n                                                <div\r\n                                                    onMouseDown={h.getResizeHandler()}\r\n                                                    onTouchStart={h.getResizeHandler()}\r\n                                                    role=\"separator\"\r\n                                                    aria-orientation=\"vertical\"\r\n                                                    aria-label={`Resize ${String(h.column.id)} column`}\r\n                                                    style={{\r\n                                                        position: 'absolute',\r\n                                                        right: 0,\r\n                                                        top: 0,\r\n                                                        height: '100%',\r\n                                                        width: 6,\r\n                                                        cursor: 'col-resize',\r\n                                                        userSelect: 'none',\r\n                                                        touchAction: 'none',\r\n                                                    }}\r\n                                                />\r\n                                            )}\r\n                                        </th>\r\n                                    );\r\n                                })}\r\n                            </tr>\r\n                        ))}\r\n\r\n                        {/* HEADER FILTER ROW (also sticky, just below labels) */}\r\n                        <tr>\r\n                            {HEADER_FILTER_IDS.map((colId) => {\r\n                                const col = table.getColumn(colId);\r\n                                if (!col)\r\n                                    return (\r\n                                        <th\r\n                                            key={`flt-missing-${colId}`}\r\n                                            style={{\r\n                                                position: 'sticky',\r\n                                                top: 44,\r\n                                                zIndex: 5,\r\n                                                background: `var(--th-bg, ${HEADER_BG})`,\r\n                                                borderBottom: `1px solid ${HEADER_DIVIDER}`,\r\n                                                borderRight: `1px solid ${HEADER_DIVIDER}`,\r\n                                                padding: '6px 8px',\r\n                                            }}\r\n                                        />\r\n                                    );\r\n                                const opts = getColumnOptions(table, colId);\r\n                                const isSelect = ['community', 'category', 'subCategory', 'budgetType', 'year', 'quarter', 'month'].includes(colId);\r\n                                return (\r\n                                    <th\r\n                                        key={`flt-${colId}`}\r\n                                        style={{\r\n                                            position: 'sticky',\r\n                                            top: 44,\r\n                                            zIndex: 5,\r\n                                            background: `var(--th-bg, ${HEADER_BG})`,\r\n                                            borderBottom: `1px solid ${HEADER_DIVIDER}`,\r\n                                            borderRight: `1px solid ${HEADER_DIVIDER}`,\r\n                                            padding: '6px 8px',\r\n                                        }}\r\n                                    >\r\n                                        {isSelect ? (\r\n                                            <select\r\n                                                value={String(col.getFilterValue?.() ?? '')}\r\n                                                onChange={(e) => setFilter(onColumnFiltersChangeSafe as any, colId, e.target.value || undefined)}\r\n                                                style={{\r\n                                                    width: '100%',\r\n                                                    padding: '6px 8px',\r\n                                                    borderRadius: 6,\r\n                                                    border: '1px solid #e5e7eb',\r\n                                                    background: '#fff',\r\n                                                }}\r\n                                                aria-label={`Filter ${colId}`}\r\n                                            >\r\n                                                <option value=\"\">All</option>\r\n                                                {opts.map((o) => (\r\n                                                    <option key={`${colId}:${o}`} value={o}>\r\n                                                        {o}\r\n                                                    </option>\r\n                                                ))}\r\n                                            </select>\r\n                                        ) : (\r\n                                            <input\r\n                                                type=\"text\"\r\n                                                value={String(col.getFilterValue?.() ?? '')}\r\n                                                onChange={(e) => setFilter(onColumnFiltersChangeSafe as any, colId, e.target.value || undefined)}\r\n                                                placeholder={`Filter ${colId}`}\r\n                                                style={{\r\n                                                    width: '100%',\r\n                                                    padding: '6px 8px',\r\n                                                    borderRadius: 6,\r\n                                                    border: '1px solid #e5e7eb',\r\n                                                    background: '#fff',\r\n                                                }}\r\n                                                aria-label={`Filter ${colId}`}\r\n                                            />\r\n                                        )}\r\n                                    </th>\r\n                                );\r\n                            })}\r\n                        </tr>\r\n                    </thead>\r\n\r\n                    {/* BODY */}\r\n                    <tbody>\r\n                        <VirtualRows\r\n                            rows={table.getRowModel().rows}\r\n                            rowHeight={36}\r\n                            overscan={8}\r\n                            scrollContainerRef={scrollRef}\r\n                            visibleColumnCount={leafCols.length}\r\n                            renderRow={(row: Row<BudgetRow>) => (\r\n                                <tr key={row.id}>\r\n                                    {row.getVisibleCells().map((cell: Cell<BudgetRow, unknown>) => {\r\n                                        const isGroupedCell = (cell as any).getIsGrouped?.();\r\n                                        const isAggregated = (cell as any).getIsAggregated?.();\r\n                                        const isPlaceholder = (cell as any).getIsPlaceholder?.();\r\n\r\n                                        // Grouped cell: expander + value + row count\r\n                                        if (isGroupedCell) {\r\n                                            const groupVal = cell.getValue();\r\n                                            const toggle = row.getToggleExpandedHandler();\r\n                                            const expandedNow = row.getIsExpanded();\r\n                                            return (\r\n                                                <td\r\n                                                    key={cell.id}\r\n                                                    style={{\r\n                                                        borderBottom: `1px solid ${BODY_LINE}`,\r\n                                                        borderRight: `1px solid ${BODY_LINE}`,\r\n                                                        padding: '6px 10px',\r\n                                                        background: '#fff',\r\n                                                        fontWeight: 600,\r\n                                                    }}\r\n                                                >\r\n                                                    <button\r\n                                                        type=\"button\"\r\n                                                        onClick={toggle}\r\n                                                        aria-label={expandedNow ? 'Collapse group' : 'Expand group'}\r\n                                                        title={expandedNow ? 'Collapse' : 'Expand'}\r\n                                                        style={{\r\n                                                            marginRight: 8,\r\n                                                            border: '1px solid #e5e7eb',\r\n                                                            background: '#fff',\r\n                                                            borderRadius: 4,\r\n                                                            width: 18,\r\n                                                            height: 18,\r\n                                                            lineHeight: '16px',\r\n                                                            textAlign: 'center',\r\n                                                            fontSize: 12,\r\n                                                            cursor: 'pointer',\r\n                                                        }}\r\n                                                    >\r\n                                                        {expandedNow ? '–' : '+'}\r\n                                                    </button>\r\n                                                    {String(groupVal ?? '')}{' '}\r\n                                                    <span style={{ color: '#64748b', fontWeight: 400 }}>({row.subRows?.length ?? 0})</span>\r\n                                                </td>\r\n                                            );\r\n                                        }\r\n\r\n                                        // Aggregated cell (e.g., Amount totals on group rows)\r\n                                        if (isAggregated) {\r\n                                            const v = cell.getValue();\r\n                                            const isNumeric = ((cell.column.columnDef as any).meta?.isNumeric ?? false) === true;\r\n                                            return (\r\n                                                <td\r\n                                                    key={cell.id}\r\n                                                    style={{\r\n                                                        borderBottom: `1px solid ${BODY_LINE}`,\r\n                                                        borderRight: `1px solid ${BODY_LINE}`,\r\n                                                        padding: '6px 10px',\r\n                                                        background: '#fff',\r\n                                                        fontWeight: 600,\r\n                                                        textAlign: isNumeric ? 'right' : 'left',\r\n                                                    }}\r\n                                                >\r\n                                                    {cell.column.id === 'amount' ? formatCurrency(Number(v) || 0) : String(v ?? '')}\r\n                                                </td>\r\n                                            );\r\n                                        }\r\n\r\n                                        // Placeholder cell\r\n                                        if (isPlaceholder) {\r\n                                            return (\r\n                                                <td\r\n                                                    key={cell.id}\r\n                                                    style={{\r\n                                                        borderBottom: `1px solid ${BODY_LINE}`,\r\n                                                        borderRight: `1px solid ${BODY_LINE}`,\r\n                                                        padding: '6px 10px',\r\n                                                        background: '#fff',\r\n                                                    }}\r\n                                                />\r\n                                            );\r\n                                        }\r\n\r\n                                        // Leaf cell\r\n                                        const isNumeric = ((cell.column.columnDef as any).meta?.isNumeric ?? false) === true;\r\n                                        return (\r\n                                            <td\r\n                                                key={cell.id}\r\n                                                style={{\r\n                                                    borderBottom: `1px solid ${BODY_LINE}`,\r\n                                                    borderRight: `1px solid ${BODY_LINE}`,\r\n                                                    padding: '6px 10px',\r\n                                                    overflow: 'hidden',\r\n                                                    textOverflow: 'ellipsis',\r\n                                                    whiteSpace: 'nowrap',\r\n                                                    textAlign: isNumeric ? 'right' : 'left',\r\n                                                    background: '#fff',\r\n                                                }}\r\n                                            >\r\n                                                {flexRender(cell.column.columnDef.cell, cell.getContext())}\r\n                                            </td>\r\n                                        );\r\n                                    })}\r\n                                </tr>\r\n                            )}\r\n                        />\r\n                    </tbody>\r\n\r\n                    {/* FOOTER TOTALS (still visible in grouped & filtered states) */}\r\n                    <tfoot>\r\n                        <tr>\r\n                            {leafCols.map((col, idx) => {\r\n                                const content = col.id === 'amount' ? formatCurrency(totalsObj.amount ?? 0) : idx === 0 ? 'Totals' : '';\r\n                                return (\r\n                                    <td\r\n                                        key={col.id}\r\n                                        style={{\r\n                                            borderTop: `2px solid ${HEADER_DIVIDER}`,\r\n                                            borderRight: `1px solid ${BODY_LINE}`,\r\n                                            fontWeight: 600,\r\n                                            padding: '8px 10px',\r\n                                            textAlign: col.id === 'amount' ? 'right' : 'left',\r\n                                            background: '#fbfcfd',\r\n                                        }}\r\n                                    >\r\n                                        {content}\r\n                                    </td>\r\n                                );\r\n                            })}\r\n                        </tr>\r\n                    </tfoot>\r\n                </table>\r\n            </div>\r\n        </section>\r\n    );\r\n});\r\n\r\nexport default BudgetGrid;\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1397, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/JeremyJoyner/code/budgetintelligence/components/ai/insightsEngine.ts"],"sourcesContent":["\r\n// /components/ai/insightsEngine.ts\r\n// Non-UI \"engine\": accepts data, returns structured insight objects.\r\n// Mocked for now, designed to be replaced with real analytics or LLM calls.\r\n\r\nimport type { InsightsInput, Insight, BudgetRow } from './types';\r\n\r\nfunction fmtCurrency(n: number): string {\r\n    const v = Number.isFinite(n) ? n : 0;\r\n    return v.toLocaleString(undefined, {\r\n        style: 'currency',\r\n        currency: 'USD',\r\n        minimumFractionDigits: 2,\r\n        maximumFractionDigits: 2\r\n    });\r\n}\r\n\r\nfunction safeSum(rows: BudgetRow[]): number {\r\n    return rows.reduce((acc, r) => acc + (typeof r.amount === 'number' ? r.amount : 0), 0);\r\n}\r\n\r\nfunction topCategories(input: InsightsInput, limit = 3): Array<{ category: string; value: number }> {\r\n    const byCat = new Map<string, number>();\r\n    for (const r of input.filteredRows) {\r\n        if (!r.category) continue;\r\n        const val = typeof r.amount === 'number' ? r.amount : 0;\r\n        byCat.set(r.category, (byCat.get(r.category) ?? 0) + val);\r\n    }\r\n    return [...byCat.entries()]\r\n        .map(([category, value]) => ({ category, value }))\r\n        .sort((a, b) => Math.abs(b.value) - Math.abs(a.value))\r\n        .slice(0, limit);\r\n}\r\n\r\nfunction guessYOY(input: InsightsInput): { delta: number; pct: number } | null {\r\n    // Heuristic YOY using period strings (YYYY-MM). If period not present, returns null.\r\n    const byYear = new Map<number, number>();\r\n    for (const r of input.filteredRows) {\r\n        let yr: number | undefined = r.year;\r\n        if (!yr && r.period && /^\\d{4}-\\d{2}$/.test(r.period)) {\r\n            yr = Number(r.period.slice(0, 4));\r\n        }\r\n        if (!yr) continue;\r\n        const amt = typeof r.amount === 'number' ? r.amount : 0;\r\n        byYear.set(yr, (byYear.get(yr) ?? 0) + amt);\r\n    }\r\n    if (byYear.size < 2) return null;\r\n    const years = [...byYear.keys()].sort();\r\n    const latest = years[years.length - 1];\r\n    const prev = years[years.length - 2];\r\n    const curVal = byYear.get(latest) ?? 0;\r\n    const prevVal = byYear.get(prev) ?? 0;\r\n    const delta = curVal - prevVal;\r\n    const pct = prevVal !== 0 ? delta / prevVal : 0;\r\n    return { delta, pct };\r\n}\r\n\r\nexport async function generateInsights(input: InsightsInput): Promise<Insight[]> {\r\n    // Respect cancellation\r\n    if (input.signal?.aborted) return [];\r\n\r\n    // Keep it non-blocking: tiny delay simulates async work without blocking UI\r\n    await new Promise<void>((resolve, reject) => {\r\n        const t = setTimeout(resolve, 10);\r\n        input.signal?.addEventListener('abort', () => {\r\n            clearTimeout(t);\r\n            reject(new DOMException('Aborted', 'AbortError'));\r\n        });\r\n    });\r\n\r\n    const insights: Insight[] = [];\r\n\r\n    // 1) KPI narrative\r\n    insights.push({\r\n        id: 'kpi-1',\r\n        type: 'kpi_narrative',\r\n        title: 'KPI overview',\r\n        description: `Revenue ${fmtCurrency(input.totals.revenue)}, Expense ${fmtCurrency(\r\n            input.totals.expense\r\n        )}, Net ${fmtCurrency(input.totals.net)}.`,\r\n        severity: 'info',\r\n        // format highlights as strings; no extra \"USD\" unit needed\r\n        highlights: [\r\n            { label: 'Revenue', value: fmtCurrency(input.totals.revenue) },\r\n            { label: 'Expense', value: fmtCurrency(input.totals.expense) },\r\n            { label: 'Net', value: fmtCurrency(input.totals.net) }\r\n        ]\r\n    });\r\n\r\n    // 2) Top categories by absolute value in-current filter context\r\n    const top3 = topCategories(input, 3);\r\n    if (top3.length) {\r\n        insights.push({\r\n            id: 'top-cat',\r\n            type: 'trend',\r\n            title: 'Top categories by spend/revenue (filtered scope)',\r\n            description: top3\r\n                .map((c, i) => `${i + 1}. ${c.category}: ${fmtCurrency(c.value)}`)\r\n                .join(' · '),\r\n            severity: 'info',\r\n            highlights: top3.map((c) => ({ label: c.category, value: fmtCurrency(c.value) }))\r\n        });\r\n    }\r\n\r\n    // 3) Simple outlier (row-level) — largest absolute single line in the filter\r\n    const largest = [...input.filteredRows]\r\n        .filter((r) => typeof r.amount === 'number')\r\n        .sort((a, b) => Math.abs((b.amount ?? 0)) - Math.abs((a.amount ?? 0)))[0];\r\n    if (largest && typeof largest.amount === 'number') {\r\n        insights.push({\r\n            id: 'outlier-1',\r\n            type: 'outlier',\r\n            title: 'Largest single line item',\r\n            description: `${largest.community ?? '—'} · ${largest.category ?? '—'}${largest.subCategory ? ` – ${largest.subCategory}` : ''\r\n                }: ${fmtCurrency(largest.amount)}`,\r\n            severity: 'warning',\r\n            context: { community: largest.community, category: largest.category, subCategory: largest.subCategory },\r\n            highlights: [{ label: 'Amount', value: fmtCurrency(largest.amount) }]\r\n        });\r\n    }\r\n\r\n    // 4) YOY variance (heuristic)\r\n    const yoy = guessYOY(input);\r\n    if (yoy) {\r\n        insights.push({\r\n            id: 'yoy-1',\r\n            type: 'variance',\r\n            title: 'Year-over-year change (filtered scope)',\r\n            description: `Δ ${fmtCurrency(yoy.delta)} (${(yoy.pct * 100).toFixed(1)}%) vs prior year.`,\r\n            severity: Math.abs(yoy.pct) > 0.05 ? 'warning' : 'info',\r\n            highlights: [\r\n                { label: 'Δ (absolute)', value: fmtCurrency(yoy.delta) },\r\n                { label: 'Δ (percent)', value: `${(yoy.pct * 100).toFixed(1)}%` }\r\n            ]\r\n        });\r\n    }\r\n\r\n    // 5) Recommendation (stub)\r\n    const totalFiltered = safeSum(input.filteredRows);\r\n    insights.push({\r\n        id: 'rec-1',\r\n        type: 'recommendation',\r\n        title: 'Quick follow-up',\r\n        description:\r\n            totalFiltered < 0\r\n                ? 'Consider reviewing expense categories with the steepest QOQ growth for potential reductions.'\r\n                : 'Consider spotlighting top-performing revenue categories for this quarter in the AGM review.',\r\n        severity: 'info'\r\n    });\r\n\r\n    return insights;\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1567, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/JeremyJoyner/code/budgetintelligence/components/AIInsightsPanel.tsx"],"sourcesContent":["\r\n// /components/AIInsightsPanel.tsx\r\n'use client';\r\n\r\nimport React from 'react';\r\nimport { generateInsights } from './ai/insightsEngine';\r\nimport type { Insight, InsightsInput } from './ai/types';\r\n\r\nexport interface AIInsightsPanelProps extends InsightsInput {\r\n    open: boolean;\r\n    onClose: () => void;\r\n    // Optional: title override\r\n    title?: string;\r\n}\r\n\r\n/**\r\n * Right-side drawer (540px) that never blocks initial page render.\r\n * Safe for React 18 Strict Mode + Next.js hydration.\r\n */\r\nexport default function AIInsightsPanel(props: AIInsightsPanelProps) {\r\n    const { open, onClose, title = 'AI Insights', ...input } = props;\r\n\r\n    const [loading, setLoading] = React.useState<boolean>(false);\r\n    const [insights, setInsights] = React.useState<Insight[]>([]);\r\n    const [error, setError] = React.useState<string | null>(null);\r\n\r\n    // Generate insights when panel opens or inputs change\r\n    React.useEffect(() => {\r\n        if (!open) return;\r\n\r\n        const controller = new AbortController();\r\n        setLoading(true);\r\n        setError(null);\r\n\r\n        generateInsights({ ...input, signal: controller.signal })\r\n            .then((res) => {\r\n                setInsights(res);\r\n                setLoading(false);\r\n            })\r\n            .catch((err) => {\r\n                if (err?.name === 'AbortError') return; // silent on abort\r\n                setError(err?.message ?? 'Failed to generate insights.');\r\n                setLoading(false);\r\n            });\r\n\r\n        return () => controller.abort();\r\n        // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    }, [open, input.rows, input.filteredRows, JSON.stringify(input.grouping), JSON.stringify(input.totals)]);\r\n\r\n    // A11y: close on Escape\r\n    React.useEffect(() => {\r\n        if (!open) return;\r\n        const onKey = (e: KeyboardEvent) => {\r\n            if (e.key === 'Escape') onClose();\r\n        };\r\n        window.addEventListener('keydown', onKey);\r\n        return () => window.removeEventListener('keydown', onKey);\r\n    }, [open, onClose]);\r\n\r\n    return (\r\n        <>\r\n            {/* Overlay */}\r\n            <div\r\n                aria-hidden={!open}\r\n                onClick={onClose}\r\n                style={{\r\n                    position: 'fixed',\r\n                    inset: 0,\r\n                    background: open ? 'rgba(0,0,0,0.35)' : 'transparent',\r\n                    opacity: open ? 1 : 0,\r\n                    pointerEvents: open ? 'auto' : 'none',\r\n                    transition: 'opacity 150ms ease',\r\n                    zIndex: 50\r\n                }}\r\n            />\r\n            {/* Drawer */}\r\n            <aside\r\n                role=\"dialog\"\r\n                aria-modal=\"true\"\r\n                aria-label={title}\r\n                style={{\r\n                    position: 'fixed',\r\n                    top: 0,\r\n                    right: 0,\r\n                    height: '100%',\r\n                    width: 540,\r\n                    maxWidth: '100vw',\r\n                    background: '#fff',\r\n                    boxShadow: 'rgba(0, 0, 0, 0.2) 0px 0px 20px',\r\n                    transform: open ? 'translateX(0)' : 'translateX(100%)',\r\n                    transition: 'transform 200ms ease',\r\n                    zIndex: 51,\r\n                    display: 'flex',\r\n                    flexDirection: 'column'\r\n                }}\r\n            >\r\n                {/* Header */}\r\n                <div\r\n                    style={{\r\n                        padding: '16px 20px',\r\n                        borderBottom: '1px solid #e5e7eb',\r\n                        display: 'flex',\r\n                        alignItems: 'center',\r\n                        justifyContent: 'space-between'\r\n                    }}\r\n                >\r\n                    <h2 style={{ fontSize: 18, fontWeight: 600, margin: 0 }}>{title}</h2>\r\n                    <button\r\n                        type=\"button\"\r\n                        aria-label=\"Close insights\"\r\n                        onClick={onClose}\r\n                        style={{\r\n                            appearance: 'none',\r\n                            border: 0,\r\n                            background: 'transparent',\r\n                            cursor: 'pointer',\r\n                            padding: 8,\r\n                            borderRadius: 8\r\n                        }}\r\n                    >\r\n                        <svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\">\r\n                            <path d=\"M18 6L6 18M6 6l12 12\" strokeWidth=\"2\" strokeLinecap=\"round\" />\r\n                        </svg>\r\n                    </button>\r\n                </div>\r\n\r\n                {/* Body */}\r\n                <div style={{ padding: 16, overflow: 'auto' }}>\r\n                    {loading && (\r\n                        <div style={{ color: '#6b7280', fontSize: 14 }}>Generating insights…</div>\r\n                    )}\r\n                    {error && (\r\n                        <div style={{ color: '#b91c1c', fontSize: 14 }}>Error: {error}</div>\r\n                    )}\r\n                    {!loading && !error && insights.length === 0 && (\r\n                        <div style={{ color: '#6b7280', fontSize: 14 }}>No insights to display yet.</div>\r\n                    )}\r\n                    {!loading &&\r\n                        !error &&\r\n                        insights.map((ins) => (\r\n                            <article\r\n                                key={ins.id}\r\n                                style={{\r\n                                    border: '1px solid #e5e7eb',\r\n                                    borderRadius: 8,\r\n                                    padding: 12,\r\n                                    marginBottom: 12\r\n                                }}\r\n                            >\r\n                                <header style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\r\n                                    <Badge type={ins.type} />\r\n                                    <h3 style={{ fontSize: 15, fontWeight: 600, margin: 0 }}>{ins.title}</h3>\r\n                                </header>\r\n                                <p style={{ fontSize: 14, color: '#374151', marginTop: 8, marginBottom: 8 }}>\r\n                                    {ins.description}\r\n                                </p>\r\n                                {ins.highlights?.length ? (\r\n                                    <ul style={{ margin: 0, paddingLeft: 18, fontSize: 13, color: '#111827' }}>\r\n                                        {ins.highlights.map((h, i) => (\r\n                                            <li key={i}>\r\n                                                <strong>{h.label}:</strong> {String(h.value)} {h.unit ?? ''}\r\n                                            </li>\r\n                                        ))}\r\n                                    </ul>\r\n                                ) : null}\r\n                            </article>\r\n                        ))}\r\n                </div>\r\n            </aside>\r\n        </>\r\n    );\r\n}\r\n\r\nfunction Badge({ type }: { type: string }) {\r\n    const map: Record<string, { bg: string; fg: string; label: string }> = {\r\n        kpi_narrative: { bg: '#EEF2FF', fg: '#3730A3', label: 'KPI' },\r\n        trend: { bg: '#ECFEFF', fg: '#155E75', label: 'Trend' },\r\n        variance: { bg: '#FEF3C7', fg: '#92400E', label: 'Variance' },\r\n        peer_comparison: { bg: '#F5F3FF', fg: '#6D28D9', label: 'Peer' },\r\n        outlier: { bg: '#FEE2E2', fg: '#991B1B', label: 'Outlier' },\r\n        recommendation: { bg: '#E0F2FE', fg: '#075985', label: 'Rec' }\r\n    };\r\n    const { bg, fg, label } = map[type] ?? { bg: '#F3F4F6', fg: '#374151', label: type };\r\n    return (\r\n        <span\r\n            style={{\r\n                background: bg,\r\n                color: fg,\r\n                fontSize: 12,\r\n                fontWeight: 600,\r\n                borderRadius: 999,\r\n                padding: '2px 8px'\r\n            }}\r\n        >\r\n            {label}\r\n        </span>\r\n    );\r\n}\r\n``\r\n"],"names":[],"mappings":";;;;;AAIA;AACA;AAJA,kCAAkC;AAClC;;;;AAiBe,SAAS,gBAAgB,KAA2B;IAC/D,MAAM,EAAE,IAAI,EAAE,OAAO,EAAE,QAAQ,aAAa,EAAE,GAAG,OAAO,GAAG;IAE3D,MAAM,CAAC,SAAS,WAAW,GAAG,gNAAK,CAAC,QAAQ,CAAU;IACtD,MAAM,CAAC,UAAU,YAAY,GAAG,gNAAK,CAAC,QAAQ,CAAY,EAAE;IAC5D,MAAM,CAAC,OAAO,SAAS,GAAG,gNAAK,CAAC,QAAQ,CAAgB;IAExD,sDAAsD;IACtD,gNAAK,CAAC,SAAS,CAAC;QACZ,IAAI,CAAC,MAAM;QAEX,MAAM,aAAa,IAAI;QACvB,WAAW;QACX,SAAS;QAET,IAAA,sJAAgB,EAAC;YAAE,GAAG,KAAK;YAAE,QAAQ,WAAW,MAAM;QAAC,GAClD,IAAI,CAAC,CAAC;YACH,YAAY;YACZ,WAAW;QACf,GACC,KAAK,CAAC,CAAC;YACJ,IAAI,KAAK,SAAS,cAAc,QAAQ,kBAAkB;YAC1D,SAAS,KAAK,WAAW;YACzB,WAAW;QACf;QAEJ,OAAO,IAAM,WAAW,KAAK;IAC7B,uDAAuD;IAC3D,GAAG;QAAC;QAAM,MAAM,IAAI;QAAE,MAAM,YAAY;QAAE,KAAK,SAAS,CAAC,MAAM,QAAQ;QAAG,KAAK,SAAS,CAAC,MAAM,MAAM;KAAE;IAEvG,wBAAwB;IACxB,gNAAK,CAAC,SAAS,CAAC;QACZ,IAAI,CAAC,MAAM;QACX,MAAM,QAAQ,CAAC;YACX,IAAI,EAAE,GAAG,KAAK,UAAU;QAC5B;QACA,OAAO,gBAAgB,CAAC,WAAW;QACnC,OAAO,IAAM,OAAO,mBAAmB,CAAC,WAAW;IACvD,GAAG;QAAC;QAAM;KAAQ;IAElB,qBACI;;0BAEI,8OAAC;gBACG,eAAa,CAAC;gBACd,SAAS;gBACT,OAAO;oBACH,UAAU;oBACV,OAAO;oBACP,YAAY,OAAO,qBAAqB;oBACxC,SAAS,OAAO,IAAI;oBACpB,eAAe,OAAO,SAAS;oBAC/B,YAAY;oBACZ,QAAQ;gBACZ;;;;;;0BAGJ,8OAAC;gBACG,MAAK;gBACL,cAAW;gBACX,cAAY;gBACZ,OAAO;oBACH,UAAU;oBACV,KAAK;oBACL,OAAO;oBACP,QAAQ;oBACR,OAAO;oBACP,UAAU;oBACV,YAAY;oBACZ,WAAW;oBACX,WAAW,OAAO,kBAAkB;oBACpC,YAAY;oBACZ,QAAQ;oBACR,SAAS;oBACT,eAAe;gBACnB;;kCAGA,8OAAC;wBACG,OAAO;4BACH,SAAS;4BACT,cAAc;4BACd,SAAS;4BACT,YAAY;4BACZ,gBAAgB;wBACpB;;0CAEA,8OAAC;gCAAG,OAAO;oCAAE,UAAU;oCAAI,YAAY;oCAAK,QAAQ;gCAAE;0CAAI;;;;;;0CAC1D,8OAAC;gCACG,MAAK;gCACL,cAAW;gCACX,SAAS;gCACT,OAAO;oCACH,YAAY;oCACZ,QAAQ;oCACR,YAAY;oCACZ,QAAQ;oCACR,SAAS;oCACT,cAAc;gCAClB;0CAEA,cAAA,8OAAC;oCAAI,OAAM;oCAAK,QAAO;oCAAK,SAAQ;oCAAY,MAAK;oCAAO,QAAO;8CAC/D,cAAA,8OAAC;wCAAK,GAAE;wCAAuB,aAAY;wCAAI,eAAc;;;;;;;;;;;;;;;;;;;;;;kCAMzE,8OAAC;wBAAI,OAAO;4BAAE,SAAS;4BAAI,UAAU;wBAAO;;4BACvC,yBACG,8OAAC;gCAAI,OAAO;oCAAE,OAAO;oCAAW,UAAU;gCAAG;0CAAG;;;;;;4BAEnD,uBACG,8OAAC;gCAAI,OAAO;oCAAE,OAAO;oCAAW,UAAU;gCAAG;;oCAAG;oCAAQ;;;;;;;4BAE3D,CAAC,WAAW,CAAC,SAAS,SAAS,MAAM,KAAK,mBACvC,8OAAC;gCAAI,OAAO;oCAAE,OAAO;oCAAW,UAAU;gCAAG;0CAAG;;;;;;4BAEnD,CAAC,WACE,CAAC,SACD,SAAS,GAAG,CAAC,CAAC,oBACV,8OAAC;oCAEG,OAAO;wCACH,QAAQ;wCACR,cAAc;wCACd,SAAS;wCACT,cAAc;oCAClB;;sDAEA,8OAAC;4CAAO,OAAO;gDAAE,SAAS;gDAAQ,YAAY;gDAAU,KAAK;4CAAE;;8DAC3D,8OAAC;oDAAM,MAAM,IAAI,IAAI;;;;;;8DACrB,8OAAC;oDAAG,OAAO;wDAAE,UAAU;wDAAI,YAAY;wDAAK,QAAQ;oDAAE;8DAAI,IAAI,KAAK;;;;;;;;;;;;sDAEvE,8OAAC;4CAAE,OAAO;gDAAE,UAAU;gDAAI,OAAO;gDAAW,WAAW;gDAAG,cAAc;4CAAE;sDACrE,IAAI,WAAW;;;;;;wCAEnB,IAAI,UAAU,EAAE,uBACb,8OAAC;4CAAG,OAAO;gDAAE,QAAQ;gDAAG,aAAa;gDAAI,UAAU;gDAAI,OAAO;4CAAU;sDACnE,IAAI,UAAU,CAAC,GAAG,CAAC,CAAC,GAAG,kBACpB,8OAAC;;sEACG,8OAAC;;gEAAQ,EAAE,KAAK;gEAAC;;;;;;;wDAAU;wDAAE,OAAO,EAAE,KAAK;wDAAE;wDAAE,EAAE,IAAI,IAAI;;mDADpD;;;;;;;;;mDAKjB;;mCAvBC,IAAI,EAAE;;;;;;;;;;;;;;;;;;;AA8B3C;AAEA,SAAS,MAAM,EAAE,IAAI,EAAoB;IACrC,MAAM,MAAiE;QACnE,eAAe;YAAE,IAAI;YAAW,IAAI;YAAW,OAAO;QAAM;QAC5D,OAAO;YAAE,IAAI;YAAW,IAAI;YAAW,OAAO;QAAQ;QACtD,UAAU;YAAE,IAAI;YAAW,IAAI;YAAW,OAAO;QAAW;QAC5D,iBAAiB;YAAE,IAAI;YAAW,IAAI;YAAW,OAAO;QAAO;QAC/D,SAAS;YAAE,IAAI;YAAW,IAAI;YAAW,OAAO;QAAU;QAC1D,gBAAgB;YAAE,IAAI;YAAW,IAAI;YAAW,OAAO;QAAM;IACjE;IACA,MAAM,EAAE,EAAE,EAAE,EAAE,EAAE,KAAK,EAAE,GAAG,GAAG,CAAC,KAAK,IAAI;QAAE,IAAI;QAAW,IAAI;QAAW,OAAO;IAAK;IACnF,qBACI,8OAAC;QACG,OAAO;YACH,YAAY;YACZ,OAAO;YACP,UAAU;YACV,YAAY;YACZ,cAAc;YACd,SAAS;QACb;kBAEC;;;;;;AAGb;AACA,EAAE"}},
    {"offset": {"line": 1934, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/JeremyJoyner/code/budgetintelligence/app/agm/budget/page.tsx"],"sourcesContent":["\r\n'use client';\r\n\r\nimport * as React from 'react';\r\nimport type { ColumnFiltersState } from '@tanstack/react-table';\r\nimport BudgetGrid from '../../../components/BudgetGrid.tanstack';\r\nimport AIInsightsPanel from '../../../components/AIInsightsPanel';\r\nimport type { BudgetRow as AIBudgetRow, Totals as AITotals } from '../../../components/ai/types';\r\nimport {\r\n    BudgetRow,\r\n    deriveYear,\r\n    deriveQuarterLabel,\r\n    deriveMonthLabel,\r\n    mapBudgetType,\r\n} from '../../../components/grid/columns';\r\n\r\n/* ============================================================================\r\n   DATA LOADER\r\n   ============================================================================ */\r\nconst DATA_URL = '/budgetLines.json';\r\n\r\nasync function loadRows(): Promise<BudgetRow[]> {\r\n    const res = await fetch(DATA_URL, { cache: 'no-store' });\r\n    if (!res.ok) throw new Error(`Failed to load ${DATA_URL} (HTTP ${res.status})`);\r\n\r\n    const json: unknown = await res.json();\r\n    if (!Array.isArray(json)) {\r\n        throw new Error(`Unexpected JSON shape from ${DATA_URL}`);\r\n    }\r\n\r\n    return json.map((r): BudgetRow => ({\r\n        ...(r as any),\r\n        community: String((r as any).community ?? ''),\r\n        category: String((r as any).category ?? ''),\r\n        subCategory: String((r as any).subCategory ?? ''),\r\n        period: String((r as any).period ?? ''),\r\n        type: String((r as any).type ?? ''),\r\n        amount: Number((r as any).amount ?? 0),\r\n    }));\r\n}\r\n\r\n/* ============================================================================\r\n   UI HELPERS\r\n   ============================================================================ */\r\nconst Label = ({ children }: { children: React.ReactNode }) => (\r\n    <div style={{ fontSize: 12, color: '#6b7a8a', fontWeight: 600, marginBottom: 4 }}>{children}</div>\r\n);\r\n\r\nconst SmallCard = ({ title, value }: { title: string; value: string }) => (\r\n    <div\r\n        style={{\r\n            background: '#fff',\r\n            border: '1px solid #e9eef1',\r\n            borderRadius: 10,\r\n            padding: '10px 12px',\r\n            display: 'flex',\r\n            flexDirection: 'column',\r\n            gap: 4,\r\n            minHeight: 64,\r\n            minWidth: 170,\r\n        }}\r\n    >\r\n        <div style={{ fontSize: 11, color: '#7a8a99' }}>{title}</div>\r\n        <div style={{ fontSize: 22, fontWeight: 600 }}>{value}</div>\r\n    </div>\r\n);\r\n\r\n/* ============================================================================\r\n   MULTI-SELECT GROUPED\r\n   ============================================================================ */\r\ntype GroupedOptions = Array<{ group: string; items: string[] }>;\r\n\r\nfunction MultiSelectGrouped({\r\n    placeholder,\r\n    groups,\r\n    selected,\r\n    onChange,\r\n    width,\r\n}: {\r\n    placeholder: string;\r\n    groups: GroupedOptions;\r\n    selected: Set<string>;\r\n    onChange: (next: Set<string>) => void;\r\n    width: number;\r\n}) {\r\n    const [open, setOpen] = React.useState(false);\r\n    const containerRef = React.useRef<HTMLDivElement | null>(null);\r\n\r\n    const toggleItem = React.useCallback(\r\n        (item: string) => {\r\n            const next = new Set(selected);\r\n            next.has(item) ? next.delete(item) : next.add(item);\r\n            onChange(next);\r\n        },\r\n        [selected, onChange]\r\n    );\r\n\r\n    const toggleGroup = React.useCallback(\r\n        (items: string[]) => {\r\n            const next = new Set(selected);\r\n            const allSelected = items.every((i) => next.has(i));\r\n            if (allSelected) items.forEach((i) => next.delete(i));\r\n            else items.forEach((i) => next.add(i));\r\n            onChange(next);\r\n        },\r\n        [selected, onChange]\r\n    );\r\n\r\n    React.useEffect(() => {\r\n        if (!open) return;\r\n        const handle = (e: MouseEvent) => {\r\n            if (containerRef.current && !containerRef.current.contains(e.target as Node)) {\r\n                setOpen(false);\r\n            }\r\n        };\r\n        document.addEventListener('mousedown', handle);\r\n        return () => document.removeEventListener('mousedown', handle);\r\n    }, [open]);\r\n\r\n    const summary = React.useMemo(() => {\r\n        const count = selected.size;\r\n        if (count === 0) return placeholder;\r\n        if (count <= 2) return Array.from(selected).join(', ');\r\n        return `${count} selected`;\r\n    }, [selected, placeholder]);\r\n\r\n    return (\r\n        <div ref={containerRef} style={{ position: 'relative', width }}>\r\n            <button\r\n                type=\"button\"\r\n                onClick={() => setOpen((o) => !o)}\r\n                style={{\r\n                    width: '100%',\r\n                    padding: '8px 10px',\r\n                    borderRadius: 8,\r\n                    border: '1px solid #e5e5e5',\r\n                    background: '#fff',\r\n                    textAlign: 'left',\r\n                }}\r\n            >\r\n                {summary}\r\n            </button>\r\n\r\n            {open && (\r\n                <div\r\n                    role=\"listbox\"\r\n                    style={{\r\n                        position: 'absolute',\r\n                        zIndex: 80,\r\n                        top: 'calc(100% + 6px)',\r\n                        left: 0,\r\n                        width: Math.max(260, width),\r\n                        maxHeight: 320,\r\n                        overflowY: 'auto',\r\n                        background: '#fff',\r\n                        border: '1px solid #e5e5e5',\r\n                        borderRadius: 8,\r\n                        boxShadow: '0 8px 24px rgba(0,0,0,0.08)',\r\n                        padding: 10,\r\n                    }}\r\n                >\r\n                    {groups.map(({ group, items }) => {\r\n                        const allSelected = items.every((i) => selected.has(i));\r\n                        const someSelected = items.some((i) => selected.has(i));\r\n\r\n                        return (\r\n                            <div\r\n                                key={group}\r\n                                style={{\r\n                                    paddingBottom: 10,\r\n                                    marginBottom: 10,\r\n                                    borderBottom: '1px solid #f0f3f6',\r\n                                }}\r\n                            >\r\n                                <label style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 6 }}>\r\n                                    <input\r\n                                        type=\"checkbox\"\r\n                                        checked={allSelected}\r\n                                        ref={(el) => {\r\n                                            if (el) el.indeterminate = !allSelected && someSelected;\r\n                                        }}\r\n                                        onChange={() => toggleGroup(items)}\r\n                                    />\r\n                                    <span style={{ fontWeight: 700, fontSize: 12, color: '#334155' }}>{group}</span>\r\n                                </label>\r\n\r\n                                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 4 }}>\r\n                                    {items.map((item) => (\r\n                                        <label\r\n                                            key={item}\r\n                                            style={{\r\n                                                display: 'flex',\r\n                                                alignItems: 'center',\r\n                                                gap: 6,\r\n                                                fontSize: 13,\r\n                                            }}\r\n                                        >\r\n                                            <input type=\"checkbox\" checked={selected.has(item)} onChange={() => toggleItem(item)} />\r\n                                            {item}\r\n                                        </label>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n                        );\r\n                    })}\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\n/* ============================================================================\r\n   PAGE\r\n   ============================================================================ */\r\nexport default function AgmBudgetPage() {\r\n    const [rows, setRows] = React.useState<BudgetRow[]>([]);\r\n    const [loading, setLoading] = React.useState(true);\r\n    const [error, setError] = React.useState<string | null>(null);\r\n\r\n    React.useEffect(() => {\r\n        let alive = true;\r\n        (async () => {\r\n            try {\r\n                const data = await loadRows();\r\n                if (!alive) return;\r\n                setRows(data);\r\n                if (data.length === 0) setError('No data found at /budgetLines.json');\r\n            } catch (err: any) {\r\n                if (!alive) return;\r\n                setError(err?.message || 'Failed to load /budgetLines.json');\r\n            } finally {\r\n                if (alive) setLoading(false);\r\n            }\r\n        })();\r\n\r\n        return () => {\r\n            alive = false;\r\n        };\r\n    }, []);\r\n\r\n    /* --------------------------------------------------------------------------\r\n       FILTER STATE\r\n       -------------------------------------------------------------------------- */\r\n    const [filters, setFilters] = React.useState<ColumnFiltersState>([]);\r\n    const get = (id: string) => filters.find((f) => f.id === id)?.value ?? '';\r\n\r\n    const selected = {\r\n        community: get('community') as string,\r\n        year: (get('year') as number) || '',\r\n        quarter: get('quarter') as string,\r\n        month: get('month') as string,\r\n        budgetType: get('budgetType') as string,\r\n        category: get('category') as string,\r\n    };\r\n\r\n    /* --------------------------------------------------------------------------\r\n       OPTIONS\r\n       -------------------------------------------------------------------------- */\r\n    const allCommunities = React.useMemo(\r\n        () => Array.from(new Set(rows.map((r) => r.community).filter(Boolean))).sort(),\r\n        [rows]\r\n    );\r\n\r\n    const allYears = React.useMemo(\r\n        () => Array.from(new Set(rows.map((r) => deriveYear(r.period)).filter(Boolean))).sort() as number[],\r\n        [rows]\r\n    );\r\n\r\n    const allQuarters = React.useMemo(\r\n        () => Array.from(new Set(rows.map((r) => deriveQuarterLabel(r.period)).filter(Boolean))).sort(),\r\n        [rows]\r\n    );\r\n\r\n    const allMonths = React.useMemo(\r\n        () => Array.from(new Set(rows.map((r) => deriveMonthLabel(r.period)).filter(Boolean))).sort(),\r\n        [rows]\r\n    );\r\n\r\n    const revenueSubcats = React.useMemo(\r\n        () =>\r\n            Array.from(\r\n                new Set(\r\n                    rows\r\n                        .filter((r) => mapBudgetType(r.type) === 'Revenue')\r\n                        .map((r) => (typeof r.subCategory === 'string' ? r.subCategory : ''))\r\n                        .filter((s) => s.length > 0)\r\n                )\r\n            ).sort(),\r\n        [rows]\r\n    );\r\n\r\n    const expenseGroups = React.useMemo<GroupedOptions>(() => {\r\n        const map = new Map<string, Set<string>>();\r\n\r\n        for (const r of rows) {\r\n            const t = mapBudgetType(r.type);\r\n            if (t === 'Expense' || t === 'CapEx') {\r\n                const sub = typeof r.subCategory === 'string' ? r.subCategory.trim() : '';\r\n                if (!sub) continue;\r\n\r\n                const dashIdx = sub.indexOf('-');\r\n                const byPrefix = dashIdx > 0 ? sub.slice(0, dashIdx).trim() : '';\r\n                const fallbackCat = String(r.category ?? '').trim() || (t === 'CapEx' ? 'CapEx' : 'Expense');\r\n                const group = byPrefix || fallbackCat;\r\n\r\n                if (!map.has(group)) map.set(group, new Set<string>());\r\n                map.get(group)!.add(sub);\r\n            }\r\n        }\r\n\r\n        return Array.from(map.entries())\r\n            .map(([group, set]) => ({ group, items: Array.from(set) }))\r\n            .sort((a, b) => a.group.localeCompare(b.group));\r\n    }, [rows]);\r\n\r\n    const revenueGroups: GroupedOptions = React.useMemo(\r\n        () => (revenueSubcats.length ? [{ group: 'Revenue', items: revenueSubcats }] : []),\r\n        [revenueSubcats]\r\n    );\r\n\r\n    /* --------------------------------------------------------------------------\r\n       FILTERED ROWS\r\n       -------------------------------------------------------------------------- */\r\n    const filteredRows = React.useMemo(() => {\r\n        return rows.filter((r) => {\r\n            if (selected.community && r.community !== selected.community) return false;\r\n            if (selected.year && deriveYear(r.period) !== selected.year) return false;\r\n            if (selected.quarter && deriveQuarterLabel(r.period) !== selected.quarter) return false;\r\n            if (selected.month && deriveMonthLabel(r.period) !== selected.month) return false;\r\n            if (selected.budgetType && mapBudgetType(r.type) !== selected.budgetType) return false;\r\n            if (selected.category && r.category !== selected.category) return false;\r\n            return true;\r\n        });\r\n    }, [rows, selected]);\r\n\r\n    /* --------------------------------------------------------------------------\r\n       KPI TOTALS\r\n       -------------------------------------------------------------------------- */\r\n    const totals = React.useMemo(() => {\r\n        let rev = 0,\r\n            exp = 0;\r\n        for (const r of filteredRows) {\r\n            const amt = Number(r.amount ?? 0);\r\n            const bt = mapBudgetType(r.type);\r\n            if (bt === 'Revenue') rev += amt;\r\n            else if (bt === 'Expense' || bt === 'CapEx') exp += amt;\r\n        }\r\n        return { rev, exp, net: rev - exp };\r\n    }, [filteredRows]);\r\n\r\n    const fmt = (n: number) =>\r\n        Intl.NumberFormat(undefined, {\r\n            style: 'currency',\r\n            currency: 'USD',\r\n            maximumFractionDigits: 0,\r\n        }).format(n || 0);\r\n\r\n    /* --------------------------------------------------------------------------\r\n       CATEGORY TOTAL SELECTORS\r\n       -------------------------------------------------------------------------- */\r\n    const [revSel, setRevSel] = React.useState<Set<string>>(new Set());\r\n    const [expSel, setExpSel] = React.useState<Set<string>>(new Set());\r\n\r\n    const revCatTotal = React.useMemo(() => {\r\n        if (!revSel.size) return 0;\r\n        return filteredRows\r\n            .filter((r) => mapBudgetType(r.type) === 'Revenue' && revSel.has(String(r.subCategory)))\r\n            .reduce((sum, r) => sum + Number(r.amount ?? 0), 0);\r\n    }, [filteredRows, revSel]);\r\n\r\n    const expCatTotal = React.useMemo(() => {\r\n        if (!expSel.size) return 0;\r\n        return filteredRows\r\n            .filter((r) => {\r\n                const t = mapBudgetType(r.type);\r\n                return (t === 'Expense' || t === 'CapEx') && expSel.has(String(r.subCategory));\r\n            })\r\n            .reduce((sum, r) => sum + Number(r.amount ?? 0), 0);\r\n    }, [filteredRows, expSel]);\r\n\r\n    /* --------------------------------------------------------------------------\r\n       AI: state + totals in required shape + STRICT-MODE SAFE grouping\r\n       -------------------------------------------------------------------------- */\r\n    const [aiOpen, setAiOpen] = React.useState(false);\r\n    const [groupingKeys, setGroupingKeys] = React.useState<string[]>([]);\r\n\r\n    const aiRows = React.useMemo<AIBudgetRow[]>(\r\n        () =>\r\n            rows.map((r) => ({\r\n                community: String(r.community ?? ''),\r\n                category: String(r.category ?? ''),\r\n                subCategory: typeof r.subCategory === 'string' ? r.subCategory : '',\r\n                budgetMethod: (r as any).budgetMethod ?? undefined,\r\n                driver: (r as any).driver ?? undefined,\r\n                driverTag: (r as any).driverTag ?? undefined,\r\n                glCode: (r as any).glCode ?? null,\r\n                period: String(r.period ?? ''),\r\n                type: String(r.type ?? ''),\r\n                amount: (r as any).amount ?? 0,\r\n            })),\r\n        [rows]\r\n    );\r\n\r\n    const aiFilteredRows = React.useMemo<AIBudgetRow[]>(\r\n        () =>\r\n            filteredRows.map((r) => ({\r\n                community: String(r.community ?? ''),\r\n                category: String(r.category ?? ''),\r\n                subCategory: typeof r.subCategory === 'string' ? r.subCategory : '',\r\n                budgetMethod: (r as any).budgetMethod ?? undefined,\r\n                driver: (r as any).driver ?? undefined,\r\n                driverTag: (r as any).driverTag ?? undefined,\r\n                glCode: (r as any).glCode ?? null,\r\n                period: String(r.period ?? ''),\r\n                type: String(r.type ?? ''),\r\n                amount: (r as any).amount ?? 0,\r\n            })),\r\n        [filteredRows]\r\n    );\r\n\r\n    const aiTotals: AITotals = React.useMemo(() => {\r\n        const byCategory = new Map<string, number>();\r\n        const byCommunity = new Map<string, number>();\r\n        let revenue = 0;\r\n        let expense = 0;\r\n\r\n        for (const r of filteredRows) {\r\n            const amt = Number(r.amount ?? 0);\r\n            const bt = mapBudgetType(r.type);\r\n            if (bt === 'Revenue') revenue += amt;\r\n            else if (bt === 'Expense' || bt === 'CapEx') expense += amt;\r\n\r\n            const cat = String(r.category ?? 'Uncategorized');\r\n            const comm = String(r.community ?? '—');\r\n            byCategory.set(cat, (byCategory.get(cat) ?? 0) + amt);\r\n            byCommunity.set(comm, (byCommunity.get(comm) ?? 0) + amt);\r\n        }\r\n\r\n        return {\r\n            revenue,\r\n            expense,\r\n            net: revenue - expense,\r\n            byCategory: Object.fromEntries(byCategory),\r\n            byCommunity: Object.fromEntries(byCommunity),\r\n        };\r\n    }, [filteredRows]);\r\n\r\n    // --- SAFETY: Only allow setState after the page has mounted (Strict Mode friendly) ---\r\n    const mountedRef = React.useRef(false);\r\n    React.useLayoutEffect(() => {\r\n        mountedRef.current = true;\r\n        return () => {\r\n            mountedRef.current = false;\r\n        };\r\n    }, []);\r\n\r\n    const handleGroupingAfterRender = React.useCallback((keys: string[]) => {\r\n        if (!mountedRef.current) return;\r\n        requestAnimationFrame(() => {\r\n            if (mountedRef.current) setGroupingKeys(keys);\r\n        });\r\n    }, []);\r\n\r\n    const handleFiltersChange = React.useCallback(\r\n        (updater: ColumnFiltersState | ((old: ColumnFiltersState) => ColumnFiltersState)) => {\r\n            if (!mountedRef.current) return;\r\n            setFilters((prev) => (typeof updater === 'function' ? (updater as any)(prev) : updater));\r\n        },\r\n        []\r\n    );\r\n\r\n    /* --------------------------------------------------------------------------\r\n       FULL-SCREEN GRID MODE\r\n       -------------------------------------------------------------------------- */\r\n    const [isFullScreen, setIsFullScreen] = React.useState(false);\r\n    const toggleFullScreen = React.useCallback(() => setIsFullScreen((v) => !v), []);\r\n\r\n    // Measure top offset (under Header)\r\n    const sectionRef = React.useRef<HTMLElement | null>(null);\r\n    const [contentTop, setContentTop] = React.useState<number>(96);\r\n\r\n    React.useLayoutEffect(() => {\r\n        const measure = () => {\r\n            if (!sectionRef.current) return;\r\n            const rect = sectionRef.current.getBoundingClientRect();\r\n            const nextTop = Math.max(64, Math.round(rect.top));\r\n            setContentTop(nextTop);\r\n        };\r\n        measure();\r\n        window.addEventListener('resize', measure);\r\n        return () => window.removeEventListener('resize', measure);\r\n    }, []);\r\n\r\n    // Measure sidebar width so fullscreen fixed layers don't cover it\r\n    const [sidebarW, setSidebarW] = React.useState(0);\r\n    React.useLayoutEffect(() => {\r\n        const aside = document.querySelector('aside') as HTMLElement | null;\r\n        if (!aside) {\r\n            setSidebarW(0);\r\n            return;\r\n        }\r\n\r\n        const measure = () => setSidebarW(Math.round(aside.getBoundingClientRect().width));\r\n\r\n        measure();\r\n        const ro = new ResizeObserver(() => measure());\r\n        ro.observe(aside);\r\n        window.addEventListener('resize', measure);\r\n\r\n        return () => {\r\n            ro.disconnect();\r\n            window.removeEventListener('resize', measure);\r\n        };\r\n    }, []);\r\n\r\n    // Measure dock height so the grid starts below it\r\n    const dockRef = React.useRef<HTMLDivElement | null>(null);\r\n    const [dockH, setDockH] = React.useState(0);\r\n\r\n    React.useLayoutEffect(() => {\r\n        const measureDock = () => {\r\n            if (!dockRef.current) return setDockH(0);\r\n            setDockH(Math.round(dockRef.current.getBoundingClientRect().height));\r\n        };\r\n        measureDock();\r\n        window.addEventListener('resize', measureDock);\r\n        return () => window.removeEventListener('resize', measureDock);\r\n    }, [isFullScreen, selected.community, selected.year, selected.quarter, selected.month, revSel, expSel]);\r\n\r\n    const CATEGORY_WIDTH_NORMAL = 300;\r\n    const CATEGORY_WIDTH_FS = 360; // dropdown column width in fullscreen dock\r\n    const RIGHT_PANEL_MAX = 540;\r\n    const COMPACT = 92;\r\n\r\n    const fsLeft = Math.max(16, sidebarW + 16);\r\n\r\n    // Toolbar right: AI + Fullscreen buttons\r\n    const toolbarRight = (\r\n        <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\r\n            <button\r\n                type=\"button\"\r\n                onClick={() => setAiOpen(true)}\r\n                aria-label=\"Open AI insights\"\r\n                title=\"AI insights\"\r\n                style={{\r\n                    appearance: 'none',\r\n                    border: '1px solid #0ea5e9',\r\n                    background: '#0ea5e9',\r\n                    color: '#fff',\r\n                    borderRadius: 8,\r\n                    padding: '6px 12px',\r\n                    fontWeight: 700,\r\n                    cursor: 'pointer',\r\n                    boxShadow: '0 6px 18px rgba(0,0,0,0.10)',\r\n                }}\r\n            >\r\n                AI\r\n            </button>\r\n\r\n            <button\r\n                type=\"button\"\r\n                onClick={toggleFullScreen}\r\n                aria-pressed={isFullScreen}\r\n                aria-label={isFullScreen ? 'Exit full-screen grid' : 'Enter full-screen grid'}\r\n                title={isFullScreen ? 'Exit full-screen' : 'Full-screen grid'}\r\n                style={{\r\n                    appearance: 'none',\r\n                    border: '1px solid #10b981',\r\n                    background: isFullScreen ? '#065f46' : '#10b981',\r\n                    color: '#fff',\r\n                    borderRadius: 8,\r\n                    padding: '6px 12px',\r\n                    fontWeight: 700,\r\n                    cursor: 'pointer',\r\n                    boxShadow: '0 6px 18px rgba(0,0,0,0.10)',\r\n                }}\r\n            >\r\n                {isFullScreen ? 'Exit Full Screen' : 'Full Screen'}\r\n            </button>\r\n        </div>\r\n    );\r\n\r\n    return (\r\n        <main style={{ padding: 12, display: 'flex', flexDirection: 'column', gap: 6 }}>\r\n            {/* FULLSCREEN DOCK */}\r\n            {isFullScreen && (\r\n                <div\r\n                    ref={dockRef}\r\n                    style={{\r\n                        position: 'fixed',\r\n                        left: fsLeft,\r\n                        right: 16,\r\n                        top: contentTop,\r\n                        zIndex: 55,\r\n                        background: '#ffffff',\r\n                        border: '1px solid #e5e7eb',\r\n                        borderRadius: 12,\r\n                        padding: '10px 12px',\r\n                        boxShadow: '0 8px 24px rgba(0,0,0,0.08)',\r\n                        display: 'flex',\r\n                        flexDirection: 'column',\r\n                        gap: 10,\r\n                    }}\r\n                >\r\n                    {/* Row A: Quick filters + KPI cards */}\r\n                    <div\r\n                        style={{\r\n                            display: 'flex',\r\n                            alignItems: 'flex-end',\r\n                            justifyContent: 'space-between',\r\n                            gap: 14,\r\n                            flexWrap: 'wrap',\r\n                        }}\r\n                    >\r\n                        {/* Quick filters */}\r\n                        <div style={{ display: 'flex', alignItems: 'flex-end', gap: 12, flexWrap: 'wrap' }}>\r\n                            <div>\r\n                                <Label>Community</Label>\r\n                                <select\r\n                                    value={selected.community}\r\n                                    onChange={(e) =>\r\n                                        setFilters((prev: ColumnFiltersState) => {\r\n                                            const v = e.target.value || '';\r\n                                            const next = prev.filter((f) => f.id !== 'community');\r\n                                            if (v) next.push({ id: 'community', value: v });\r\n                                            return next;\r\n                                        })\r\n                                    }\r\n                                    style={{\r\n                                        width: 220,\r\n                                        padding: '8px 10px',\r\n                                        borderRadius: 8,\r\n                                        border: '1px solid #e5e5e5',\r\n                                        background: '#fff',\r\n                                    }}\r\n                                >\r\n                                    <option value=\"\">All</option>\r\n                                    {allCommunities.map((c) => (\r\n                                        <option key={c} value={c}>\r\n                                            {c}\r\n                                        </option>\r\n                                    ))}\r\n                                </select>\r\n                            </div>\r\n\r\n                            <div>\r\n                                <Label>Year</Label>\r\n                                <select\r\n                                    value={String(selected.year || '')}\r\n                                    onChange={(e) =>\r\n                                        setFilters((f: ColumnFiltersState) => {\r\n                                            const next = f.filter((x) => x.id !== 'year');\r\n                                            if (e.target.value) next.push({ id: 'year', value: Number(e.target.value) });\r\n                                            return next;\r\n                                        })\r\n                                    }\r\n                                    style={{\r\n                                        width: COMPACT,\r\n                                        padding: '8px 10px',\r\n                                        borderRadius: 8,\r\n                                        border: '1px solid #e5e5e5',\r\n                                        background: '#fff',\r\n                                    }}\r\n                                >\r\n                                    <option value=\"\">All</option>\r\n                                    {allYears.map((y) => (\r\n                                        <option key={y} value={y}>\r\n                                            {y}\r\n                                        </option>\r\n                                    ))}\r\n                                </select>\r\n                            </div>\r\n\r\n                            <div>\r\n                                <Label>Quarter</Label>\r\n                                <select\r\n                                    value={selected.quarter}\r\n                                    onChange={(e) =>\r\n                                        setFilters((f: ColumnFiltersState) => {\r\n                                            const next = f.filter((x) => x.id !== 'quarter');\r\n                                            if (e.target.value) next.push({ id: 'quarter', value: e.target.value });\r\n                                            return next;\r\n                                        })\r\n                                    }\r\n                                    style={{\r\n                                        width: COMPACT,\r\n                                        padding: '8px 10px',\r\n                                        borderRadius: 8,\r\n                                        border: '1px solid #e5e5e5',\r\n                                        background: '#fff',\r\n                                    }}\r\n                                >\r\n                                    <option value=\"\">All</option>\r\n                                    {allQuarters.map((q) => (\r\n                                        <option key={q} value={q}>\r\n                                            {q}\r\n                                        </option>\r\n                                    ))}\r\n                                </select>\r\n                            </div>\r\n\r\n                            <div>\r\n                                <Label>Month</Label>\r\n                                <select\r\n                                    value={selected.month}\r\n                                    onChange={(e) =>\r\n                                        setFilters((f: ColumnFiltersState) => {\r\n                                            const next = f.filter((x) => x.id !== 'month');\r\n                                            if (e.target.value) next.push({ id: 'month', value: e.target.value });\r\n                                            return next;\r\n                                        })\r\n                                    }\r\n                                    style={{\r\n                                        width: COMPACT,\r\n                                        padding: '8px 10px',\r\n                                        borderRadius: 8,\r\n                                        border: '1px solid #e5e5e5',\r\n                                        background: '#fff',\r\n                                    }}\r\n                                >\r\n                                    <option value=\"\">All</option>\r\n                                    {allMonths.map((m) => (\r\n                                        <option key={m} value={m}>\r\n                                            {m}\r\n                                        </option>\r\n                                    ))}\r\n                                </select>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* KPI cards */}\r\n                        <div style={{ display: 'flex', gap: 10, flexWrap: 'wrap' }}>\r\n                            <SmallCard title=\"TOTAL REVENUE\" value={fmt(totals.rev)} />\r\n                            <SmallCard title=\"TOTAL EXPENSE\" value={fmt(totals.exp)} />\r\n                            <SmallCard title=\"NET\" value={fmt(totals.net)} />\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Row B: Category Totals (tight $ box next to pickers) */}\r\n                    <div style={{ display: 'flex', gap: 14, flexWrap: 'wrap' }}>\r\n                        <div style={{ flex: '0 1 auto' }}>\r\n                            <Label>Revenue Category Totals</Label>\r\n                            <div\r\n                                style={{\r\n                                    display: 'grid',\r\n                                    gridTemplateColumns: `${CATEGORY_WIDTH_FS}px 120px`,\r\n                                    gap: 10,\r\n                                    alignItems: 'center',\r\n                                }}\r\n                            >\r\n                                <MultiSelectGrouped\r\n                                    placeholder=\"Pick category\"\r\n                                    groups={revenueGroups}\r\n                                    selected={revSel}\r\n                                    onChange={setRevSel}\r\n                                    width={CATEGORY_WIDTH_FS}\r\n                                />\r\n                                <div\r\n                                    style={{\r\n                                        border: '1px solid #e5e5e5',\r\n                                        borderRadius: 8,\r\n                                        padding: '8px 10px',\r\n                                        textAlign: 'left',\r\n                                        background: '#fff',\r\n                                        fontWeight: 700,\r\n                                        width: 120,\r\n                                    }}\r\n                                >\r\n                                    {fmt(revCatTotal)}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div style={{ flex: '0 1 auto' }}>\r\n                            <Label>Expense Category Totals</Label>\r\n                            <div\r\n                                style={{\r\n                                    display: 'grid',\r\n                                    gridTemplateColumns: `${CATEGORY_WIDTH_FS}px 120px`,\r\n                                    gap: 10,\r\n                                    alignItems: 'center',\r\n                                }}\r\n                            >\r\n                                <MultiSelectGrouped\r\n                                    placeholder=\"Pick category\"\r\n                                    groups={expenseGroups}\r\n                                    selected={expSel}\r\n                                    onChange={setExpSel}\r\n                                    width={CATEGORY_WIDTH_FS}\r\n                                />\r\n                                <div\r\n                                    style={{\r\n                                        border: '1px solid #e5e5e5',\r\n                                        borderRadius: 8,\r\n                                        padding: '8px 10px',\r\n                                        textAlign: 'left',\r\n                                        background: '#fff',\r\n                                        fontWeight: 700,\r\n                                        width: 120,\r\n                                    }}\r\n                                >\r\n                                    {fmt(expCatTotal)}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* NORMAL (non-fullscreen) layout above the grid */}\r\n            {!isFullScreen && (\r\n                <section\r\n                    ref={sectionRef as any}\r\n                    style={{\r\n                        display: 'grid',\r\n                        gridTemplateColumns: '280px 1fr',\r\n                        columnGap: 40, // 🔥 reduced from 220\r\n                        alignItems: 'start',\r\n                        marginBottom: 4,\r\n                    }}\r\n                >\r\n                    {/* LEFT: Community + KPI cards */}\r\n                    <div>\r\n                        <Label>Community</Label>\r\n                        <select\r\n                            value={selected.community}\r\n                            onChange={(e) =>\r\n                                setFilters((prev: ColumnFiltersState) => {\r\n                                    const v = e.target.value || '';\r\n                                    const next = prev.filter((f) => f.id !== 'community');\r\n                                    if (v) next.push({ id: 'community', value: v });\r\n                                    return next;\r\n                                })\r\n                            }\r\n                            style={{\r\n                                width: '100%',\r\n                                padding: '8px 10px',\r\n                                borderRadius: 8,\r\n                                border: '1px solid #e5e5e5',\r\n                                background: '#fff',\r\n                            }}\r\n                        >\r\n                            <option value=\"\">All</option>\r\n                            {allCommunities.map((c) => (\r\n                                <option key={c} value={c}>\r\n                                    {c}\r\n                                </option>\r\n                            ))}\r\n                        </select>\r\n\r\n                        <div style={{ display: 'flex', flexDirection: 'column', gap: 8, marginTop: 8 }}>\r\n                            <SmallCard title=\"TOTAL REVENUE\" value={fmt(totals.rev)} />\r\n                            <SmallCard title=\"TOTAL EXPENSE\" value={fmt(totals.exp)} />\r\n                            <SmallCard title=\"NET\" value={fmt(totals.net)} />\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* RIGHT: Category totals + Y/Q/M */}\r\n                    <div>\r\n                        <div\r\n                            style={{\r\n                                maxWidth: RIGHT_PANEL_MAX,\r\n                                display: 'flex',\r\n                                flexDirection: 'column',\r\n                                gap: 14,\r\n                            }}\r\n                        >\r\n                            {/* Revenue category totals */}\r\n                            <div>\r\n                                <Label>Revenue Category Totals</Label>\r\n                                <div\r\n                                    style={{\r\n                                        display: 'grid',\r\n                                        gridTemplateColumns: `${CATEGORY_WIDTH_NORMAL}px 120px`, // ✅ fixed\r\n                                        gap: 10,\r\n                                        alignItems: 'center',\r\n                                    }}\r\n                                >\r\n                                    <MultiSelectGrouped\r\n                                        placeholder=\"Pick category\"\r\n                                        groups={revenueGroups}\r\n                                        selected={revSel}\r\n                                        onChange={setRevSel}\r\n                                        width={CATEGORY_WIDTH_NORMAL}\r\n                                    />\r\n                                    <div\r\n                                        style={{\r\n                                            border: '1px solid #e5e5e5',\r\n                                            borderRadius: 8,\r\n                                            padding: '8px 10px',\r\n                                            background: '#fff',\r\n                                            fontWeight: 600,\r\n                                            width: 120,\r\n                                        }}\r\n                                    >\r\n                                        {fmt(revCatTotal)}\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* Expense category totals */}\r\n                            <div>\r\n                                <Label>Expense Category Totals</Label>\r\n                                <div\r\n                                    style={{\r\n                                        display: 'grid',\r\n                                        gridTemplateColumns: `${CATEGORY_WIDTH_NORMAL}px 120px`, // ✅ fixed\r\n                                        gap: 10,\r\n                                        alignItems: 'center',\r\n                                    }}\r\n                                >\r\n                                    <MultiSelectGrouped\r\n                                        placeholder=\"Pick category\"\r\n                                        groups={expenseGroups}\r\n                                        selected={expSel}\r\n                                        onChange={setExpSel}\r\n                                        width={CATEGORY_WIDTH_NORMAL}\r\n                                    />\r\n                                    <div\r\n                                        style={{\r\n                                            border: '1px solid #e5e5e5',\r\n                                            borderRadius: 8,\r\n                                            padding: '8px 10px',\r\n                                            background: '#fff',\r\n                                            fontWeight: 600,\r\n                                            width: 120,\r\n                                        }}\r\n                                    >\r\n                                        {fmt(expCatTotal)}\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* Year / Quarter / Month */}\r\n                            <div style={{ display: 'flex', alignItems: 'flex-end', gap: 12, flexWrap: 'wrap' }}>\r\n                                <div>\r\n                                    <Label>Year</Label>\r\n                                    <select\r\n                                        value={String(selected.year || '')}\r\n                                        onChange={(e) =>\r\n                                            setFilters((f: ColumnFiltersState) => {\r\n                                                const next = f.filter((x) => x.id !== 'year');\r\n                                                if (e.target.value) next.push({ id: 'year', value: Number(e.target.value) });\r\n                                                return next;\r\n                                            })\r\n                                        }\r\n                                        style={{\r\n                                            width: COMPACT,\r\n                                            padding: '8px 10px',\r\n                                            borderRadius: 8,\r\n                                            border: '1px solid #e5e5e5',\r\n                                            background: '#fff',\r\n                                        }}\r\n                                    >\r\n                                        <option value=\"\">All</option>\r\n                                        {allYears.map((y) => (\r\n                                            <option key={y} value={y}>\r\n                                                {y}\r\n                                            </option>\r\n                                        ))}\r\n                                    </select>\r\n                                </div>\r\n\r\n                                <div>\r\n                                    <Label>Quarter</Label>\r\n                                    <select\r\n                                        value={selected.quarter}\r\n                                        onChange={(e) =>\r\n                                            setFilters((f: ColumnFiltersState) => {\r\n                                                const next = f.filter((x) => x.id !== 'quarter');\r\n                                                if (e.target.value) next.push({ id: 'quarter', value: e.target.value });\r\n                                                return next;\r\n                                            })\r\n                                        }\r\n                                        style={{\r\n                                            width: COMPACT,\r\n                                            padding: '8px 10px',\r\n                                            borderRadius: 8,\r\n                                            border: '1px solid #e5e5e5',\r\n                                            background: '#fff',\r\n                                        }}\r\n                                    >\r\n                                        <option value=\"\">All</option>\r\n                                        {allQuarters.map((q) => (\r\n                                            <option key={q} value={q}>\r\n                                                {q}\r\n                                            </option>\r\n                                        ))}\r\n                                    </select>\r\n                                </div>\r\n\r\n                                <div>\r\n                                    <Label>Month</Label>\r\n                                    <select\r\n                                        value={selected.month}\r\n                                        onChange={(e) =>\r\n                                            setFilters((f: ColumnFiltersState) => {\r\n                                                const next = f.filter((x) => x.id !== 'month');\r\n                                                if (e.target.value) next.push({ id: 'month', value: e.target.value });\r\n                                                return next;\r\n                                            })\r\n                                        }\r\n                                        style={{\r\n                                            width: COMPACT,\r\n                                            padding: '8px 10px',\r\n                                            borderRadius: 8,\r\n                                            border: '1px solid #e5e5e5',\r\n                                            background: '#fff',\r\n                                        }}\r\n                                    >\r\n                                        <option value=\"\">All</option>\r\n                                        {allMonths.map((m) => (\r\n                                            <option key={m} value={m}>\r\n                                                {m}\r\n                                            </option>\r\n                                        ))}\r\n                                    </select>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </section>\r\n            )}\r\n\r\n\r\n            {/* GRID */}\r\n            <div\r\n                id=\"grid-wrapper\"\r\n                style={\r\n                    isFullScreen\r\n                        ? {\r\n                            position: 'fixed',\r\n                            left: fsLeft,\r\n                            right: 16,\r\n                            top: contentTop + dockH + 10,\r\n                            bottom: 16,\r\n                            zIndex: 40,\r\n                            background: '#fff',\r\n                            borderRadius: 8,\r\n                            boxShadow: '0 8px 24px rgba(0,0,0,0.06)',\r\n                            overflow: 'hidden',\r\n                            paddingTop: 0,\r\n                        }\r\n                        : { marginTop: -6 }\r\n                }\r\n            >\r\n                <BudgetGrid\r\n                    rows={rows}\r\n                    filters={filters}\r\n                    onFiltersChange={handleFiltersChange}\r\n                    onUpdateAmount={(rowIndex: number, newValue: number) =>\r\n                        setRows((prev) => {\r\n                            if (rowIndex < 0 || rowIndex >= prev.length) return prev;\r\n                            const next = prev.slice();\r\n                            next[rowIndex] = { ...next[rowIndex], amount: newValue };\r\n                            return next;\r\n                        })\r\n                    }\r\n                    toolbarIds={[]}\r\n                    onGroupingAfterRender={handleGroupingAfterRender}\r\n                    fillViewport={isFullScreen}\r\n                    toolbarRight={toolbarRight}\r\n                />\r\n            </div>\r\n\r\n            {!isFullScreen && loading && <div style={{ color: '#6b7a8a' }}>Loading data…</div>}\r\n            {!isFullScreen && error && <div style={{ color: 'crimson' }}>{error}</div>}\r\n\r\n            <AIInsightsPanel\r\n                open={aiOpen}\r\n                onClose={() => setAiOpen(false)}\r\n                rows={aiRows}\r\n                filteredRows={aiFilteredRows}\r\n                grouping={{ keys: groupingKeys }}\r\n                totals={aiTotals}\r\n            />\r\n        </main>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}