{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/JeremyJoyner/code/budgetintelligence/components/grid/AmountCell.tsx"],"sourcesContent":["\r\n// components/grid/AmountCell.tsx\r\nimport * as React from 'react';\r\nimport type { CellContext } from '@tanstack/react-table';\r\nimport type { BudgetRow } from './columns';\r\n\r\n// Currency helpers\r\nconst fmt = new Intl.NumberFormat(undefined, {\r\n    style: 'currency',\r\n    currency: 'USD',\r\n    maximumFractionDigits: 0,\r\n});\r\n\r\nfunction parseCurrency(input: string): number | null {\r\n    // Accept: \"$480,000\", \"480000\", \"480,000\", \"480000.00\"\r\n    if (input == null) return null;\r\n    const stripped = String(input).replace(/[^0-9.-]/g, '');\r\n    if (stripped.trim() === '') return null;\r\n    const n = Number(stripped);\r\n    return Number.isFinite(n) ? n : null;\r\n}\r\n\r\ntype TableMeta = {\r\n    updateAmount?: (rowId: string, newValue: number) => void;\r\n};\r\n\r\nexport default function AmountCell(ctx: CellContext<BudgetRow, unknown>) {\r\n    const { row, getValue, table } = ctx;\r\n    const meta = table.options.meta as TableMeta | undefined;\r\n\r\n    // Show formatted currency when not editing; turn into an <input> when focused/double-clicked\r\n    const initial = getValue() as number | string | null | undefined;\r\n    const initialNumber =\r\n        typeof initial === 'number'\r\n            ? initial\r\n            : typeof initial === 'string'\r\n                ? Number(initial)\r\n                : null;\r\n\r\n    const [isEditing, setEditing] = React.useState(false);\r\n    const [draft, setDraft] = React.useState(\r\n        initialNumber != null ? fmt.format(initialNumber) : ''\r\n    );\r\n\r\n    // Keep local draft in sync if the underlying cell changes from elsewhere\r\n    React.useEffect(() => {\r\n        const n =\r\n            typeof initial === 'number'\r\n                ? initial\r\n                : typeof initial === 'string'\r\n                    ? Number(initial)\r\n                    : null;\r\n        setDraft(n != null ? fmt.format(n) : '');\r\n    }, [initial]);\r\n\r\n    const commit = React.useCallback(() => {\r\n        const n = parseCurrency(draft);\r\n        if (n != null && meta?.updateAmount) {\r\n            meta.updateAmount(row.id, n);\r\n        }\r\n        setEditing(false);\r\n    }, [draft, meta, row.id]);\r\n\r\n    const onKeyDown = (e: React.KeyboardEvent<HTMLInputElement>) => {\r\n        if (e.key === 'Enter') {\r\n            e.preventDefault();\r\n            commit();\r\n        } else if (e.key === 'Escape') {\r\n            e.preventDefault();\r\n            // Revert draft to current cell value\r\n            const n =\r\n                typeof initial === 'number'\r\n                    ? initial\r\n                    : typeof initial === 'string'\r\n                        ? Number(initial)\r\n                        : null;\r\n            setDraft(n != null ? fmt.format(n) : '');\r\n            setEditing(false);\r\n        }\r\n    };\r\n\r\n    if (!isEditing) {\r\n        const display =\r\n            initialNumber != null ? fmt.format(initialNumber) : '';\r\n        return (\r\n            <div\r\n                role=\"button\"\r\n                tabIndex={0}\r\n                onDoubleClick={() => setEditing(true)}\r\n                onKeyDown={(e) => {\r\n                    if (e.key === 'Enter' || e.key === ' ') setEditing(true);\r\n                }}\r\n                style={{ cursor: 'text' }}\r\n            >\r\n                {display}\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <input\r\n            autoFocus\r\n            value={draft}\r\n            onChange={(e) => setDraft(e.target.value)}\r\n            onBlur={commit}\r\n            onKeyDown={onKeyDown}\r\n            inputMode=\"numeric\"\r\n            style={{\r\n                width: '100%',\r\n                border: '1px solid #cfd8e3',\r\n                borderRadius: 4,\r\n                padding: '4px 6px',\r\n                outline: 'none',\r\n                textAlign: 'left',\r\n            }}\r\n        />\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;AACA,iCAAiC;AACjC;;;AAIA,mBAAmB;AACnB,MAAM,MAAM,IAAI,KAAK,YAAY,CAAC,WAAW;IACzC,OAAO;IACP,UAAU;IACV,uBAAuB;AAC3B;AAEA,SAAS,cAAc,KAAa;IAChC,uDAAuD;IACvD,IAAI,SAAS,MAAM,OAAO;IAC1B,MAAM,WAAW,OAAO,OAAO,OAAO,CAAC,aAAa;IACpD,IAAI,SAAS,IAAI,OAAO,IAAI,OAAO;IACnC,MAAM,IAAI,OAAO;IACjB,OAAO,OAAO,QAAQ,CAAC,KAAK,IAAI;AACpC;AAMe,SAAS,WAAW,GAAoC;IACnE,MAAM,EAAE,GAAG,EAAE,QAAQ,EAAE,KAAK,EAAE,GAAG;IACjC,MAAM,OAAO,MAAM,OAAO,CAAC,IAAI;IAE/B,6FAA6F;IAC7F,MAAM,UAAU;IAChB,MAAM,gBACF,OAAO,YAAY,WACb,UACA,OAAO,YAAY,WACf,OAAO,WACP;IAEd,MAAM,CAAC,WAAW,WAAW,GAAG,iNAAc,CAAC;IAC/C,MAAM,CAAC,OAAO,SAAS,GAAG,iNAAc,CACpC,iBAAiB,OAAO,IAAI,MAAM,CAAC,iBAAiB;IAGxD,yEAAyE;IACzE,kNAAe,CAAC;QACZ,MAAM,IACF,OAAO,YAAY,WACb,UACA,OAAO,YAAY,WACf,OAAO,WACP;QACd,SAAS,KAAK,OAAO,IAAI,MAAM,CAAC,KAAK;IACzC,GAAG;QAAC;KAAQ;IAEZ,MAAM,SAAS,oNAAiB,CAAC;QAC7B,MAAM,IAAI,cAAc;QACxB,IAAI,KAAK,QAAQ,MAAM,cAAc;YACjC,KAAK,YAAY,CAAC,IAAI,EAAE,EAAE;QAC9B;QACA,WAAW;IACf,GAAG;QAAC;QAAO;QAAM,IAAI,EAAE;KAAC;IAExB,MAAM,YAAY,CAAC;QACf,IAAI,EAAE,GAAG,KAAK,SAAS;YACnB,EAAE,cAAc;YAChB;QACJ,OAAO,IAAI,EAAE,GAAG,KAAK,UAAU;YAC3B,EAAE,cAAc;YAChB,qCAAqC;YACrC,MAAM,IACF,OAAO,YAAY,WACb,UACA,OAAO,YAAY,WACf,OAAO,WACP;YACd,SAAS,KAAK,OAAO,IAAI,MAAM,CAAC,KAAK;YACrC,WAAW;QACf;IACJ;IAEA,IAAI,CAAC,WAAW;QACZ,MAAM,UACF,iBAAiB,OAAO,IAAI,MAAM,CAAC,iBAAiB;QACxD,qBACI,8OAAC;YACG,MAAK;YACL,UAAU;YACV,eAAe,IAAM,WAAW;YAChC,WAAW,CAAC;gBACR,IAAI,EAAE,GAAG,KAAK,WAAW,EAAE,GAAG,KAAK,KAAK,WAAW;YACvD;YACA,OAAO;gBAAE,QAAQ;YAAO;sBAEvB;;;;;;IAGb;IAEA,qBACI,8OAAC;QACG,SAAS;QACT,OAAO;QACP,UAAU,CAAC,IAAM,SAAS,EAAE,MAAM,CAAC,KAAK;QACxC,QAAQ;QACR,WAAW;QACX,WAAU;QACV,OAAO;YACH,OAAO;YACP,QAAQ;YACR,cAAc;YACd,SAAS;YACT,SAAS;YACT,WAAW;QACf;;;;;;AAGZ"}},
    {"offset": {"line": 109, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/JeremyJoyner/code/budgetintelligence/components/grid/columns.ts"],"sourcesContent":["\r\n// components/grid/columns.ts\r\nimport type { ColumnDef } from '@tanstack/react-table';\r\nimport AmountCell from './AmountCell';\r\n\r\n/** Raw JSON shape you use today (kept intact) */\r\nexport type BudgetRow = {\r\n    type?: string;            // raw: \"expense\", \"revenue\", etc.\r\n    community?: string;\r\n    category?: string;\r\n    subCategory?: string;\r\n    budgetMethod?: string;    // present in data but NOT displayed as a column\r\n    driver?: string;\r\n    driverTag?: string;\r\n    glCode?: string | null;\r\n    period?: string;          // e.g., \"2026-03\"\r\n    amount?: number | string | null;\r\n    [key: string]: unknown;\r\n};\r\n\r\n// Back-compat alias if other files import BudgetLine\r\nexport type BudgetLine = BudgetRow;\r\n\r\n/* ---------------------------------- */\r\n/* Helpers: derive Year, Quarter, Month from \"YYYY-MM\" */\r\n/* ---------------------------------- */\r\n\r\n/** Return 2026 from \"2026-03\" */\r\nexport function deriveYear(period?: string): number | null {\r\n    if (!period) return null;\r\n    const y = parseInt(period.slice(0, 4), 10);\r\n    return Number.isFinite(y) ? y : null;\r\n}\r\n\r\n/** Internal: 1–12 from \"2026-03\" */\r\nfunction deriveMonthNumber(period?: string): number | null {\r\n    if (!period || period.length < 7) return null;\r\n    const m = parseInt(period.slice(5, 7), 10);\r\n    return m >= 1 && m <= 12 ? m : null;\r\n}\r\n\r\n/** Return month label: Jan, Feb, Mar, ... */\r\nexport function deriveMonthLabel(period?: string): string {\r\n    const m = deriveMonthNumber(period);\r\n    if (!m) return '';\r\n    const labels = [\r\n        '', 'Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun',\r\n        'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec',\r\n    ];\r\n    return labels[m] ?? '';\r\n}\r\n\r\n/** Return quarter in format YYQ#: e.g., 26Q1, 25Q4 */\r\nexport function deriveQuarterLabel(period?: string): string {\r\n    const year = deriveYear(period);\r\n    const m = deriveMonthNumber(period);\r\n    if (!year || !m) return '';\r\n    const q = Math.ceil(m / 3);\r\n    const yy = String(year).slice(-2); // 2026 → \"26\"\r\n    return `${yy}Q${q}`;\r\n}\r\n\r\n/** Map raw \"type\" → UI label for Budget Type */\r\nexport function mapBudgetType(raw?: string): string {\r\n    if (!raw) return '';\r\n    const t = String(raw).toLowerCase();\r\n    if (t === 'expense') return 'Expense';\r\n    if (t === 'revenue') return 'Revenue';\r\n    if (t === 'capex' || t === 'capital' || t === 'capital_expenditure') return 'CapEx';\r\n    // Fallback: Title Case original value\r\n    return raw.charAt(0).toUpperCase() + raw.slice(1);\r\n}\r\n\r\n/* ---------------------------------- */\r\n/* Column definitions (ORDER LOCKED)  */\r\n/* Community | Category | SubCategory | GL Code | Budget Type | Year | Quarter | Month | Amount */\r\n/* ---------------------------------- */\r\n\r\nexport const columns: ColumnDef<BudgetRow, any>[] = [\r\n    {\r\n        id: 'community',\r\n        accessorKey: 'community',\r\n        header: 'Community',\r\n        enableResizing: true,\r\n        size: 200,\r\n    },\r\n    {\r\n        id: 'category',\r\n        accessorKey: 'category',\r\n        header: 'Category',\r\n        enableResizing: true,\r\n        size: 200,\r\n    },\r\n    {\r\n        id: 'subCategory',\r\n        accessorKey: 'subCategory',\r\n        header: 'SubCategory',\r\n        enableResizing: true,\r\n        size: 220,\r\n    },\r\n    {\r\n        id: 'glCode',\r\n        accessorKey: 'glCode',\r\n        header: 'GL Code',\r\n        enableResizing: true,\r\n        size: 110,\r\n        cell: (info) => String(info.getValue() ?? ''),\r\n    },\r\n    {\r\n        id: 'budgetType',\r\n        header: 'Budget Type',\r\n        accessorFn: (row) => mapBudgetType(row.type),\r\n        enableResizing: true,\r\n        size: 140,\r\n    },\r\n    {\r\n        id: 'year',\r\n        header: 'Year',\r\n        accessorFn: (row) => deriveYear(row.period),\r\n        enableResizing: true,\r\n        size: 90,\r\n        cell: (info) => {\r\n            const y = info.getValue() as number | null;\r\n            return y ?? '';\r\n        },\r\n        // Keep filtering on 'year' numeric-safe so toolbar Year works as expected\r\n        filterFn: (row, _columnId, filterValue: unknown) => {\r\n            const y = row.getValue<number | null>('year');\r\n            if (filterValue == null || filterValue === '') return true;\r\n            const fv = typeof filterValue === 'string' ? parseInt(filterValue, 10) : filterValue;\r\n            return y === fv;\r\n        },\r\n    },\r\n    {\r\n        id: 'quarter',\r\n        header: 'Quarter',\r\n        accessorFn: (row) => deriveQuarterLabel(row.period), // e.g., 26Q1\r\n        enableResizing: true,\r\n        size: 100,\r\n    },\r\n    {\r\n        id: 'month',\r\n        header: 'Month',\r\n        accessorFn: (row) => deriveMonthLabel(row.period),   // e.g., Jan\r\n        enableResizing: true,\r\n        size: 90,\r\n    },\r\n    {\r\n        id: 'amount',\r\n        accessorKey: 'amount',\r\n        header: 'Amount',\r\n        enableResizing: true,\r\n        size: 140,\r\n        cell: AmountCell,\r\n        meta: { isNumeric: true },\r\n    },\r\n];\r\n\r\nexport default columns;\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 259, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/JeremyJoyner/code/budgetintelligence/components/grid/ToolbarFilters.tsx"],"sourcesContent":["\r\n// components/grid/ToolbarFilters.tsx\r\nimport * as React from 'react';\r\nimport type { ColumnFiltersState, Table } from '@tanstack/react-table';\r\n\r\ntype Props = {\r\n    filters: ColumnFiltersState;\r\n    setFilters: React.Dispatch<React.SetStateAction<ColumnFiltersState>>;\r\n    onClear: () => void;\r\n    onExport: () => void;\r\n    table: Table<any>;\r\n};\r\n\r\nfunction getFilterValue(filters: ColumnFiltersState, id: string): string {\r\n    const f = filters.find(f => f.id === id);\r\n    return f?.value != null ? String(f.value) : '';\r\n}\r\n\r\nfunction setFilter(\r\n    setFilters: React.Dispatch<React.SetStateAction<ColumnFiltersState>>,\r\n    id: 'community' | 'year' | 'budgetType' | 'category',\r\n    value: string\r\n) {\r\n    setFilters(prev => {\r\n        const next = prev.filter(f => f.id !== id);\r\n        if (value !== '') {\r\n            const casted = id === 'year' ? Number(value) : value;\r\n            next.push({ id, value: casted as any });\r\n        }\r\n        return next;\r\n    });\r\n}\r\n\r\nfunction getOptions(table: Table<any>, columnId: string): string[] {\r\n    const col = table.getColumn(columnId);\r\n    if (!col) return [];\r\n    const pre = table.getPreFilteredRowModel();\r\n    const s = new Set<string>();\r\n    pre.flatRows.forEach(r => {\r\n        const v = r.getValue?.(columnId);\r\n        if (v == null) return;\r\n        const str = String(v);\r\n        if (str.trim().length) s.add(str);\r\n    });\r\n    return Array.from(s).sort((a, b) => a.localeCompare(b));\r\n}\r\n\r\nfunction Divider() {\r\n    return (\r\n        <span\r\n            aria-hidden=\"true\"\r\n            style={{\r\n                width: 1,\r\n                height: 22,\r\n                background: '#e5e5e5',\r\n                margin: '0 10px',\r\n                display: 'inline-block',\r\n            }}\r\n        />\r\n    );\r\n}\r\n\r\nexport default function ToolbarFilters({ filters, setFilters, onClear, onExport, table }: Props) {\r\n    const items: Array<{ id: 'community' | 'year' | 'budgetType' | 'category'; label: string; minWidth?: number }> = [\r\n        { id: 'community', label: 'Community', minWidth: 160 },\r\n        { id: 'year', label: 'Year', minWidth: 110 },\r\n        { id: 'budgetType', label: 'Budget Type', minWidth: 150 },\r\n        { id: 'category', label: 'Category', minWidth: 160 },\r\n    ];\r\n\r\n    const filteredCount = table.getFilteredRowModel().rows.length;\r\n    const communityCount = (() => {\r\n        const s = new Set<string>();\r\n        table.getFilteredRowModel().rows.forEach(r => {\r\n            const v = r.getValue?.('community');\r\n            if (v != null) s.add(String(v));\r\n        });\r\n        return s.size;\r\n    })();\r\n\r\n    return (\r\n        <div\r\n            className=\"grid-toolbar\"\r\n            style={{\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                gap: 0,\r\n                padding: '4px 4px 8px 4px',\r\n            }}\r\n        >\r\n            {items.map(({ id, label, minWidth }, idx) => {\r\n                const options = getOptions(table, id);\r\n                const value = getFilterValue(filters, id);\r\n                const control = (\r\n                    <div\r\n                        key={id}\r\n                        style={{\r\n                            display: 'inline-flex',\r\n                            alignItems: 'center',\r\n                            padding: '2px 10px',\r\n                            borderRadius: 6,\r\n                            border: '1px solid #e5e5e5',\r\n                            background: '#fff',\r\n                        }}\r\n                    >\r\n                        <select\r\n                            value={value}\r\n                            onChange={(e) => setFilter(setFilters, id, e.target.value)}\r\n                            disabled={options.length === 0}\r\n                            style={{\r\n                                border: 'none',\r\n                                outline: 'none',\r\n                                background: 'transparent',\r\n                                minWidth: minWidth ?? 120,\r\n                                cursor: options.length ? 'pointer' : 'not-allowed',\r\n                            }}\r\n                            aria-label={label}\r\n                        >\r\n                            <option value=\"\">{label}</option>\r\n                            {options.map(opt => (\r\n                                <option key={`${id}:${opt}`} value={opt}>{opt}</option>\r\n                            ))}\r\n                        </select>\r\n                    </div>\r\n                );\r\n\r\n                return (\r\n                    <React.Fragment key={`frag-${id}`}>\r\n                        {control}\r\n                        {idx < items.length - 1 ? <Divider /> : <span style={{ width: 8 }} />}\r\n                    </React.Fragment>\r\n                );\r\n            })}\r\n\r\n            <div style={{ marginLeft: 'auto', display: 'inline-flex', gap: 12, alignItems: 'center', color: '#666' }}>\r\n                <span style={{ fontSize: 12 }}>{filteredCount} rows · {communityCount} communities</span>\r\n                <button type=\"button\" onClick={onClear}>Clear</button>\r\n                <button type=\"button\" onClick={onExport}>Export CSV</button>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 489, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/JeremyJoyner/code/budgetintelligence/components/grid/VirtualRows.tsx"],"sourcesContent":["\r\n// components/grid/VirtualRows.tsx\r\nimport * as React from 'react';\r\n\r\ntype VirtualRowsProps<T> = {\r\n    /** All table rows (already filtered/sorted) in display order */\r\n    rows: T[];\r\n    /** Height of a single data row in pixels (estimate) */\r\n    rowHeight?: number;\r\n    /** Extra rows to render above/below the viewport */\r\n    overscan?: number;\r\n    /**\r\n     * The scrollable container that wraps the <table>.\r\n     * Widened to Element|null to accept HTMLDivElement refs without TS variance issues.\r\n     */\r\n    scrollContainerRef: React.RefObject<Element | null>;\r\n    /** Number of visible (non-hidden) columns; used for spacer colSpan */\r\n    visibleColumnCount: number;\r\n    /** Render function for an individual data row as <tr>...</tr> */\r\n    renderRow: (row: T, rowIndex: number) => React.ReactElement;\r\n    /** Disable virtualization (debug or small datasets) */\r\n    disableVirtual?: boolean;\r\n};\r\n\r\n/**\r\n * Table-safe virtualization for <tbody>:\r\n * - Renders only <tr>/<td> inside <tbody> (no <div>).\r\n * - Uses top/bottom spacer <tr> to preserve scroll height.\r\n * - SSR-safe: falls back to non-virtual on server / missing container metrics.\r\n */\r\nexport function VirtualRows<T>({\r\n    rows,\r\n    rowHeight = 36,\r\n    overscan = 6,\r\n    scrollContainerRef,\r\n    visibleColumnCount,\r\n    renderRow,\r\n    disableVirtual,\r\n}: VirtualRowsProps<T>) {\r\n    const isServer = typeof window === 'undefined';\r\n    const [viewport, setViewport] = React.useState({ scrollTop: 0, height: 0 });\r\n\r\n    React.useEffect(() => {\r\n        if (disableVirtual || isServer) return;\r\n        // We widened the ref type; here we assert to HTMLElement at usage time\r\n        const el = scrollContainerRef.current as HTMLElement | null;\r\n        if (!el) return;\r\n\r\n        const handle = () => {\r\n            setViewport({\r\n                scrollTop: el.scrollTop,\r\n                height: el.clientHeight,\r\n            });\r\n        };\r\n        handle();\r\n\r\n        el.addEventListener('scroll', handle, { passive: true });\r\n        const ro = new ResizeObserver(handle);\r\n        ro.observe(el);\r\n\r\n        return () => {\r\n            el.removeEventListener('scroll', handle);\r\n            ro.disconnect();\r\n        };\r\n    }, [scrollContainerRef, disableVirtual, isServer]);\r\n\r\n    // If virtualization is disabled or we can't measure yet, render all rows\r\n    if (disableVirtual || isServer || !scrollContainerRef.current || viewport.height === 0) {\r\n        return <>{rows.map((row, i) => renderRow(row, i))}</>;\r\n    }\r\n\r\n    const total = rows.length;\r\n    const estTotalHeight = total * rowHeight;\r\n\r\n    const startIndex = Math.max(0, Math.floor(viewport.scrollTop / rowHeight) - overscan);\r\n    const visibleCount = Math.ceil(viewport.height / rowHeight) + overscan * 2;\r\n    const endIndex = Math.min(total, startIndex + visibleCount);\r\n\r\n    const topPad = startIndex * rowHeight;\r\n    const bottomPad = Math.max(0, estTotalHeight - topPad - (endIndex - startIndex) * rowHeight);\r\n\r\n    return (\r\n        <>\r\n            {topPad > 0 && (\r\n                <tr aria-hidden=\"true\">\r\n                    <td colSpan={visibleColumnCount} style={{ height: topPad, padding: 0, border: 'none' }} />\r\n                </tr>\r\n            )}\r\n\r\n            {rows.slice(startIndex, endIndex).map((row, i) => renderRow(row, startIndex + i))}\r\n\r\n            {bottomPad > 0 && (\r\n                <tr aria-hidden=\"true\">\r\n                    <td colSpan={visibleColumnCount} style={{ height: bottomPad, padding: 0, border: 'none' }} />\r\n                </tr>\r\n            )}\r\n        </>\r\n    );\r\n}\r\n\r\nexport default VirtualRows;\r\n"],"names":[],"mappings":";;;;;;;AACA,kCAAkC;AAClC;;;AA4BO,SAAS,YAAe,EAC3B,IAAI,EACJ,YAAY,EAAE,EACd,WAAW,CAAC,EACZ,kBAAkB,EAClB,kBAAkB,EAClB,SAAS,EACT,cAAc,EACI;IAClB,MAAM,WAAW,kDAAkB;IACnC,MAAM,CAAC,UAAU,YAAY,GAAG,iNAAc,CAAC;QAAE,WAAW;QAAG,QAAQ;IAAE;IAEzE,kNAAe,CAAC;QACZ,wCAAgC;;;QAChC,uEAAuE;QACvE,MAAM;QAGN,MAAM;QASN,MAAM;IAOV,GAAG;QAAC;QAAoB;QAAgB;KAAS;IAEjD,yEAAyE;IACzE,wCAAwF;QACpF,qBAAO;sBAAG,KAAK,GAAG,CAAC,CAAC,KAAK,IAAM,UAAU,KAAK;;IAClD;;;IAEA,MAAM;IACN,MAAM;IAEN,MAAM;IACN,MAAM;IACN,MAAM;IAEN,MAAM;IACN,MAAM;AAmBV;uCAEe"}},
    {"offset": {"line": 540, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/JeremyJoyner/code/budgetintelligence/components/grid/totals.ts"],"sourcesContent":["\r\n// components/grid/totals.ts\r\nimport type { Table } from '@tanstack/react-table';\r\n\r\nexport type NumericKey = string;\r\n\r\n/**\r\n * Sums numeric fields across a collection of row \"originals\".\r\n * Non-numeric / null / undefined values are ignored.\r\n */\r\nexport function buildTotals<T extends Record<string, unknown>>(\r\n    rows: T[],\r\n    numericKeys: readonly NumericKey[]\r\n): Record<NumericKey, number> {\r\n    const totals: Record<NumericKey, number> = Object.fromEntries(\r\n        numericKeys.map(k => [k, 0])\r\n    ) as Record<NumericKey, number>;\r\n\r\n    for (const row of rows) {\r\n        for (const k of numericKeys) {\r\n            const v = row[k];\r\n            const n = typeof v === 'string' ? Number(v) : (typeof v === 'number' ? v : NaN);\r\n            if (!Number.isNaN(n)) {\r\n                totals[k] += n;\r\n            }\r\n        }\r\n    }\r\n    return totals;\r\n}\r\n\r\n/**\r\n * Convenience helper: sums from the table's *filtered* row model.\r\n * Usage: buildTotalsFromTable(table, ['amount'])\r\n */\r\nexport function buildTotalsFromTable<T extends Record<string, unknown>>(\r\n    table: Table<T>,\r\n    numericKeys: readonly NumericKey[]\r\n): Record<NumericKey, number> {\r\n    const rows = table.getFilteredRowModel().rows.map(r => r.original);\r\n    return buildTotals(rows as T[], numericKeys);\r\n}\r\n"],"names":[],"mappings":"AACA,4BAA4B;;;;;;;AASrB,SAAS,YACZ,IAAS,EACT,WAAkC;IAElC,MAAM,SAAqC,OAAO,WAAW,CACzD,YAAY,GAAG,CAAC,CAAA,IAAK;YAAC;YAAG;SAAE;IAG/B,KAAK,MAAM,OAAO,KAAM;QACpB,KAAK,MAAM,KAAK,YAAa;YACzB,MAAM,IAAI,GAAG,CAAC,EAAE;YAChB,MAAM,IAAI,OAAO,MAAM,WAAW,OAAO,KAAM,OAAO,MAAM,WAAW,IAAI;YAC3E,IAAI,CAAC,OAAO,KAAK,CAAC,IAAI;gBAClB,MAAM,CAAC,EAAE,IAAI;YACjB;QACJ;IACJ;IACA,OAAO;AACX;AAMO,SAAS,qBACZ,KAAe,EACf,WAAkC;IAElC,MAAM,OAAO,MAAM,mBAAmB,GAAG,IAAI,CAAC,GAAG,CAAC,CAAA,IAAK,EAAE,QAAQ;IACjE,OAAO,YAAY,MAAa;AACpC"}},
    {"offset": {"line": 571, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/JeremyJoyner/code/budgetintelligence/components/BudgetGrid.tanstack.tsx"],"sourcesContent":["\r\n// components/BudgetGrid.tanstack.tsx\r\n'use client';\r\n\r\nimport * as React from 'react';\r\nimport {\r\n    Cell,\r\n    ColumnFiltersState,\r\n    Row,\r\n    SortingState,\r\n    TableOptions,\r\n    flexRender,\r\n    getCoreRowModel,\r\n    getFilteredRowModel,\r\n    getSortedRowModel,\r\n    useReactTable,\r\n} from '@tanstack/react-table';\r\n\r\nimport columns, { BudgetRow, mapBudgetType } from './grid/columns';\r\nimport ToolbarFilters from './grid/ToolbarFilters';\r\nimport VirtualRows from './grid/VirtualRows';\r\nimport { buildTotalsFromTable } from './grid/totals';\r\n\r\n// ---------- helpers ----------\r\nfunction toCsv(rows: BudgetRow[], visibleKeys: string[]): string {\r\n    const esc = (v: unknown) => {\r\n        if (v == null) return '';\r\n        const s = String(v);\r\n        return /[\",\\n]/.test(s) ? `\"${s.replace(/\"/g, '\"\"')}\"` : s;\r\n    };\r\n    const header = visibleKeys.map(esc).join(',');\r\n    const body = rows.map(r => visibleKeys.map(k => esc((r as any)[k])).join(',')).join('\\n');\r\n    return `${header}\\n${body}`;\r\n}\r\nfunction downloadBlob(filename: string, content: string, mime = 'text/csv;charset=utf-8') {\r\n    const blob = new Blob([content], { type: mime });\r\n    const url = URL.createObjectURL(blob);\r\n    const a = document.createElement('a');\r\n    a.href = url;\r\n    a.download = filename;\r\n    document.body.appendChild(a);\r\n    a.click();\r\n    a.remove();\r\n    URL.revokeObjectURL(url);\r\n}\r\nfunction toNumber(v: unknown): number {\r\n    if (typeof v === 'number') return v;\r\n    const n = Number(v);\r\n    return Number.isFinite(n) ? n : 0;\r\n}\r\nfunction formatCurrency(n: number): string {\r\n    return Intl.NumberFormat(undefined, { style: 'currency', currency: 'USD', maximumFractionDigits: 0 }).format(n || 0);\r\n}\r\n\r\n// ---------- props ----------\r\ntype Props = {\r\n    rows?: BudgetRow[];\r\n    initialSorting?: SortingState;\r\n    initialFilters?: ColumnFiltersState;\r\n};\r\n\r\n// ---------- component ----------\r\nexport default function BudgetGrid({\r\n    rows,\r\n    initialSorting = [],\r\n    initialFilters = [],\r\n}: Props) {\r\n    const [data, setData] = React.useState<BudgetRow[]>(() => rows ?? []);\r\n    const [sorting, setSorting] = React.useState<SortingState>(initialSorting);\r\n    const [columnFilters, setColumnFilters] = React.useState<ColumnFiltersState>(initialFilters);\r\n\r\n    // Updater used by AmountCell via table.options.meta.updateAmount\r\n    const updateAmount = React.useCallback((rowId: string, newValue: number) => {\r\n        setData((prev) => {\r\n            // Row ids are index-based fallback in our getRowId; coerce if needed\r\n            const idx = Number.isFinite(Number(rowId)) ? Number(rowId) : prev.findIndex((_r, i) => String(i) === rowId);\r\n            if (idx < 0 || idx >= prev.length) return prev;\r\n            const next = prev.slice();\r\n            next[idx] = { ...next[idx], amount: newValue };\r\n            return next;\r\n        });\r\n    }, []);\r\n\r\n    const table = useReactTable<BudgetRow>({\r\n        data,\r\n        columns,\r\n        state: { sorting, columnFilters },\r\n        onSortingChange: setSorting,\r\n        onColumnFiltersChange: setColumnFilters,\r\n        getCoreRowModel: getCoreRowModel(),\r\n        getSortedRowModel: getSortedRowModel(),\r\n        getFilteredRowModel: getFilteredRowModel(),\r\n        enableColumnResizing: true,\r\n        columnResizeMode: 'onChange',\r\n        getRowId: (row, idx) => (row as any).id ?? String(idx),\r\n\r\n        // >>> expose meta so cells can call back into the table\r\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n        // @ts-ignore tanstack's TableOptions allows unknown meta\r\n        meta: {\r\n            updateAmount,\r\n        },\r\n    } as TableOptions<BudgetRow>);\r\n\r\n    const scrollRef = React.useRef<HTMLDivElement>(null);\r\n\r\n    // ---------- toolbar actions ----------\r\n    const handleClearFilters = React.useCallback(() => {\r\n        setColumnFilters([]);\r\n        table.resetColumnFilters();\r\n    }, [table]);\r\n\r\n    const handleExportCsv = React.useCallback(() => {\r\n        const visibleCols = table.getVisibleLeafColumns();\r\n        const keys = visibleCols.map(c => (c.columnDef as any).accessorKey ?? c.id);\r\n        const filtered = table.getFilteredRowModel().rows.map(r => r.original);\r\n        const csv = toCsv(filtered, keys);\r\n        downloadBlob(`budget-grid-${new Date().toISOString().slice(0, 10)}.csv`, csv);\r\n    }, [table]);\r\n\r\n    // ---------- live totals (filter-aware & edit-aware) ----------\r\n    const filteredRows = table.getFilteredRowModel().rows;\r\n    const yearFilter = columnFilters.find(f => f.id === 'year')?.value as number | string | undefined;\r\n\r\n    const totalsLive = React.useMemo(() => {\r\n        let rev = 0, exp = 0;\r\n        for (const r of filteredRows) {\r\n            if (yearFilter !== undefined && yearFilter !== null) {\r\n                const y = r.getValue?.('year') as number | null;\r\n                const yWanted = typeof yearFilter === 'string' ? parseInt(yearFilter, 10) : yearFilter;\r\n                if (y !== yWanted) continue;\r\n            }\r\n            const amt = toNumber((r.original as BudgetRow).amount);\r\n            const bt = mapBudgetType((r.original as BudgetRow).type);\r\n            if (bt === 'Revenue') rev += amt;\r\n            else if (bt === 'Expense' || bt === 'CapEx') exp += amt;\r\n        }\r\n        return { rev, exp, net: rev - exp };\r\n    }, [filteredRows, yearFilter]);\r\n\r\n    // ---------- render ----------\r\n    const leafCols = table.getVisibleLeafColumns();\r\n\r\n    return (\r\n        <section style={{ display: 'flex', flexDirection: 'column', gap: 12 }}>\r\n            {/* Dynamic cards (filter-aware) */}\r\n            <div\r\n                style={{\r\n                    display: 'grid',\r\n                    gridTemplateColumns: 'repeat(3, minmax(240px, 1fr))',\r\n                    gap: 16,\r\n                    marginTop: 4,\r\n                }}\r\n            >\r\n                <SummaryCard title=\"TOTAL REVENUE\" value={formatCurrency(totalsLive.rev)} />\r\n                <SummaryCard title=\"TOTAL EXPENSE\" value={formatCurrency(totalsLive.exp)} />\r\n                <SummaryCard title=\"NET\" value={formatCurrency(totalsLive.net)} />\r\n            </div>\r\n\r\n            {/* Toolbar */}\r\n            <ToolbarFilters\r\n                filters={columnFilters}\r\n                setFilters={setColumnFilters}\r\n                onClear={handleClearFilters}\r\n                onExport={handleExportCsv}\r\n                table={table}\r\n            />\r\n\r\n            {/* Grid */}\r\n            <div\r\n                ref={scrollRef}\r\n                style={{\r\n                    overflow: 'auto',\r\n                    maxHeight: '70vh',\r\n                    border: '1px solid var(--border, #ddd)',\r\n                    borderRadius: 6,\r\n                }}\r\n            >\r\n                <table\r\n                    style={{\r\n                        width: '100%',\r\n                        borderCollapse: 'separate',\r\n                        borderSpacing: 0,\r\n                        tableLayout: 'fixed',\r\n                    }}\r\n                >\r\n                    <colgroup>\r\n                        {leafCols.map(col => (\r\n                            <col\r\n                                key={`col-${col.id}`}\r\n                                style={{\r\n                                    width: col.getSize(),\r\n                                    minWidth: col.columnDef.minSize ?? 40,\r\n                                    maxWidth: col.columnDef.maxSize ?? Number.POSITIVE_INFINITY,\r\n                                }}\r\n                            />\r\n                        ))}\r\n                    </colgroup>\r\n\r\n                    <thead>\r\n                        {table.getHeaderGroups().map(hg => (\r\n                            <tr key={hg.id}>\r\n                                {hg.headers.map(h => {\r\n                                    const canResize = h.column.getCanResize();\r\n                                    return (\r\n                                        <th\r\n                                            key={h.id}\r\n                                            colSpan={h.colSpan}\r\n                                            style={{\r\n                                                position: 'relative',\r\n                                                background: 'var(--th-bg, #f8f8f8)',\r\n                                                textAlign: 'center',              // centered headers\r\n                                                fontWeight: 600,\r\n                                                borderBottom: '1px solid #e5e5e5',\r\n                                                borderRight: '1px solid #f3f3f3', // subtle column separator\r\n                                                padding: '8px 10px',\r\n                                                overflow: 'hidden',\r\n                                                textOverflow: 'ellipsis',\r\n                                                whiteSpace: 'nowrap',\r\n                                            }}\r\n                                        >\r\n                                            {h.isPlaceholder ? null : flexRender(h.column.columnDef.header, h.getContext())}\r\n                                            {canResize && (\r\n                                                <div\r\n                                                    onMouseDown={h.getResizeHandler()}\r\n                                                    onTouchStart={h.getResizeHandler()}\r\n                                                    role=\"separator\"\r\n                                                    aria-orientation=\"vertical\"\r\n                                                    aria-label={`Resize ${String(h.column.id)} column`}\r\n                                                    style={{\r\n                                                        position: 'absolute',\r\n                                                        right: 0,\r\n                                                        top: 0,\r\n                                                        height: '100%',\r\n                                                        width: 6,\r\n                                                        cursor: 'col-resize',\r\n                                                        userSelect: 'none',\r\n                                                        touchAction: 'none',\r\n                                                    }}\r\n                                                />\r\n                                            )}\r\n                                        </th>\r\n                                    );\r\n                                })}\r\n                            </tr>\r\n                        ))}\r\n                    </thead>\r\n\r\n                    <tbody>\r\n                        <VirtualRows\r\n                            rows={table.getRowModel().rows}\r\n                            rowHeight={36}\r\n                            overscan={8}\r\n                            scrollContainerRef={scrollRef}\r\n                            visibleColumnCount={leafCols.length}\r\n                            renderRow={(row: Row<BudgetRow>) => (\r\n                                <tr key={row.id}>\r\n                                    {row.getVisibleCells().map((cell: Cell<BudgetRow, unknown>) => {\r\n                                        const isAmount = cell.column.id === 'amount' || (cell.column.columnDef.meta as any)?.isNumeric;\r\n                                        return (\r\n                                            <td\r\n                                                key={cell.id}\r\n                                                style={{\r\n                                                    borderBottom: '1px solid #f0f0f0',\r\n                                                    borderRight: '1px solid #f7f7f7',\r\n                                                    padding: '6px 10px',\r\n                                                    overflow: 'hidden',\r\n                                                    textOverflow: 'ellipsis',\r\n                                                    whiteSpace: 'nowrap',\r\n                                                    textAlign: 'left',              // left align all cells including Amount\r\n                                                }}\r\n                                            >\r\n                                                {flexRender(cell.column.columnDef.cell, cell.getContext())}\r\n                                            </td>\r\n                                        );\r\n                                    })}\r\n                                </tr>\r\n                            )}\r\n                        />\r\n                    </tbody>\r\n\r\n                    <tfoot>\r\n                        <tr>\r\n                            {leafCols.map((col, idx) => {\r\n                                const isAmount = col.id === 'amount' || (col.columnDef.meta as any)?.isNumeric;\r\n                                const totalObj = buildTotalsFromTable(table, ['amount']); // filtered totals\r\n                                const content =\r\n                                    col.id === 'amount'\r\n                                        ? formatCurrency(totalObj.amount ?? 0)\r\n                                        : (idx === 0 ? 'Totals' : '');\r\n\r\n                                return (\r\n                                    <td\r\n                                        key={col.id}\r\n                                        style={{\r\n                                            borderTop: '2px solid #e5e5e5',\r\n                                            borderRight: '1px solid #f7f7f7',\r\n                                            fontWeight: 600,\r\n                                            padding: '8px 10px',\r\n                                            textAlign: 'left',                 // align with body Amount\r\n                                        }}\r\n                                    >\r\n                                        {content}\r\n                                    </td>\r\n                                );\r\n                            })}\r\n                        </tr>\r\n                    </tfoot>\r\n                </table>\r\n            </div>\r\n        </section>\r\n    );\r\n}\r\n\r\n// ---------- small presentational card ----------\r\nfunction SummaryCard({ title, value }: { title: string; value: string }) {\r\n    return (\r\n        <div\r\n            style={{\r\n                background: '#fff',\r\n                border: '1px solid #e9eef1',\r\n                borderRadius: 10,\r\n                padding: '16px 20px',\r\n                display: 'flex',\r\n                flexDirection: 'column',\r\n                gap: 6,\r\n                minHeight: 86,\r\n            }}\r\n        >\r\n            <div style={{ fontSize: 12, color: '#7a8a99', letterSpacing: 0.4 }}>{title}</div>\r\n            <div style={{ fontSize: 28, fontWeight: 600 }}>{value}</div>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}