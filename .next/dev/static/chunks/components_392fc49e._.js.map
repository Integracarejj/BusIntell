{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/JeremyJoyner/code/budgetintelligence/components/grid/ToolbarFilters.tsx"],"sourcesContent":["\r\n\"use client\";\r\n\r\nimport * as React from \"react\";\r\nimport type { ColumnFiltersState, Table } from \"@tanstack/react-table\";\r\n\r\ntype Option = { label: string; value: string };\r\n\r\ntype ToolbarFiltersProps<TData extends object> = {\r\n    /** TanStack Table instance so we can derive options contextually (esp. Category) */\r\n    table: Table<TData>;\r\n    /** Current columnFilters state from the grid */\r\n    filters: ColumnFiltersState;\r\n    /** Setter from the grid */\r\n    setFilters: React.Dispatch<React.SetStateAction<ColumnFiltersState>>;\r\n    /** UI actions provided by the grid */\r\n    onClear: () => void;\r\n    onExport: () => void;\r\n    /** Optional override lists */\r\n    yearOptions?: string[];             // default: [\"2024\",\"2025\",\"2026\"]\r\n    typeOptions?: string[];             // default: [\"expense\",\"revenue\",\"home office\"]\r\n    /** Field accessors (defaults match your dataset) */\r\n    communityColumnId?: string;         // default: \"community\"\r\n    typeColumnId?: string;              // default: \"type\"\r\n    categoryColumnId?: string;          // default: \"category\"\r\n    yearHelperColumnId?: string;        // default: \"__year\"\r\n};\r\n\r\nexport default function ToolbarFilters<TData extends object>({\r\n    table,\r\n    filters,\r\n    setFilters,\r\n    onClear,\r\n    onExport,\r\n    yearOptions = [\"2024\", \"2025\", \"2026\"],\r\n    typeOptions = [\"expense\", \"revenue\", \"home office\"],\r\n    communityColumnId = \"community\",\r\n    typeColumnId = \"type\",\r\n    categoryColumnId = \"category\",\r\n    yearHelperColumnId = \"__year\",\r\n}: ToolbarFiltersProps<TData>) {\r\n    // ----- helpers -----\r\n    const getFilter = React.useCallback(\r\n        (id: string) => filters.find((f) => f.id === id)?.value as any,\r\n        [filters]\r\n    );\r\n\r\n    const setFilter = React.useCallback(\r\n        (id: string, value: any) => {\r\n            setFilters((old) => {\r\n                const others = old.filter((f) => f.id !== id);\r\n                if (value == null || (Array.isArray(value) && value.length === 0)) return others;\r\n                return [...others, { id, value }];\r\n            });\r\n            // clear row selection when filters change\r\n            table.resetRowSelection();\r\n        },\r\n        [setFilters, table]\r\n    );\r\n\r\n    // ----- current selections -----\r\n    const selectedCommunities: string[] = (getFilter(communityColumnId) as string[]) ?? [];\r\n    const selectedYear: string | null = (getFilter(yearHelperColumnId) as string | null) ?? null;\r\n    const selectedType: string | null = (getFilter(typeColumnId) as string | null) ?? null;\r\n    const selectedCategories: string[] = (getFilter(categoryColumnId) as string[]) ?? [];\r\n\r\n    // ----- option derivation -----\r\n    const communityOptions: Option[] = React.useMemo(() => {\r\n        const set = new Set<string>();\r\n        table.getPreFilteredRowModel().rows.forEach((r) => {\r\n            const v = String(r.getValue(communityColumnId) ?? \"\");\r\n            if (v) set.add(v);\r\n        });\r\n        return Array.from(set).sort((a, b) => a.localeCompare(b)).map((v) => ({ value: v, label: v }));\r\n    }, [table, communityColumnId]);\r\n\r\n    const yearOpts: Option[] = React.useMemo(\r\n        () => yearOptions.map((y) => ({ value: y, label: y })),\r\n        [yearOptions]\r\n    );\r\n\r\n    const typeOpts: Option[] = React.useMemo(\r\n        () => typeOptions.map((t) => ({ value: t, label: t })),\r\n        [typeOptions]\r\n    );\r\n\r\n    // Category options reflect current (Community, Year, Type)\r\n    const categoryOptions: Option[] = React.useMemo(() => {\r\n        const rows = table.getPreFilteredRowModel().rows.filter((r) => {\r\n            const commPass =\r\n                selectedCommunities.length === 0 ||\r\n                selectedCommunities.includes(String(r.getValue(communityColumnId) ?? \"\"));\r\n            const typePass = !selectedType || String(r.getValue(typeColumnId) ?? \"\") === selectedType;\r\n            const yr = String(r.getValue(yearHelperColumnId) ?? \"\");\r\n            const yearPass = !selectedYear || yr === selectedYear;\r\n            return commPass && typePass && yearPass;\r\n        });\r\n        const set = new Set<string>();\r\n        rows.forEach((rr) => {\r\n            const v = String(rr.getValue(categoryColumnId) ?? \"\");\r\n            if (v) set.add(v);\r\n        });\r\n        return Array.from(set).sort((a, b) => a.localeCompare(b)).map((v) => ({ value: v, label: v }));\r\n    }, [\r\n        table,\r\n        communityColumnId,\r\n        typeColumnId,\r\n        categoryColumnId,\r\n        yearHelperColumnId,\r\n        selectedCommunities,\r\n        selectedType,\r\n        selectedYear,\r\n    ]);\r\n\r\n    const anyFilterActive = filters.length > 0;\r\n\r\n    // ----- UI -----\r\n    return (\r\n        <div className=\"flex flex-wrap items-center gap-2 rounded-xl border border-slate-200 bg-white p-3 shadow-sm\">\r\n            {/* Community (multi) */}\r\n            <MultiSelect\r\n                aria-label=\"Filter by community\"\r\n                label=\"Community\"\r\n                values={selectedCommunities}\r\n                options={communityOptions}\r\n                onChange={(vals) => setFilter(communityColumnId, vals)}\r\n                className=\"mr-1\"\r\n            />\r\n\r\n            {/* Year (single) */}\r\n            <SingleSelect\r\n                aria-label=\"Filter by year\"\r\n                label=\"Year\"\r\n                value={selectedYear}\r\n                options={yearOpts}\r\n                onChange={(val) => setFilter(yearHelperColumnId, val)}\r\n                className=\"mr-1\"\r\n            />\r\n\r\n            {/* Budget Type (single) */}\r\n            <SingleSelect\r\n                aria-label=\"Filter by budget type\"\r\n                label=\"Budget Type\"\r\n                value={selectedType}\r\n                options={typeOpts}\r\n                onChange={(val) => setFilter(typeColumnId, val)}\r\n                className=\"mr-1\"\r\n            />\r\n\r\n            {/* Category (multi) */}\r\n            <MultiSelect\r\n                aria-label=\"Filter by category\"\r\n                label=\"Category\"\r\n                values={selectedCategories}\r\n                options={categoryOptions}\r\n                onChange={(vals) => setFilter(categoryColumnId, vals)}\r\n                className=\"mr-1\"\r\n            />\r\n\r\n            {/* Spacer */}\r\n            <div className=\"grow\" />\r\n\r\n            {/* Filters active badge */}\r\n            {anyFilterActive && (\r\n                <span className=\"rounded-full bg-slate-100 px-2 py-1 text-xs font-medium text-slate-600\">\r\n                    {filters.length} filter{filters.length > 1 ? \"s\" : \"\"} active\r\n                </span>\r\n            )}\r\n\r\n            <button\r\n                type=\"button\"\r\n                onClick={onClear}\r\n                className=\"rounded-md border border-slate-300 bg-white px-3 py-1.5 text-sm font-medium text-slate-700 shadow-sm hover:bg-slate-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-teal-500\"\r\n            >\r\n                Clear Filters\r\n            </button>\r\n            <button\r\n                type=\"button\"\r\n                onClick={onExport}\r\n                className=\"rounded-md border border-slate-300 bg-white px-3 py-1.5 text-sm font-medium text-slate-700 shadow-sm hover:bg-slate-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-teal-500\"\r\n            >\r\n                Export CSV\r\n            </button>\r\n        </div>\r\n    );\r\n}\r\n\r\n/* ========================== Headless Inputs ========================== */\r\n\r\nfunction useClickOutsideClose<T extends HTMLElement>(onClose: () => void) {\r\n    const ref = React.useRef<T | null>(null);\r\n    React.useEffect(() => {\r\n        const onDocClick = (e: MouseEvent) => {\r\n            if (!ref.current) return;\r\n            if (!ref.current.contains(e.target as Node)) onClose();\r\n        };\r\n        const onEsc = (e: KeyboardEvent) => {\r\n            if (e.key === \"Escape\") onClose();\r\n        };\r\n        document.addEventListener(\"mousedown\", onDocClick);\r\n        document.addEventListener(\"keydown\", onEsc);\r\n        return () => {\r\n            document.removeEventListener(\"mousedown\", onDocClick);\r\n            document.removeEventListener(\"keydown\", onEsc);\r\n        };\r\n    }, [onClose]);\r\n    return ref;\r\n}\r\n\r\nfunction SingleSelect({\r\n    label,\r\n    value,\r\n    options,\r\n    onChange,\r\n    className,\r\n    \"aria-label\": ariaLabel,\r\n}: {\r\n    label: string; // control name when empty\r\n    value: string | null;\r\n    options: Option[];\r\n    onChange: (val: string | null) => void;\r\n    className?: string;\r\n    \"aria-label\"?: string;\r\n}) {\r\n    const [open, setOpen] = React.useState(false);\r\n    const ref = useClickOutsideClose<HTMLDivElement>(() => setOpen(false));\r\n    const current = options.find((o) => o.value === value);\r\n    const displayText = current ? current.label : label;\r\n\r\n    return (\r\n        <div className={`relative ${className ?? \"\"}`} ref={ref}>\r\n            <button\r\n                type=\"button\"\r\n                aria-label={ariaLabel || label}\r\n                onClick={() => setOpen((o) => !o)}\r\n                className=\"inline-flex min-w-[168px] items-center justify-between rounded-md border border-slate-300 bg-white px-2.5 py-1.5 text-sm text-slate-800 shadow-sm hover:bg-slate-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-teal-500\"\r\n            >\r\n                <span className={`truncate ${current ? \"\" : \"text-slate-500\"}`}>{displayText}</span>\r\n                <Caret />\r\n            </button>\r\n            {open && (\r\n                <div role=\"listbox\" className=\"absolute z-40 mt-1 max-h-64 w-[min(280px,calc(100vw-2rem))] overflow-auto rounded-md border border-slate-200 bg-white p-1 shadow-lg\">\r\n                    <button\r\n                        className=\"w-full rounded px-2 py-1 text-left text-sm text-slate-700 hover:bg-slate-100\"\r\n                        onClick={() => { onChange(null); setOpen(false); }}\r\n                    >\r\n                        All\r\n                    </button>\r\n                    <div className=\"my-1 h-px bg-slate-100\" />\r\n                    {options.map((opt) => (\r\n                        <button\r\n                            key={opt.value}\r\n                            role=\"option\"\r\n                            aria-selected={opt.value === value}\r\n                            className={`w-full rounded px-2 py-1 text-left text-sm hover:bg-slate-100 ${opt.value === value ? \"bg-teal-50 text-teal-700\" : \"text-slate-700\"}`}\r\n                            onClick={() => { onChange(opt.value); setOpen(false); }}\r\n                        >\r\n                            {opt.label}\r\n                        </button>\r\n                    ))}\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction MultiSelect({\r\n    label,\r\n    values,\r\n    options,\r\n    onChange,\r\n    searchable = true,\r\n    className,\r\n    \"aria-label\": ariaLabel,\r\n}: {\r\n    label: string; // control name when empty\r\n    values: string[];\r\n    options: Option[];\r\n    onChange: (vals: string[]) => void;\r\n    searchable?: boolean;\r\n    className?: string;\r\n    \"aria-label\"?: string;\r\n}) {\r\n    const [open, setOpen] = React.useState(false);\r\n    const [query, setQuery] = React.useState(\"\");\r\n    const ref = useClickOutsideClose<HTMLDivElement>(() => setOpen(false));\r\n\r\n    const display =\r\n        values.length === 0\r\n            ? label\r\n            : values.length <= 2\r\n                ? options.filter((o) => values.includes(o.value)).map((o) => o.label).join(\", \")\r\n                : `${values.length} selected`;\r\n\r\n    const filtered = React.useMemo(() => {\r\n        if (!searchable || !query.trim()) return options;\r\n        const q = query.toLowerCase();\r\n        return options.filter((o) => o.label.toLowerCase().includes(q));\r\n    }, [options, searchable, query]);\r\n\r\n    const toggle = (val: string) => {\r\n        if (values.includes(val)) onChange(values.filter((v) => v !== val));\r\n        else onChange([...values, val]);\r\n    };\r\n\r\n    const selectAll = () => onChange(options.map((o) => o.value));\r\n    const clearAll = () => onChange([]);\r\n\r\n    return (\r\n        <div className={`relative ${className ?? \"\"}`} ref={ref}>\r\n            <button\r\n                type=\"button\"\r\n                aria-label={ariaLabel || label}\r\n                onClick={() => setOpen((o) => !o)}\r\n                className=\"inline-flex min-w-[220px] items-center justify-between rounded-md border border-slate-300 bg-white px-2.5 py-1.5 text-sm text-slate-800 shadow-sm hover:bg-slate-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-teal-500\"\r\n            >\r\n                <span className={`truncate ${values.length === 0 ? \"text-slate-500\" : \"\"}`}>{display}</span>\r\n                <Caret />\r\n            </button>\r\n            {open && (\r\n                <div role=\"listbox\" className=\"absolute z-40 mt-1 max-h-72 w-[min(420px,calc(100vw-2rem))] overflow-auto rounded-md border border-slate-200 bg-white p-2 shadow-lg\">\r\n                    {searchable && (\r\n                        <div className=\"mb-2\">\r\n                            <input\r\n                                autoFocus\r\n                                type=\"text\"\r\n                                placeholder=\"Search…\"\r\n                                value={query}\r\n                                onChange={(e) => setQuery(e.target.value)}\r\n                                className=\"w-full rounded border border-slate-300 px-2 py-1 text-sm\"\r\n                            />\r\n                        </div>\r\n                    )}\r\n                    <div className=\"flex items-center justify-between px-1 pb-2\">\r\n                        <div className=\"text-xs text-slate-500\">{options.length} options</div>\r\n                        <div className=\"space-x-2\">\r\n                            <button className=\"rounded bg-slate-100 px-2 py-0.5 text-xs hover:bg-slate-200\" onClick={selectAll}>\r\n                                Select all\r\n                            </button>\r\n                            <button className=\"rounded bg-slate-100 px-2 py-0.5 text-xs hover:bg-slate-200\" onClick={clearAll}>\r\n                                Clear\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                    <ul className=\"space-y-0.5\">\r\n                        {filtered.map((opt) => {\r\n                            const checked = values.includes(opt.value);\r\n                            return (\r\n                                <li key={opt.value}>\r\n                                    <label className=\"flex cursor-pointer items-center gap-2 rounded px-2 py-1 text-sm hover:bg-slate-50\">\r\n                                        <input\r\n                                            type=\"checkbox\"\r\n                                            className=\"h-3.5 w-3.5 accent-teal-600\"\r\n                                            checked={checked}\r\n                                            onChange={() => toggle(opt.value)}\r\n                                        />\r\n                                        <span className={checked ? \"text-teal-700\" : \"text-slate-700\"}>{opt.label}</span>\r\n                                    </label>\r\n                                </li>\r\n                            );\r\n                        })}\r\n                    </ul>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction Caret() {\r\n    return (\r\n        <svg viewBox=\"0 0 20 20\" aria-hidden=\"true\" className=\"ml-2 h-4 w-4 text-slate-500\">\r\n            <path d=\"M5.25 7.5l4.5 4.5 4.5-4.5\" stroke=\"currentColor\" strokeWidth=\"1.8\" fill=\"none\" strokeLinecap=\"round\" />\r\n        </svg>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 594, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/JeremyJoyner/code/budgetintelligence/components/grid/VirtualRows.tsx"],"sourcesContent":["\r\n// components/grid/VirtualRows.tsx\r\n\"use client\";\r\n\r\nimport * as React from \"react\";\r\nimport { useVirtualizer } from \"@tanstack/react-virtual\";\r\nimport { flexRender, type Table } from \"@tanstack/react-table\";\r\n\r\n/**\r\n * VirtualRows — scrollable virtualized body for TanStack Table.\r\n * Hides helper columns (e.g., meta.hiddenHelper) automatically.\r\n */\r\n\r\nexport default function VirtualRows<TData extends object>({\r\n    table,\r\n    height = 720,\r\n    rowClassName,\r\n    toggleSelectOnRowClick = true,\r\n    \"aria-label\": ariaLabel = \"Virtualized grid body\",\r\n}: {\r\n    table: Table<TData>;\r\n    height?: number;\r\n    rowClassName?: (rowIndex: number) => string | undefined;\r\n    toggleSelectOnRowClick?: boolean;\r\n    \"aria-label\"?: string;\r\n}) {\r\n    const parentRef = React.useRef<HTMLDivElement>(null);\r\n\r\n    const rows = table.getRowModel().rows;\r\n    const virtualizer = useVirtualizer({\r\n        count: rows.length,\r\n        getScrollElement: () => parentRef.current,\r\n        estimateSize: () => 40,\r\n        overscan: 8,\r\n    });\r\n    const virtualItems = virtualizer.getVirtualItems();\r\n\r\n    return (\r\n        <div\r\n            ref={parentRef}\r\n            className=\"border-x border-b border-slate-200\"\r\n            style={{ height, overflow: \"auto\", position: \"relative\" }}\r\n            aria-label={ariaLabel}\r\n        >\r\n            <div style={{ height: virtualizer.getTotalSize(), position: \"relative\" }}>\r\n                {virtualItems.map((vi) => {\r\n                    const row = rows[vi.index];\r\n\r\n                    // Only render visible, non-helper columns\r\n                    const visibleCells = row\r\n                        .getVisibleCells()\r\n                        .filter((c) => !(c.column.columnDef as any)?.meta?.hiddenHelper);\r\n\r\n                    const cls =\r\n                        rowClassName?.(vi.index) ??\r\n                        `grid grid-cols-[repeat(var(--cols),minmax(140px,1fr))] border-b border-slate-100 px-2 text-sm ${row.getIsSelected() ? \"bg-teal-50\" : \"bg-white\"\r\n                        } hover:bg-slate-50`;\r\n\r\n                    return (\r\n                        <div\r\n                            key={row.id}\r\n                            className={cls}\r\n                            style={{\r\n                                transform: `translateY(${vi.start}px)`,\r\n                                [\"--cols\" as any]: visibleCells.length,\r\n                                height: vi.size,\r\n                                alignItems: \"center\",\r\n                            }}\r\n                            onClick={() => toggleSelectOnRowClick && row.toggleSelected()}\r\n                        >\r\n                            {visibleCells.map((cell) => (\r\n                                <div key={cell.id} className=\"pr-2\">\r\n                                    {flexRender(cell.column.columnDef.cell, cell.getContext())}\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    );\r\n                })}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;AAIA;AACA;AACA;;;AALA,kCAAkC;AAClC;;;;AAWe,SAAS,YAAkC,EACtD,KAAK,EACL,SAAS,GAAG,EACZ,YAAY,EACZ,yBAAyB,IAAI,EAC7B,cAAc,YAAY,uBAAuB,EAOpD;;IACG,MAAM,YAAY,uKAAY,CAAiB;IAE/C,MAAM,OAAO,MAAM,WAAW,GAAG,IAAI;IACrC,MAAM,cAAc,IAAA,2MAAc,EAAC;QAC/B,OAAO,KAAK,MAAM;QAClB,gBAAgB;uDAAE,IAAM,UAAU,OAAO;;QACzC,YAAY;uDAAE,IAAM;;QACpB,UAAU;IACd;IACA,MAAM,eAAe,YAAY,eAAe;IAEhD,qBACI,6LAAC;QACG,KAAK;QACL,WAAU;QACV,OAAO;YAAE;YAAQ,UAAU;YAAQ,UAAU;QAAW;QACxD,cAAY;kBAEZ,cAAA,6LAAC;YAAI,OAAO;gBAAE,QAAQ,YAAY,YAAY;gBAAI,UAAU;YAAW;sBAClE,aAAa,GAAG,CAAC,CAAC;gBACf,MAAM,MAAM,IAAI,CAAC,GAAG,KAAK,CAAC;gBAE1B,0CAA0C;gBAC1C,MAAM,eAAe,IAChB,eAAe,GACf,MAAM,CAAC,CAAC,IAAM,CAAE,EAAE,MAAM,CAAC,SAAS,EAAU,MAAM;gBAEvD,MAAM,MACF,eAAe,GAAG,KAAK,KACvB,CAAC,8FAA8F,EAAE,IAAI,aAAa,KAAK,eAAe,WACrI,kBAAkB,CAAC;gBAExB,qBACI,6LAAC;oBAEG,WAAW;oBACX,OAAO;wBACH,WAAW,CAAC,WAAW,EAAE,GAAG,KAAK,CAAC,GAAG,CAAC;wBACtC,CAAC,SAAgB,EAAE,aAAa,MAAM;wBACtC,QAAQ,GAAG,IAAI;wBACf,YAAY;oBAChB;oBACA,SAAS,IAAM,0BAA0B,IAAI,cAAc;8BAE1D,aAAa,GAAG,CAAC,CAAC,qBACf,6LAAC;4BAAkB,WAAU;sCACxB,IAAA,uMAAU,EAAC,KAAK,MAAM,CAAC,SAAS,CAAC,IAAI,EAAE,KAAK,UAAU;2BADjD,KAAK,EAAE;;;;;mBAXhB,IAAI,EAAE;;;;;YAiBvB;;;;;;;;;;;AAIhB;GApEwB;;QAgBA,2MAAc;;;KAhBd"}},
    {"offset": {"line": 692, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/JeremyJoyner/code/budgetintelligence/components/grid/AmountCell.tsx"],"sourcesContent":["\r\n\"use client\";\r\n\r\nimport * as React from \"react\";\r\n\r\n/**\r\n * AmountCell — standalone inline editor for the \"Amount\" column.\r\n * - Click to enter edit mode\r\n * - Commit on Enter/blur; Escape cancels\r\n * - Persists via table.options.meta.updateRow(rowIndex, { amount: next })\r\n *\r\n * Requirements from parent table:\r\n *   - The TanStack Table instance must define `meta.updateRow(index, partial)`\r\n *     which will update backing data (see BudgetGrid.tanstack.tsx).\r\n */\r\n\r\nexport default function AmountCell({\r\n    getValue,\r\n    row,\r\n    table,\r\n}: {\r\n    getValue: () => number | null | undefined;\r\n    row: any;\r\n    table: any;\r\n}) {\r\n    const initial = getValue();\r\n    const [editing, setEditing] = React.useState(false);\r\n    const [draft, setDraft] = React.useState<number | \"\">(\r\n        typeof initial === \"number\" ? initial : initial == null ? \"\" : Number(initial)\r\n    );\r\n\r\n    // Format helper (display only)\r\n    const fmtUSD = React.useCallback(\r\n        (n: number) =>\r\n            new Intl.NumberFormat(\"en-US\", {\r\n                style: \"currency\",\r\n                currency: \"USD\",\r\n                maximumFractionDigits: 0,\r\n            }).format(n),\r\n        []\r\n    );\r\n\r\n    const commit = () => {\r\n        const next = draft === \"\" ? null : Number(draft);\r\n        table.options.meta?.updateRow?.(row.index, { amount: next });\r\n        setEditing(false);\r\n    };\r\n\r\n    const cancel = () => {\r\n        // Revert to current value in the row\r\n        const current = getValue();\r\n        setDraft(typeof current === \"number\" ? current : current == null ? \"\" : Number(current));\r\n        setEditing(false);\r\n    };\r\n\r\n    return (\r\n        <div className=\"text-right\">\r\n            {editing ? (\r\n                <input\r\n                    autoFocus\r\n                    type=\"number\"\r\n                    step={1}\r\n                    className=\"w-full rounded border border-slate-300 px-2 py-1 text-right text-sm\"\r\n                    value={draft}\r\n                    onChange={(e) => setDraft(e.target.value === \"\" ? \"\" : Number(e.target.value))}\r\n                    onBlur={commit}\r\n                    onKeyDown={(e) => {\r\n                        if (e.key === \"Enter\") commit();\r\n                        if (e.key === \"Escape\") cancel();\r\n                    }}\r\n                />\r\n            ) : (\r\n                <button\r\n                    className=\"w-full text-right tabular-nums\"\r\n                    onClick={() => setEditing(true)}\r\n                    title=\"Click to edit\"\r\n                >\r\n                    {typeof initial === \"number\" ? fmtUSD(initial) : \"—\"}\r\n                </button>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;AAGA;;;AAFA;;AAee,SAAS,WAAW,EAC/B,QAAQ,EACR,GAAG,EACH,KAAK,EAKR;;IACG,MAAM,UAAU;IAChB,MAAM,CAAC,SAAS,WAAW,GAAG,yKAAc,CAAC;IAC7C,MAAM,CAAC,OAAO,SAAS,GAAG,yKAAc,CACpC,OAAO,YAAY,WAAW,UAAU,WAAW,OAAO,KAAK,OAAO;IAG1E,+BAA+B;IAC/B,MAAM,SAAS,4KAAiB;0CAC5B,CAAC,IACG,IAAI,KAAK,YAAY,CAAC,SAAS;gBAC3B,OAAO;gBACP,UAAU;gBACV,uBAAuB;YAC3B,GAAG,MAAM,CAAC;yCACd,EAAE;IAGN,MAAM,SAAS;QACX,MAAM,OAAO,UAAU,KAAK,OAAO,OAAO;QAC1C,MAAM,OAAO,CAAC,IAAI,EAAE,YAAY,IAAI,KAAK,EAAE;YAAE,QAAQ;QAAK;QAC1D,WAAW;IACf;IAEA,MAAM,SAAS;QACX,qCAAqC;QACrC,MAAM,UAAU;QAChB,SAAS,OAAO,YAAY,WAAW,UAAU,WAAW,OAAO,KAAK,OAAO;QAC/E,WAAW;IACf;IAEA,qBACI,6LAAC;QAAI,WAAU;kBACV,wBACG,6LAAC;YACG,SAAS;YACT,MAAK;YACL,MAAM;YACN,WAAU;YACV,OAAO;YACP,UAAU,CAAC,IAAM,SAAS,EAAE,MAAM,CAAC,KAAK,KAAK,KAAK,KAAK,OAAO,EAAE,MAAM,CAAC,KAAK;YAC5E,QAAQ;YACR,WAAW,CAAC;gBACR,IAAI,EAAE,GAAG,KAAK,SAAS;gBACvB,IAAI,EAAE,GAAG,KAAK,UAAU;YAC5B;;;;;iCAGJ,6LAAC;YACG,WAAU;YACV,SAAS,IAAM,WAAW;YAC1B,OAAM;sBAEL,OAAO,YAAY,WAAW,OAAO,WAAW;;;;;;;;;;;AAKrE;GAlEwB;KAAA"}},
    {"offset": {"line": 773, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/JeremyJoyner/code/budgetintelligence/components/grid/filters.tsx"],"sourcesContent":["\r\n// components/grid/filters.ts\r\n\r\n/**\r\n * Reusable filter functions & helpers for TanStack Table.\r\n */\r\n\r\nimport type { Row } from \"@tanstack/react-table\";\r\n\r\n/**\r\n * multiIncludesSome\r\n * Matches when the cell's string value is contained in the selected array.\r\n * If the filter array is empty or not provided, the row passes.\r\n */\r\nexport function multiIncludesSome<TData>(\r\n    row: Row<TData>,\r\n    columnId: string,\r\n    filterValue: string[] | undefined\r\n) {\r\n    if (!Array.isArray(filterValue) || filterValue.length === 0) return true;\r\n    const v = String(row.getValue(columnId) ?? \"\");\r\n    return filterValue.includes(v);\r\n}\r\n\r\n/**\r\n * equalsString\r\n * Exact string match for single-select filters. Empty filter → pass.\r\n */\r\nexport function equalsString<TData>(\r\n    row: Row<TData>,\r\n    columnId: string,\r\n    filterValue: string | null | undefined\r\n) {\r\n    if (!filterValue) return true;\r\n    const v = String(row.getValue(columnId) ?? \"\");\r\n    return v === String(filterValue);\r\n}\r\n\r\n/**\r\n * parseYearFromPeriod\r\n * Supports values like \"2026-01\" or \"2026\" (also numbers).\r\n * Returns a 4-digit year string or null if not parseable.\r\n */\r\nexport function parseYearFromPeriod(\r\n    period: string | number | null | undefined\r\n): string | null {\r\n    if (period == null) return null;\r\n    const s = String(period);\r\n    const y = s.slice(0, 4);\r\n    return /^\\d{4}$/.test(y) ? y : null;\r\n}\r\n"],"names":[],"mappings":"AACA,6BAA6B;AAE7B;;CAEC;;;;;;;;AASM,SAAS,kBACZ,GAAe,EACf,QAAgB,EAChB,WAAiC;IAEjC,IAAI,CAAC,MAAM,OAAO,CAAC,gBAAgB,YAAY,MAAM,KAAK,GAAG,OAAO;IACpE,MAAM,IAAI,OAAO,IAAI,QAAQ,CAAC,aAAa;IAC3C,OAAO,YAAY,QAAQ,CAAC;AAChC;AAMO,SAAS,aACZ,GAAe,EACf,QAAgB,EAChB,WAAsC;IAEtC,IAAI,CAAC,aAAa,OAAO;IACzB,MAAM,IAAI,OAAO,IAAI,QAAQ,CAAC,aAAa;IAC3C,OAAO,MAAM,OAAO;AACxB;AAOO,SAAS,oBACZ,MAA0C;IAE1C,IAAI,UAAU,MAAM,OAAO;IAC3B,MAAM,IAAI,OAAO;IACjB,MAAM,IAAI,EAAE,KAAK,CAAC,GAAG;IACrB,OAAO,UAAU,IAAI,CAAC,KAAK,IAAI;AACnC"}},
    {"offset": {"line": 807, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/JeremyJoyner/code/budgetintelligence/components/grid/columns.ts"],"sourcesContent":["\r\n// components/grid/columns.ts\r\nimport React from \"react\";\r\nimport type { ColumnDef, CellContext } from \"@tanstack/react-table\";\r\nimport AmountCell from \"./AmountCell\";\r\nimport { multiIncludesSome, equalsString, parseYearFromPeriod } from \"./filters\";\r\n\r\n/** Shared row type */\r\nexport type BudgetLine = {\r\n    type: \"revenue\" | \"expense\" | \"home office\" | string;\r\n    community: string;\r\n    category: string;\r\n    subCategory?: string | null;\r\n    budgetMethod?: string | null;\r\n    driver?: string | null;\r\n    driverTag?: string | null;\r\n    glCode?: string | null;\r\n    period?: string | number | null; // e.g., \"2026-01\" or \"2026\"\r\n    amount?: number | null;\r\n};\r\n\r\nexport function createBudgetColumns(): ColumnDef<BudgetLine, unknown>[] {\r\n    return [\r\n        {\r\n            id: \"community\",\r\n            accessorKey: \"community\",\r\n            header: \"Community\",\r\n            meta: { filterPlaceholder: \"filter…\" },\r\n            filterFn: multiIncludesSome,\r\n            enablePinning: true,\r\n        },\r\n        {\r\n            id: \"type\",\r\n            accessorKey: \"type\",\r\n            header: \"Type\",\r\n            size: 130,\r\n            filterFn: equalsString,\r\n        },\r\n        {\r\n            id: \"category\",\r\n            accessorKey: \"category\",\r\n            header: \"Category\",\r\n            filterFn: multiIncludesSome,\r\n        },\r\n        { id: \"subCategory\", accessorKey: \"subCategory\", header: \"Subcategory\" },\r\n        { id: \"period\", accessorKey: \"period\", header: \"Period\", size: 120 },\r\n        { id: \"glCode\", accessorKey: \"glCode\", header: \"GL Code\", size: 120 },\r\n        { id: \"budgetMethod\", accessorKey: \"budgetMethod\", header: \"Method\", size: 180 },\r\n        {\r\n            id: \"driver\",\r\n            header: \"Driver\",\r\n            accessorFn: (row) => row.driver ?? row.driverTag ?? null,\r\n        },\r\n\r\n        // Amount column: wrap AmountCell without JSX (this file is .ts)\r\n        {\r\n            id: \"amount\",\r\n            accessorKey: \"amount\",\r\n            header: \"Amount\",\r\n            size: 140,\r\n            cell: (ctx: CellContext<BudgetLine, unknown>) =>\r\n                React.createElement(AmountCell, {\r\n                    // Narrow unknown -> number | null | undefined\r\n                    getValue: () => ctx.getValue() as number | null | undefined,\r\n                    row: ctx.row,\r\n                    table: ctx.table,\r\n                }),\r\n        },\r\n\r\n        // Hidden helper column for Year filtering (derived from period)\r\n        {\r\n            id: \"__year\",\r\n            accessorFn: (row) => parseYearFromPeriod(row.period),\r\n            header: \"Year (hidden)\",\r\n            enableHiding: true,\r\n            meta: { hiddenHelper: true },\r\n            filterFn: (r, id, val: string | null) =>\r\n                !val || String(r.getValue(id) ?? \"\") === String(val),\r\n        },\r\n    ];\r\n}\r\n``\r\n\r\n"],"names":[],"mappings":";;;;AACA,6BAA6B;AAC7B;AAEA;AACA;;;;AAgBO,SAAS;IACZ,OAAO;QACH;YACI,IAAI;YACJ,aAAa;YACb,QAAQ;YACR,MAAM;gBAAE,mBAAmB;YAAU;YACrC,UAAU,sJAAiB;YAC3B,eAAe;QACnB;QACA;YACI,IAAI;YACJ,aAAa;YACb,QAAQ;YACR,MAAM;YACN,UAAU,iJAAY;QAC1B;QACA;YACI,IAAI;YACJ,aAAa;YACb,QAAQ;YACR,UAAU,sJAAiB;QAC/B;QACA;YAAE,IAAI;YAAe,aAAa;YAAe,QAAQ;QAAc;QACvE;YAAE,IAAI;YAAU,aAAa;YAAU,QAAQ;YAAU,MAAM;QAAI;QACnE;YAAE,IAAI;YAAU,aAAa;YAAU,QAAQ;YAAW,MAAM;QAAI;QACpE;YAAE,IAAI;YAAgB,aAAa;YAAgB,QAAQ;YAAU,MAAM;QAAI;QAC/E;YACI,IAAI;YACJ,QAAQ;YACR,YAAY,CAAC,MAAQ,IAAI,MAAM,IAAI,IAAI,SAAS,IAAI;QACxD;QAEA,gEAAgE;QAChE;YACI,IAAI;YACJ,aAAa;YACb,QAAQ;YACR,MAAM;YACN,MAAM,CAAC,oBACH,wKAAK,CAAC,aAAa,CAAC,+IAAU,EAAE;oBAC5B,8CAA8C;oBAC9C,UAAU,IAAM,IAAI,QAAQ;oBAC5B,KAAK,IAAI,GAAG;oBACZ,OAAO,IAAI,KAAK;gBACpB;QACR;QAEA,gEAAgE;QAChE;YACI,IAAI;YACJ,YAAY,CAAC,MAAQ,IAAA,wJAAmB,EAAC,IAAI,MAAM;YACnD,QAAQ;YACR,cAAc;YACd,MAAM;gBAAE,cAAc;YAAK;YAC3B,UAAU,CAAC,GAAG,IAAI,MACd,CAAC,OAAO,OAAO,EAAE,QAAQ,CAAC,OAAO,QAAQ,OAAO;QACxD;KACH;AACL;AACA,EAAE"}},
    {"offset": {"line": 905, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/JeremyJoyner/code/budgetintelligence/components/grid/totals.ts"],"sourcesContent":["\r\n// components/grid/totals.ts\r\nimport type { Table } from \"@tanstack/react-table\";\r\n\r\n/**\r\n * sumColumnFiltered\r\n * Sums a numeric column using the table's *filtered* row model.\r\n * Usage:\r\n *   const total = sumColumnFiltered(table, r => r.amount);\r\n */\r\nexport function sumColumnFiltered<T>(\r\n    table: Table<T>,\r\n    accessor: (row: T) => number | null | undefined\r\n): number {\r\n    let total = 0;\r\n    for (const row of table.getFilteredRowModel().rows) {\r\n        const v = accessor(row.original);\r\n        if (typeof v === \"number\") total += v;\r\n    }\r\n    return total;\r\n}\r\n\r\n/**\r\n * Optional: shared currency formatter.\r\n * If you prefer centralizing formatting, you can import this in the grid.\r\n */\r\nexport function fmtUSD(n: number): string {\r\n    return new Intl.NumberFormat(\"en-US\", {\r\n        style: \"currency\",\r\n        currency: \"USD\",\r\n        maximumFractionDigits: 0,\r\n    }).format(n);\r\n}\r\n"],"names":[],"mappings":"AACA,4BAA4B;;;;;;;AASrB,SAAS,kBACZ,KAAe,EACf,QAA+C;IAE/C,IAAI,QAAQ;IACZ,KAAK,MAAM,OAAO,MAAM,mBAAmB,GAAG,IAAI,CAAE;QAChD,MAAM,IAAI,SAAS,IAAI,QAAQ;QAC/B,IAAI,OAAO,MAAM,UAAU,SAAS;IACxC;IACA,OAAO;AACX;AAMO,SAAS,OAAO,CAAS;IAC5B,OAAO,IAAI,KAAK,YAAY,CAAC,SAAS;QAClC,OAAO;QACP,UAAU;QACV,uBAAuB;IAC3B,GAAG,MAAM,CAAC;AACd"}},
    {"offset": {"line": 934, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/JeremyJoyner/code/budgetintelligence/components/grid/export.ts"],"sourcesContent":["\r\n// components/grid/export.ts\r\n\r\n/**\r\n * Lightweight export utilities. CSV works without extra deps.\r\n * XLSX tries to dynamically import 'xlsx' if available.\r\n */\r\n\r\nimport type { ColumnDef } from \"@tanstack/react-table\";\r\n\r\nfunction escapeCsv(value: any) {\r\n    if (value === null || value === undefined) return \"\";\r\n    const str = String(value);\r\n    return /[\",\\n]/.test(str) ? `\"${str.replace(/\"/g, '\"\"')}\"` : str;\r\n}\r\n\r\n/**\r\n * exportRowsToCsv\r\n * Exports the provided row objects using the table's column order/ids.\r\n */\r\nexport function exportRowsToCsv<T extends object>(\r\n    rows: T[],\r\n    columns: ColumnDef<T, any>[],\r\n    fileName = \"budget-grid.csv\"\r\n) {\r\n    const colIds = columns\r\n        .map((c) =>\r\n            \"accessorKey\" in c && c.accessorKey\r\n                ? String(c.accessorKey)\r\n                : c.id\r\n                    ? String(c.id)\r\n                    : null\r\n        )\r\n        .filter(Boolean) as string[];\r\n\r\n    const header = colIds.join(\",\");\r\n    const body = rows\r\n        .map((r) => colIds.map((k) => escapeCsv((r as any)[k] ?? \"\")).join(\",\"))\r\n        .join(\"\\n\");\r\n\r\n    const csv = `${header}\\n${body}`;\r\n    const blob = new Blob([csv], { type: \"text/csv;charset=utf-8\" });\r\n    const a = document.createElement(\"a\");\r\n    a.href = URL.createObjectURL(blob);\r\n    a.download = fileName;\r\n    a.click();\r\n    URL.revokeObjectURL(a.href);\r\n}\r\n\r\n/**\r\n * exportRowsToXlsx (optional)\r\n * If 'xlsx' is not installed, logs a warning and returns.\r\n * To enable: `npm i xlsx` then call this function from your UI.\r\n */\r\nexport async function exportRowsToXlsx<T extends object>(\r\n    rows: T[],\r\n    columns: ColumnDef<T, any>[],\r\n    fileName = \"budget-grid.xlsx\"\r\n) {\r\n    try {\r\n        const XLSX = await import(\"xlsx\"); // requires 'xlsx' to be installed\r\n        const colIds = columns\r\n            .map((c) =>\r\n                \"accessorKey\" in c && c.accessorKey\r\n                    ? String(c.accessorKey)\r\n                    : c.id\r\n                        ? String(c.id)\r\n                        : null\r\n            )\r\n            .filter(Boolean) as string[];\r\n\r\n        const data = [\r\n            colIds, // header row\r\n            ...rows.map((r) => colIds.map((k) => (r as any)[k] ?? \"\")),\r\n        ];\r\n\r\n        const wb = XLSX.utils.book_new();\r\n        const ws = XLSX.utils.aoa_to_sheet(data);\r\n        XLSX.utils.book_append_sheet(wb, ws, \"Budget\");\r\n        XLSX.writeFile(wb, fileName);\r\n    } catch (err) {\r\n        // Non-fatal if xlsx isn't present; CSV is still available.\r\n        // eslint-disable-next-line no-console\r\n        console.warn(\r\n            \"[exportRowsToXlsx] 'xlsx' package not found. Install it with `npm i xlsx` to enable XLSX export.\"\r\n        );\r\n    }\r\n}\r\n\r\n"],"names":[],"mappings":"AACA,4BAA4B;AAE5B;;;CAGC;;;;;;AAID,SAAS,UAAU,KAAU;IACzB,IAAI,UAAU,QAAQ,UAAU,WAAW,OAAO;IAClD,MAAM,MAAM,OAAO;IACnB,OAAO,SAAS,IAAI,CAAC,OAAO,CAAC,CAAC,EAAE,IAAI,OAAO,CAAC,MAAM,MAAM,CAAC,CAAC,GAAG;AACjE;AAMO,SAAS,gBACZ,IAAS,EACT,OAA4B,EAC5B,WAAW,iBAAiB;IAE5B,MAAM,SAAS,QACV,GAAG,CAAC,CAAC,IACF,iBAAiB,KAAK,EAAE,WAAW,GAC7B,OAAO,EAAE,WAAW,IACpB,EAAE,EAAE,GACA,OAAO,EAAE,EAAE,IACX,MAEb,MAAM,CAAC;IAEZ,MAAM,SAAS,OAAO,IAAI,CAAC;IAC3B,MAAM,OAAO,KACR,GAAG,CAAC,CAAC,IAAM,OAAO,GAAG,CAAC,CAAC,IAAM,UAAU,AAAC,CAAS,CAAC,EAAE,IAAI,KAAK,IAAI,CAAC,MAClE,IAAI,CAAC;IAEV,MAAM,MAAM,GAAG,OAAO,EAAE,EAAE,MAAM;IAChC,MAAM,OAAO,IAAI,KAAK;QAAC;KAAI,EAAE;QAAE,MAAM;IAAyB;IAC9D,MAAM,IAAI,SAAS,aAAa,CAAC;IACjC,EAAE,IAAI,GAAG,IAAI,eAAe,CAAC;IAC7B,EAAE,QAAQ,GAAG;IACb,EAAE,KAAK;IACP,IAAI,eAAe,CAAC,EAAE,IAAI;AAC9B;AAOO,eAAe,iBAClB,IAAS,EACT,OAA4B,EAC5B,WAAW,kBAAkB;IAE7B,IAAI;QACA,MAAM,OAAO,+GAAsB,kCAAkC;QACrE,MAAM,SAAS,QACV,GAAG,CAAC,CAAC,IACF,iBAAiB,KAAK,EAAE,WAAW,GAC7B,OAAO,EAAE,WAAW,IACpB,EAAE,EAAE,GACA,OAAO,EAAE,EAAE,IACX,MAEb,MAAM,CAAC;QAEZ,MAAM,OAAO;YACT;eACG,KAAK,GAAG,CAAC,CAAC,IAAM,OAAO,GAAG,CAAC,CAAC,IAAM,AAAC,CAAS,CAAC,EAAE,IAAI;SACzD;QAED,MAAM,KAAK,KAAK,KAAK,CAAC,QAAQ;QAC9B,MAAM,KAAK,KAAK,KAAK,CAAC,YAAY,CAAC;QACnC,KAAK,KAAK,CAAC,iBAAiB,CAAC,IAAI,IAAI;QACrC,KAAK,SAAS,CAAC,IAAI;IACvB,EAAE,OAAO,KAAK;QACV,2DAA2D;QAC3D,sCAAsC;QACtC,QAAQ,IAAI,CACR;IAER;AACJ"}},
    {"offset": {"line": 990, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/JeremyJoyner/code/budgetintelligence/components/BudgetGrid.tanstack.tsx"],"sourcesContent":["\r\n\"use client\";\r\n\r\nimport React, { useMemo, useState } from \"react\";\r\nimport {\r\n    RowSelectionState,\r\n    SortingState,\r\n    ColumnFiltersState,\r\n    getCoreRowModel,\r\n    getFilteredRowModel,\r\n    getSortedRowModel,\r\n    useReactTable,\r\n    flexRender,\r\n    ColumnPinningState,\r\n    GroupingState,\r\n} from \"@tanstack/react-table\";\r\n\r\nimport ToolbarFilters from \"./grid/ToolbarFilters\";\r\nimport VirtualRows from \"./grid/VirtualRows\";\r\nimport { createBudgetColumns, type BudgetLine } from \"./grid/columns\";\r\nimport { sumColumnFiltered, fmtUSD } from \"./grid/totals\";\r\nimport { exportRowsToCsv } from \"./grid/export\";\r\n\r\ntype Props = { rows: BudgetLine[] };\r\n\r\nexport default function BudgetGrid({ rows }: Props) {\r\n    // local states\r\n    const [data, setData] = useState<BudgetLine[]>(() => rows ?? []);\r\n    const [sorting, setSorting] = useState<SortingState>([]);\r\n    const [filters, setFilters] = useState<ColumnFiltersState>([]);\r\n    const [rowSelection, setRowSelection] = useState<RowSelectionState>({});\r\n    const [columnVisibility, setColumnVisibility] = useState<Record<string, boolean>>({});\r\n    const [columnPinning, setColumnPinning] = useState<ColumnPinningState>({ left: [], right: [] });\r\n    const [grouping, setGrouping] = useState<GroupingState>([]);\r\n\r\n    // columns (from factory)\r\n    const columns = useMemo(() => createBudgetColumns(), []);\r\n\r\n    // table\r\n    const table = useReactTable({\r\n        data,\r\n        columns,\r\n        getCoreRowModel: getCoreRowModel(),\r\n        getFilteredRowModel: getFilteredRowModel(),\r\n        getSortedRowModel: getSortedRowModel(),\r\n\r\n        state: {\r\n            sorting,\r\n            columnFilters: filters,\r\n            rowSelection,\r\n            columnVisibility,\r\n            columnPinning,\r\n            grouping,\r\n        },\r\n\r\n        onSortingChange: setSorting,\r\n        onColumnFiltersChange: setFilters,\r\n        onRowSelectionChange: setRowSelection,\r\n        onColumnVisibilityChange: setColumnVisibility,\r\n        onColumnPinningChange: setColumnPinning,\r\n        onGroupingChange: setGrouping,\r\n\r\n        enableRowSelection: true,\r\n\r\n        meta: {\r\n            updateRow: (rowIndex: number, partial: Partial<BudgetLine>) => {\r\n                setData((old) => {\r\n                    const next = old.slice();\r\n                    next[rowIndex] = { ...next[rowIndex], ...partial };\r\n                    return next;\r\n                });\r\n            },\r\n        },\r\n\r\n        getRowId: (row) =>\r\n            `${row.community ?? \"\"}${row.type ?? \"\"}${row.category ?? \"\"}${row.subCategory ?? \"\"}${row.period ?? \"\"\r\n            }`,\r\n    });\r\n\r\n    // toolbar actions\r\n    const clearAllFilters = () => setFilters([]);\r\n    const exportCsv = () => {\r\n        const out = table.getRowModel().rows.map((r) => r.original);\r\n        exportRowsToCsv(out, columns);\r\n    };\r\n\r\n    // totals (filtered)\r\n    const totalFiltered = useMemo(\r\n        () => sumColumnFiltered(table, (r) => r.amount ?? null),\r\n        [table, data, filters, sorting, grouping]\r\n    );\r\n\r\n    return (\r\n        <section aria-label=\"Budget grid\" className=\"space-y-3\">\r\n            {/* Toolbar */}\r\n            <ToolbarFilters\r\n                table={table}\r\n                filters={filters}\r\n                setFilters={setFilters}\r\n                onClear={clearAllFilters}\r\n                onExport={exportCsv}\r\n            />\r\n\r\n            {/* Column headers + text filter row */}\r\n            <div className=\"rounded-t-lg border-x border-t border-slate-200 bg-slate-50\">\r\n                <div\r\n                    className=\"grid grid-cols-[repeat(var(--cols),minmax(140px,1fr))] px-2 py-2 text-xs font-semibold text-slate-600\"\r\n                    style={{\r\n                        [\"--cols\" as any]: table\r\n                            .getAllColumns()\r\n                            .filter((col) => col.getIsVisible() && !(col.columnDef as any)?.meta?.hiddenHelper)\r\n                            .length,\r\n                    }}\r\n                >\r\n                    {table.getFlatHeaders().map((header) => {\r\n                        if ((header.column.columnDef as any)?.meta?.hiddenHelper) return null;\r\n\r\n                        return (\r\n                            <div key={header.id} className=\"pr-2\">\r\n                                <button\r\n                                    className=\"inline-flex items-center gap-1 hover:text-slate-900\"\r\n                                    onClick={header.column.getToggleSortingHandler()}\r\n                                    title=\"Click to sort\"\r\n                                >\r\n                                    {flexRender(header.column.columnDef.header, header.getContext())}\r\n                                    {{\r\n                                        asc: \" ↑\",\r\n                                        desc: \" ↓\",\r\n                                    }[header.column.getIsSorted() as string] ?? null}\r\n                                </button>\r\n\r\n                                {header.column.getCanFilter() && (\r\n                                    <div className=\"mt-1\">\r\n                                        <input\r\n                                            className=\"w-full rounded border border-slate-300 px-1.5 py-1 text-xs\"\r\n                                            placeholder={\r\n                                                (header.column.columnDef as any).meta?.filterPlaceholder ?? \"filter…\"\r\n                                            }\r\n                                            value={(header.column.getFilterValue() as string) ?? \"\"}\r\n                                            onChange={(e) => header.column.setFilterValue(e.target.value)}\r\n                                        />\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        );\r\n                    })}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Virtualized body */}\r\n            <VirtualRows table={table} height={720} />\r\n\r\n            {/* Pinned TOTAL (filtered) */}\r\n            <div className=\"rounded-b-lg border border-teal-200 bg-teal-50 px-3 py-2 text-sm font-semibold text-teal-800\">\r\n                TOTAL (filtered): <span className=\"tabular-nums\">{fmtUSD(totalFiltered)}</span>\r\n            </div>\r\n        </section>\r\n    );\r\n}\r\n\r\n/** Re-export the type so existing imports keep working */\r\nexport type { BudgetLine } from \"./grid/columns\";\r\n"],"names":[],"mappings":"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"}}]
}