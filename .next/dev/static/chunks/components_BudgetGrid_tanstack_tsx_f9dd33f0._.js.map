{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/JeremyJoyner/code/budgetintelligence/components/BudgetGrid.tanstack.tsx"],"sourcesContent":["\r\n\"use client\";\r\n\r\n/**\r\n * BudgetGrid.tanstack.tsx — TanStack Table v8 + React Virtual\r\n * Toolbar retooled: Community (multi), Year (single), Budget Type (single),\r\n * Category (multi) + Clear Filters + Export CSV.\r\n * – Removes all Bulk Edit UI.\r\n * – Keeps: inline Amount editing, per-column text filters, virtualization,\r\n *   TOTAL (filtered) footer.\r\n */\r\n\r\nimport React, { useCallback, useMemo, useRef, useState } from \"react\";\r\nimport {\r\n    ColumnDef,\r\n    RowSelectionState,\r\n    SortingState,\r\n    ColumnFiltersState,\r\n    getCoreRowModel,\r\n    getFilteredRowModel,\r\n    getSortedRowModel,\r\n    useReactTable,\r\n    flexRender,\r\n    ColumnPinningState,\r\n    GroupingState,\r\n    Column\r\n} from \"@tanstack/react-table\";\r\nimport { useVirtualizer } from \"@tanstack/react-virtual\";\r\n\r\n// ---------- types ----------\r\nexport type BudgetLine = {\r\n    type: \"revenue\" | \"expense\" | \"home office\" | string;\r\n    community: string;\r\n    category: string;\r\n    subCategory?: string | null;\r\n    budgetMethod?: string | null;\r\n    driver?: string | null;\r\n    driverTag?: string | null;\r\n    glCode?: string | null;\r\n    period?: string | number | null; // e.g., \"2026-01\" or \"2026\"\r\n    amount?: number | null;\r\n};\r\n\r\ntype Props = {\r\n    rows: BudgetLine[];\r\n};\r\n\r\n// ---------- helpers ----------\r\nconst fmtUSD = (n: number) =>\r\n    new Intl.NumberFormat(\"en-US\", {\r\n        style: \"currency\",\r\n        currency: \"USD\",\r\n        maximumFractionDigits: 0,\r\n    }).format(n);\r\n\r\nfunction exportRowsToCsv<T extends object>(\r\n    rows: T[],\r\n    columns: ColumnDef<T, any>[],\r\n    fileName = \"budget-grid.csv\"\r\n) {\r\n    const colIds = columns\r\n        .map((c) =>\r\n            \"accessorKey\" in c && c.accessorKey ? String(c.accessorKey)\r\n                : c.id ? String(c.id)\r\n                    : null\r\n        )\r\n        .filter(Boolean) as string[];\r\n\r\n    const esc = (s: any) => {\r\n        if (s === null || s === undefined) return \"\";\r\n        const str = String(s);\r\n        return /[\",\\n]/.test(str) ? `\"${str.replace(/\"/g, '\"\"')}\"` : str;\r\n    };\r\n\r\n    const header = colIds.join(\",\");\r\n    const body = rows\r\n        .map((r) =>\r\n            colIds\r\n                .map((k) => {\r\n                    if (k === \"amount\") return esc((r as any)[k] ?? \"\");\r\n                    return esc((r as any)[k] ?? \"\");\r\n                })\r\n                .join(\",\")\r\n        )\r\n        .join(\"\\n\");\r\n\r\n    const csv = `${header}\\n${body}`;\r\n    const blob = new Blob([csv], { type: \"text/csv;charset=utf-8\" });\r\n    const a = document.createElement(\"a\");\r\n    a.href = URL.createObjectURL(blob);\r\n    a.download = fileName;\r\n    a.click();\r\n    URL.revokeObjectURL(a.href);\r\n}\r\n\r\n// ---------- editable amount cell ----------\r\nfunction AmountCell({\r\n    getValue,\r\n    row,\r\n    table,\r\n}: {\r\n    getValue: () => number | null | undefined;\r\n    row: any;\r\n    table: any;\r\n}) {\r\n    const initial = getValue();\r\n    const [editing, setEditing] = useState(false);\r\n    const [draft, setDraft] = useState<number | \"\">(\r\n        typeof initial === \"number\" ? initial : initial == null ? \"\" : Number(initial)\r\n    );\r\n\r\n    const commit = () => {\r\n        const next = draft === \"\" ? null : Number(draft);\r\n        table.options.meta?.updateRow?.(row.index, { amount: next });\r\n        setEditing(false);\r\n    };\r\n\r\n    return (\r\n        <div className=\"text-right\">\r\n            {editing ? (\r\n                <input\r\n                    autoFocus\r\n                    type=\"number\"\r\n                    step={1}\r\n                    className=\"w-full rounded border border-slate-300 px-2 py-1 text-right text-sm\"\r\n                    value={draft}\r\n                    onChange={(e) => setDraft(e.target.value === \"\" ? \"\" : Number(e.target.value))}\r\n                    onBlur={commit}\r\n                    onKeyDown={(e) => {\r\n                        if (e.key === \"Enter\") commit();\r\n                        if (e.key === \"Escape\") setEditing(false);\r\n                    }}\r\n                />\r\n            ) : (\r\n                <button\r\n                    className=\"w-full text-right tabular-nums\"\r\n                    onClick={() => setEditing(true)}\r\n                    title=\"Click to edit\"\r\n                >\r\n                    {typeof initial === \"number\" ? fmtUSD(initial) : \"—\"}\r\n                </button>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\n// ---------- small headless dropdowns ----------\r\ntype Option = { label: string; value: string };\r\n\r\nfunction useClickOutsideClose<T extends HTMLElement>(onClose: () => void) {\r\n    const ref = useRef<T | null>(null);\r\n    React.useEffect(() => {\r\n        const onDocClick = (e: MouseEvent) => {\r\n            if (!ref.current) return;\r\n            if (!ref.current.contains(e.target as Node)) onClose();\r\n        };\r\n        const onEsc = (e: KeyboardEvent) => {\r\n            if (e.key === \"Escape\") onClose();\r\n        };\r\n        document.addEventListener(\"mousedown\", onDocClick);\r\n        document.addEventListener(\"keydown\", onEsc);\r\n        return () => {\r\n            document.removeEventListener(\"mousedown\", onDocClick);\r\n            document.removeEventListener(\"keydown\", onEsc);\r\n        };\r\n    }, [onClose]);\r\n    return ref;\r\n}\r\n\r\nfunction SingleSelect({\r\n    label,\r\n    value,\r\n    options,\r\n    onChange,\r\n    className,\r\n    \"aria-label\": ariaLabel,\r\n}: {\r\n    label?: string;\r\n    value: string | null;\r\n    options: Option[];\r\n    onChange: (val: string | null) => void;\r\n    className?: string;\r\n    \"aria-label\"?: string;\r\n}) {\r\n    const [open, setOpen] = useState(false);\r\n    const ref = useClickOutsideClose<HTMLDivElement>(() => setOpen(false));\r\n    const current = options.find((o) => o.value === value);\r\n\r\n    return (\r\n        <div className={`relative ${className ?? \"\"}`} ref={ref}>\r\n            {label ? <span className=\"sr-only\">{label}</span> : null}\r\n            <button\r\n                type=\"button\"\r\n                aria-label={ariaLabel || label}\r\n                onClick={() => setOpen((o) => !o)}\r\n                className=\"inline-flex min-w-[168px] items-center justify-between rounded-md border border-slate-300 bg-white px-2.5 py-1.5 text-sm text-slate-800 shadow-sm hover:bg-slate-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-teal-500\"\r\n            >\r\n                <span className=\"truncate\">\r\n                    {current ? current.label : \"All\"}\r\n                </span>\r\n                <svg viewBox=\"0 0 20 20\" aria-hidden=\"true\" className=\"ml-2 h-4 w-4 text-slate-500\">\r\n                    <path d=\"M5.25 7.5l4.5 4.5 4.5-4.5\" stroke=\"currentColor\" strokeWidth=\"1.8\" fill=\"none\" strokeLinecap=\"round\" />\r\n                </svg>\r\n            </button>\r\n            {open && (\r\n                <div\r\n                    role=\"listbox\"\r\n                    className=\"absolute z-40 mt-1 max-h-64 w-[min(280px,calc(100vw-2rem))] overflow-auto rounded-md border border-slate-200 bg-white p-1 shadow-lg\"\r\n                >\r\n                    <button\r\n                        className=\"w-full rounded px-2 py-1 text-left text-sm text-slate-700 hover:bg-slate-100\"\r\n                        onClick={() => { onChange(null); setOpen(false); }}\r\n                    >\r\n                        All\r\n                    </button>\r\n                    <div className=\"my-1 h-px bg-slate-100\" />\r\n                    {options.map((opt) => (\r\n                        <button\r\n                            key={opt.value}\r\n                            role=\"option\"\r\n                            aria-selected={opt.value === value}\r\n                            className={`w-full rounded px-2 py-1 text-left text-sm hover:bg-slate-100 ${opt.value === value ? \"bg-teal-50 text-teal-700\" : \"text-slate-700\"}`}\r\n                            onClick={() => { onChange(opt.value); setOpen(false); }}\r\n                        >\r\n                            {opt.label}\r\n                        </button>\r\n                    ))}\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction MultiSelect({\r\n    label,\r\n    values,\r\n    options,\r\n    onChange,\r\n    searchable = true,\r\n    className,\r\n    \"aria-label\": ariaLabel,\r\n}: {\r\n    label?: string;\r\n    values: string[]; // selected values\r\n    options: Option[];\r\n    onChange: (vals: string[]) => void;\r\n    searchable?: boolean;\r\n    className?: string;\r\n    \"aria-label\"?: string;\r\n}) {\r\n    const [open, setOpen] = useState(false);\r\n    const [query, setQuery] = useState(\"\");\r\n    const ref = useClickOutsideClose<HTMLDivElement>(() => setOpen(false));\r\n    const display =\r\n        values.length === 0\r\n            ? \"All\"\r\n            : values.length <= 2\r\n                ? options\r\n                    .filter((o) => values.includes(o.value))\r\n                    .map((o) => o.label)\r\n                    .join(\", \")\r\n                : `${values.length} selected`;\r\n\r\n    const filtered = useMemo(() => {\r\n        if (!searchable || !query.trim()) return options;\r\n        const q = query.toLowerCase();\r\n        return options.filter((o) => o.label.toLowerCase().includes(q));\r\n    }, [options, searchable, query]);\r\n\r\n    const toggle = (val: string) => {\r\n        if (values.includes(val)) onChange(values.filter((v) => v !== val));\r\n        else onChange([...values, val]);\r\n    };\r\n\r\n    const selectAll = () => onChange(options.map((o) => o.value));\r\n    const clearAll = () => onChange([]);\r\n\r\n    return (\r\n        <div className={`relative ${className ?? \"\"}`} ref={ref}>\r\n            {label ? <span className=\"sr-only\">{label}</span> : null}\r\n            <button\r\n                type=\"button\"\r\n                aria-label={ariaLabel || label}\r\n                onClick={() => setOpen((o) => !o)}\r\n                className=\"inline-flex min-w-[220px] items-center justify-between rounded-md border border-slate-300 bg-white px-2.5 py-1.5 text-sm text-slate-800 shadow-sm hover:bg-slate-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-teal-500\"\r\n            >\r\n                <span className=\"truncate\">{display}</span>\r\n                <svg viewBox=\"0 0 20 20\" aria-hidden=\"true\" className=\"ml-2 h-4 w-4 text-slate-500\">\r\n                    <path d=\"M5.25 7.5l4.5 4.5 4.5-4.5\" stroke=\"currentColor\" strokeWidth=\"1.8\" fill=\"none\" strokeLinecap=\"round\" />\r\n                </svg>\r\n            </button>\r\n            {open && (\r\n                <div\r\n                    role=\"listbox\"\r\n                    className=\"absolute z-40 mt-1 max-h-72 w-[min(420px,calc(100vw-2rem))] overflow-auto rounded-md border border-slate-200 bg-white p-2 shadow-lg\"\r\n                >\r\n                    {searchable && (\r\n                        <div className=\"mb-2\">\r\n                            <input\r\n                                autoFocus\r\n                                type=\"text\"\r\n                                placeholder=\"Search…\"\r\n                                value={query}\r\n                                onChange={(e) => setQuery(e.target.value)}\r\n                                className=\"w-full rounded border border-slate-300 px-2 py-1 text-sm\"\r\n                            />\r\n                        </div>\r\n                    )}\r\n                    <div className=\"flex items-center justify-between px-1 pb-2\">\r\n                        <div className=\"text-xs text-slate-500\">{options.length} options</div>\r\n                        <div className=\"space-x-2\">\r\n                            <button className=\"rounded bg-slate-100 px-2 py-0.5 text-xs hover:bg-slate-200\" onClick={selectAll}>\r\n                                Select all\r\n                            </button>\r\n                            <button className=\"rounded bg-slate-100 px-2 py-0.5 text-xs hover:bg-slate-200\" onClick={clearAll}>\r\n                                Clear\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                    <ul className=\"space-y-0.5\">\r\n                        {filtered.map((opt) => {\r\n                            const checked = values.includes(opt.value);\r\n                            return (\r\n                                <li key={opt.value}>\r\n                                    <label className=\"flex cursor-pointer items-center gap-2 rounded px-2 py-1 text-sm hover:bg-slate-50\">\r\n                                        <input\r\n                                            type=\"checkbox\"\r\n                                            className=\"h-3.5 w-3.5 accent-teal-600\"\r\n                                            checked={checked}\r\n                                            onChange={() => toggle(opt.value)}\r\n                                        />\r\n                                        <span className={checked ? \"text-teal-700\" : \"text-slate-700\"}>{opt.label}</span>\r\n                                    </label>\r\n                                </li>\r\n                            );\r\n                        })}\r\n                    </ul>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\n// ---------- main ----------\r\nexport default function BudgetGrid({ rows }: Props) {\r\n    // local data\r\n    const [data, setData] = useState<BudgetLine[]>(() => rows ?? []);\r\n    const [sorting, setSorting] = useState<SortingState>([]);\r\n    const [filters, setFilters] = useState<ColumnFiltersState>([]);\r\n    const [rowSelection, setRowSelection] = useState<RowSelectionState>({});\r\n    const [columnVisibility, setColumnVisibility] = useState<Record<string, boolean>>({});\r\n    const [columnPinning, setColumnPinning] = useState<ColumnPinningState>({ left: [], right: [] });\r\n    const [grouping, setGrouping] = useState<GroupingState>([]);\r\n\r\n    // ---- columns ----\r\n    const columns = useMemo<ColumnDef<BudgetLine, any>[]>(() => {\r\n        // custom filterFns for array-typed filters (community/category multi-select)\r\n        const multiIncludesSome = (row: any, columnId: string, filterValue: string[]) => {\r\n            if (!Array.isArray(filterValue) || filterValue.length === 0) return true;\r\n            const v = String(row.getValue(columnId) ?? \"\");\r\n            return filterValue.includes(v);\r\n        };\r\n        const equalsString = (row: any, columnId: string, filterValue: string | null) => {\r\n            if (!filterValue) return true;\r\n            const v = String(row.getValue(columnId) ?? \"\");\r\n            return v === String(filterValue);\r\n        };\r\n\r\n        return [\r\n            {\r\n                id: \"community\",\r\n                accessorKey: \"community\",\r\n                header: \"Community\",\r\n                meta: { filterPlaceholder: \"filter…\" },\r\n                filterFn: multiIncludesSome, // driven by multi-select above grid\r\n                enablePinning: true,\r\n            },\r\n            {\r\n                id: \"type\",\r\n                accessorKey: \"type\",\r\n                header: \"Type\",\r\n                size: 130,\r\n                filterFn: equalsString, // single-select from toolbar\r\n            },\r\n            {\r\n                id: \"category\",\r\n                accessorKey: \"category\",\r\n                header: \"Category\",\r\n                filterFn: multiIncludesSome, // driven by multi-select above grid\r\n            },\r\n            {\r\n                id: \"subCategory\",\r\n                accessorKey: \"subCategory\",\r\n                header: \"Subcategory\",\r\n            },\r\n            {\r\n                id: \"period\",\r\n                accessorKey: \"period\",\r\n                header: \"Period\",\r\n                size: 120,\r\n                // Year filter (toolbar) will target a derived \"year\" value via custom filter below\r\n            },\r\n            {\r\n                id: \"glCode\",\r\n                accessorKey: \"glCode\",\r\n                header: \"GL Code\",\r\n                size: 120,\r\n            },\r\n            {\r\n                id: \"budgetMethod\",\r\n                accessorKey: \"budgetMethod\",\r\n                header: \"Method\",\r\n                size: 180,\r\n            },\r\n            {\r\n                id: \"driver\",\r\n                header: \"Driver\",\r\n                accessorFn: (row) => row.driver ?? row.driverTag ?? null,\r\n            },\r\n            {\r\n                id: \"amount\",\r\n                accessorKey: \"amount\",\r\n                header: \"Amount\",\r\n                cell: AmountCell,\r\n                size: 140,\r\n            },\r\n            // A virtual \"year\" column used only for filtering from the Year dropdown.\r\n            {\r\n                id: \"__year\",\r\n                accessorFn: (row) => {\r\n                    // parse from period (supports \"YYYY\" or \"YYYY-MM\")\r\n                    const p = row.period;\r\n                    if (p == null) return null;\r\n                    const s = String(p);\r\n                    const y = s.slice(0, 4);\r\n                    return /^\\d{4}$/.test(y) ? y : null;\r\n                },\r\n                header: \"Year (hidden)\",\r\n                enableHiding: true,\r\n                meta: { hiddenHelper: true },\r\n                filterFn: (r, id, val: string | null) => {\r\n                    if (!val) return true;\r\n                    const v = r.getValue(id);\r\n                    return String(v ?? \"\") === String(val);\r\n                },\r\n            },\r\n        ];\r\n    }, []);\r\n\r\n    // table\r\n    const table = useReactTable({\r\n        data,\r\n        columns,\r\n        getCoreRowModel: getCoreRowModel(),\r\n        getFilteredRowModel: getFilteredRowModel(),\r\n        getSortedRowModel: getSortedRowModel(),\r\n        state: {\r\n            sorting,\r\n            columnFilters: filters,\r\n            rowSelection,\r\n            columnVisibility,\r\n            columnPinning,\r\n            grouping,\r\n        },\r\n        onSortingChange: setSorting,\r\n        onColumnFiltersChange: setFilters,\r\n        onRowSelectionChange: setRowSelection,\r\n        onColumnVisibilityChange: setColumnVisibility,\r\n        onColumnPinningChange: setColumnPinning,\r\n        onGroupingChange: setGrouping,\r\n        enableRowSelection: true,\r\n        meta: {\r\n            updateRow: (rowIndex: number, partial: Partial<BudgetLine>) => {\r\n                setData((old) => {\r\n                    const next = old.slice();\r\n                    next[rowIndex] = { ...next[rowIndex], ...partial };\r\n                    return next;\r\n                });\r\n            },\r\n        },\r\n        getRowId: (row) =>\r\n            `${row.community ?? \"\"}${row.type ?? \"\"}${row.category ?? \"\"}${row.subCategory ?? \"\"}${row.period ?? \"\"}`,\r\n    });\r\n\r\n    // ---------- toolbar derived options ----------\r\n    // Pre-filtered options (so selection lists are derived from the dataset, not the filtered view),\r\n    // but Category will be derived from the partially-filtered view (community/type/year applied) to stay relevant.\r\n\r\n    const allCommunities = useMemo<Option[]>(() => {\r\n        const set = new Set<string>();\r\n        data.forEach((r) => r.community && set.add(r.community));\r\n        return Array.from(set).sort((a, b) => a.localeCompare(b)).map((v) => ({ value: v, label: v }));\r\n    }, [data]);\r\n\r\n    const yearOptions: Option[] = useMemo(\r\n        () => [\"2024\", \"2025\", \"2026\"].map((y) => ({ value: y, label: y })),\r\n        []\r\n    );\r\n\r\n    const typeOptions: Option[] = useMemo(\r\n        () => [\"expense\", \"revenue\", \"home office\"].map((t) => ({ value: t, label: t })),\r\n        []\r\n    );\r\n\r\n    // read helpers from filters\r\n    const getFilter = (id: string) => filters.find((f) => f.id === id)?.value as any;\r\n\r\n    // current values\r\n    const selectedCommunities = (getFilter(\"community\") as string[]) ?? [];\r\n    const selectedYear = (getFilter(\"__year\") as string | null) ?? null;\r\n    const selectedType = (getFilter(\"type\") as string | null) ?? null;\r\n    const selectedCategories = (getFilter(\"category\") as string[]) ?? [];\r\n\r\n    // For Category options, reflect current Community/Year/Type filters to keep the list relevant.\r\n    const categoryOptions: Option[] = useMemo(() => {\r\n        // Build a transient filtered view that applies community/year/type only.\r\n        const rowsForOptions = table.getPreFilteredRowModel().rows.filter((r) => {\r\n            const communityPass =\r\n                selectedCommunities.length === 0 || selectedCommunities.includes(String(r.getValue(\"community\") ?? \"\"));\r\n            const typePass = !selectedType || String(r.getValue(\"type\") ?? \"\") === selectedType;\r\n            const yr = (() => {\r\n                const p = r.original.period;\r\n                const s = p == null ? \"\" : String(p);\r\n                const y = /^\\d{4}/.test(s) ? s.slice(0, 4) : \"\";\r\n                return y;\r\n            })();\r\n            const yearPass = !selectedYear || yr === selectedYear;\r\n            return communityPass && typePass && yearPass;\r\n        });\r\n\r\n        const set = new Set<string>();\r\n        rowsForOptions.forEach((rr) => {\r\n            const v = String(rr.getValue(\"category\") ?? \"\");\r\n            if (v) set.add(v);\r\n        });\r\n        return Array.from(set).sort((a, b) => a.localeCompare(b)).map((v) => ({ value: v, label: v }));\r\n    }, [table, selectedCommunities, selectedType, selectedYear]);\r\n\r\n    // ---------- toolbar actions ----------\r\n    const setFilter = useCallback(\r\n        (id: string, value: any) => {\r\n            setFilters((old) => {\r\n                const others = old.filter((f) => f.id !== id);\r\n                if (value == null || (Array.isArray(value) && value.length === 0)) return others;\r\n                return [...others, { id, value }];\r\n            });\r\n            // Clear selection whenever filters change\r\n            setRowSelection({});\r\n        },\r\n        []\r\n    );\r\n\r\n    const onCommunitiesChange = (vals: string[]) => setFilter(\"community\", vals);\r\n    const onYearChange = (val: string | null) => setFilter(\"__year\", val);\r\n    const onTypeChange = (val: string | null) => setFilter(\"type\", val);\r\n    const onCategoriesChange = (vals: string[]) => setFilter(\"category\", vals);\r\n\r\n    const clearAllFilters = () => setFilters([]);\r\n\r\n    const exportCsv = () => {\r\n        const rows = table.getRowModel().rows.map((r) => r.original);\r\n        exportRowsToCsv(rows, columns);\r\n    };\r\n\r\n    // ---------- virtualization ----------\r\n    const parentRef = useRef<HTMLDivElement>(null);\r\n    const virtualizer = useVirtualizer({\r\n        count: table.getRowModel().rows.length,\r\n        getScrollElement: () => parentRef.current,\r\n        estimateSize: () => 40,\r\n        overscan: 8,\r\n    });\r\n    const virtualItems = virtualizer.getVirtualItems();\r\n\r\n    // TOTAL (filtered)\r\n    const totalFiltered = useMemo(() => {\r\n        let sum = 0;\r\n        for (const r of table.getFilteredRowModel().rows) {\r\n            const v = r.original.amount;\r\n            if (typeof v === \"number\") sum += v;\r\n        }\r\n        return sum;\r\n    }, [table, data, filters, sorting, grouping]);\r\n\r\n    // ---------- render ----------\r\n    const anyFilterActive = filters.length > 0;\r\n\r\n    return (\r\n        <section aria-label=\"Budget grid\" className=\"space-y-3\">\r\n            {/* Toolbar (replaces Bulk Edit strip) */}\r\n            <div className=\"flex flex-wrap items-center gap-2 rounded-xl border border-slate-200 bg-white p-3 shadow-sm\">\r\n                {/* Community (multi) */}\r\n                <MultiSelect\r\n                    aria-label=\"Filter by community\"\r\n                    label=\"Community\"\r\n                    values={selectedCommunities}\r\n                    options={allCommunities}\r\n                    onChange={onCommunitiesChange}\r\n                    className=\"mr-1\"\r\n                />\r\n\r\n                {/* Year (single) */}\r\n                <SingleSelect\r\n                    aria-label=\"Filter by year\"\r\n                    label=\"Year\"\r\n                    value={selectedYear}\r\n                    options={yearOptions}\r\n                    onChange={onYearChange}\r\n                    className=\"mr-1\"\r\n                />\r\n\r\n                {/* Budget Type (single) */}\r\n                <SingleSelect\r\n                    aria-label=\"Filter by budget type\"\r\n                    label=\"Budget Type\"\r\n                    value={selectedType}\r\n                    options={typeOptions}\r\n                    onChange={onTypeChange}\r\n                    className=\"mr-1\"\r\n                />\r\n\r\n                {/* Category (multi) */}\r\n                <MultiSelect\r\n                    aria-label=\"Filter by category\"\r\n                    label=\"Category\"\r\n                    values={selectedCategories}\r\n                    options={categoryOptions}\r\n                    onChange={onCategoriesChange}\r\n                    className=\"mr-1\"\r\n                />\r\n\r\n                {/* Spacer */}\r\n                <div className=\"grow\" />\r\n\r\n                {/* Filters active badge */}\r\n                {anyFilterActive && (\r\n                    <span className=\"rounded-full bg-slate-100 px-2 py-1 text-xs font-medium text-slate-600\">\r\n                        {filters.length} filter{filters.length > 1 ? \"s\" : \"\"} active\r\n                    </span>\r\n                )}\r\n\r\n                {/* Clear + Export */}\r\n                <button\r\n                    type=\"button\"\r\n                    onClick={clearAllFilters}\r\n                    className=\"rounded-md border border-slate-300 bg-white px-3 py-1.5 text-sm font-medium text-slate-700 shadow-sm hover:bg-slate-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-teal-500\"\r\n                >\r\n                    Clear Filters\r\n                </button>\r\n                <button\r\n                    type=\"button\"\r\n                    onClick={exportCsv}\r\n                    className=\"rounded-md border border-slate-300 bg-white px-3 py-1.5 text-sm font-medium text-slate-700 shadow-sm hover:bg-slate-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-teal-500\"\r\n                >\r\n                    Export CSV\r\n                </button>\r\n            </div>\r\n\r\n            {/* Column headers + simple text filter row (unchanged) */}\r\n            <div className=\"rounded-t-lg border-x border-t border-slate-200 bg-slate-50\">\r\n                <div\r\n                    className=\"grid grid-cols-[repeat(var(--cols),minmax(140px,1fr))] px-2 py-2 text-xs font-semibold text-slate-600\"\r\n                    style={{ [\"--cols\" as any]: table.getAllColumns().filter(c => c.getIsVisible() && !(c.columnDef as any)?.meta?.hiddenHelper).length }}\r\n                >\r\n                    {table.getFlatHeaders().map((header) => {\r\n                        // Hide helper column from header row\r\n                        if ((header.column.columnDef as any)?.meta?.hiddenHelper) return null;\r\n                        return (\r\n                            <div key={header.id} className=\"pr-2\">\r\n                                <button\r\n                                    className=\"inline-flex items-center gap-1 hover:text-slate-900\"\r\n                                    onClick={header.column.getToggleSortingHandler()}\r\n                                    title=\"Click to sort\"\r\n                                >\r\n                                    {flexRender(header.column.columnDef.header, header.getContext())}\r\n                                    {{\r\n                                        asc: \" ↑\",\r\n                                        desc: \" ↓\",\r\n                                    }[header.column.getIsSorted() as string] ?? null}\r\n                                </button>\r\n                                {/* simple per-column text filter */}\r\n                                {header.column.getCanFilter() && (\r\n                                    <div className=\"mt-1\">\r\n                                        <input\r\n                                            className=\"w-full rounded border border-slate-300 px-1.5 py-1 text-xs\"\r\n                                            placeholder={(header.column.columnDef as any).meta?.filterPlaceholder ?? \"filter…\"}\r\n                                            value={(header.column.getFilterValue() as string) ?? \"\"}\r\n                                            onChange={(e) => header.column.setFilterValue(e.target.value)}\r\n                                        />\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        );\r\n                    })}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Table body (virtualized) */}\r\n            <div\r\n                ref={parentRef}\r\n                className=\"border-x border-b border-slate-200\"\r\n                style={{ height: 720, overflow: \"auto\", position: \"relative\" }}\r\n                aria-label=\"Budget TanStack Grid\"\r\n            >\r\n                <div style={{ height: virtualizer.getTotalSize(), position: \"relative\" }}>\r\n                    {virtualItems.map((vi) => {\r\n                        const row = table.getRowModel().rows[vi.index];\r\n                        // compute visible columns count excluding the hidden helper\r\n                        const visibleCols = row.getVisibleCells().filter(c => !(c.column.columnDef as any)?.meta?.hiddenHelper);\r\n                        return (\r\n                            <div\r\n                                key={row.id}\r\n                                className={`grid grid-cols-[repeat(var(--cols),minmax(140px,1fr))] border-b border-slate-100 px-2 text-sm ${row.getIsSelected() ? \"bg-teal-50\" : \"bg-white\"} hover:bg-slate-50`}\r\n                                style={{\r\n                                    transform: `translateY(${vi.start}px)`,\r\n                                    [\"--cols\" as any]: visibleCols.length,\r\n                                    height: vi.size,\r\n                                    alignItems: \"center\",\r\n                                }}\r\n                                onClick={() => row.toggleSelected()}\r\n                            >\r\n                                {visibleCols.map((cell) => (\r\n                                    <div key={cell.id} className=\"pr-2\">\r\n                                        {flexRender(cell.column.columnDef.cell, cell.getContext())}\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        );\r\n                    })}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Pinned TOTAL (filtered) */}\r\n            <div className=\"rounded-b-lg border border-teal-200 bg-teal-50 px-3 py-2 text-sm font-semibold text-teal-800\">\r\n                TOTAL (filtered): <span className=\"tabular-nums\">{fmtUSD(totalFiltered)}</span>\r\n            </div>\r\n        </section>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}